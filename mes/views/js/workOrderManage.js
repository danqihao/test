$(function () {
	let leftNav = $('#mainLeftSidebar .sidebar-nav'), // 左侧边栏
		RightContent = $('#mainRightContent'), // 右侧内容栏
		RightContentSwiper = RightContent.find('.swiper-wrapper'), // 右侧内容栏下的swiper
		leftNavLink = leftNav.find('a').filter('[href^="#"]'), // 左侧变栏对应的swiper
		mainModal_1 = $('#modalBox').find('#mainModal_1'), // 主要模态框1
		dataDetailsModal = $('#dataDetailsModal'),	// 详情模态框1
		submitModelModal = $('#submitModelModal'),	// 表单提交模态框1
		submitModelModal2 = $('#submitModelModal2'),	// 表单提交模态框2
		workstageList=[],//工序集合
    workshop=[],//车间集合
    semiProParamersTypeId="",//半成品参数id
    semiProParamersList=[],//半成品参数集合
    EnvirParamersList=[],//环境参数集合
    otherParamersList=[],//其他参数集合
    devicesTypeList=[],//设备类型
    OperatorType=[], //操作类型
    timer = null;

    (function loadWorkstepParamersTypeId() {
      $.ajax({
         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
        // async: false,
        url: queryParameterTypeUrl,
        data:{
          type: 'vague',
          status:0,
        },
        success: function (result, status, xhr) {
          if (result.status === 0) {
            let  typeId, typeName,
            dataList = result.map.resultList
            for (let i = 0, len = dataList.length; i < len; i++){
              typeId=dataList[i].standard_parameter_type_id
              typeName=dataList[i].standard_parameter_type_name
              if(typeName==="半成品参数"){
                semiProParamersTypeId=typeId
              }
            }
            console.log(semiProParamersTypeId)
          }
          else {
            // swallFail();	//操作失败
          }
        }
      })
    })();

    	// @description :获取工序名称集合
		(function loadWorkstage() {
			$.ajax({
         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
        async: false,
				data:{
					type:"vague",
					status:0,
					//headNum:1
				},
				url: queryWorkstageBasicsUrl,
				success: function (result, status, xhr) {
					if (result.status === 0) {
						workstageList = result.map.workstageBasicsList
					}
					else {
						// swallFail();	//操作失败
					}
				}

			})
		}());

		function createWorkstageListSelect(target) {
			target.empty()
			target.append(`<option value="">选择工序</option>`);

			for (let i = 0, len = workstageList.length; i < len; i++) {
				//设备类型id作为value,名称作为text
				let optionStr = `<option value="${workstageList[i].workstage_basics_id}">${workstageList[i].workstage_name}</option>`;
				target.append(optionStr);
			}

		}
		// @description :获取生产车间集合
		(function loadWorkshop() {
			$.ajax({
         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
        async: false,
				data:{
					type:"info"
				},
				url: queryWorkshopsUrl,
				success: function (result, status, xhr) {
					if (result.status === 0) {
						workshop = result.map.workshopInfos
					}
					else {
						// swallFail();	//操作失败
					}
				}

			})
		}());

		function createWorkshopListSelect(target) {
			target.empty()
			target.append(`<option value="">选择车间</option>`);

			for (let i = 0, len = workshop.length; i < len; i++) {
				//设备类型id作为value,名称作为text
				let optionStr = `<option value="${workshop[i].role_workshop_id}">${workshop[i].role_workshop_name}</option>`;
				target.append(optionStr);
			}

    }
		// @description :设备设备状态集合
		(function loadOperatorType() {
			$.ajax({
         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
        async: false,
				data:{

				},
				url: queryWorkOrderOperatorTypeUrl,
				success: function (result, status, xhr) {
					if (result.status === 0) {
            OperatorType = result.map.operatorTypes
					}
					else {
						// swallFail();	//操作失败
					}
				}

			})
		}());

		function createOperatorTypeSelect(target) {
			target.empty()
			//target.append(`<option value="">选择设备状态</option>`);

			for (let i = 0, len = OperatorType.length; i < len; i++) {
				//设备类型id作为value,名称作为text
				let optionStr = `<option value="${OperatorType[i]}">${OperatorType[i]}</option>`;
				target.append(optionStr);
			}

    }

        /**
     * @description :获取设备类型集合,因为要先获取数据,所有设为同步
     */
    (function loadDevicesType() {
      $.ajax({
         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
        // async: false,
        url: queryDevicesTypesUrl,
        success: function (result, status, xhr) {
          if (result.status === 0) {
            devicesTypeList = result.map.devices_control_devices_type
          }
          else {
            swallFail();	//操作失败
          }
        }
      })
    }());

	/**
	 * @description :根据设备类型集合生成设备类型下拉选项
	 * @param target: select元素对象
	 */
		function createDevicesTypeSelect(target) {
			target.empty()
			target.append(`<option value="">全部类型</option>`);

			for (let i = 0, len = devicesTypeList.length; i < len; i++) {
				//设备类型id作为value,名称作为text
				let optionStr = `<option value="${devicesTypeList[i].devices_control_devices_type_id}">${devicesTypeList[i].devices_control_devices_type_name}</option>`;
				target.append(optionStr);
			}

		}



	leftNavLink.on('click', function (event) {
		let targetHref = event.currentTarget.getAttribute('href'),
		classAttr = event.currentTarget.getAttribute('class');
    clearInterval(timer);	// 清除定时器，切换到其它页时清除，不然定时器会一直运行

    USERNAME  = "张三"
    USERID = "e0814095529e4662afcff54b5923c073"
		switch (targetHref) {
			case '#workOrderManage':	//工单管理
        (function () {
          let activeSwiper = $('#workOrderManage'), // 右侧外部swiper
            activeSubSwiper = $('#workOrderManageInerSwiper'), // 右侧内部swiper
            activePanel = activeSubSwiper.find('.panel'), // 内部swiper的面板
            activePanelHeading = activePanel.find('.panel-heading'), // 面板头部
            headingMainBtn_1 = activePanelHeading.find('.head-main-btn-1'), // 头部主要按键_1新增工艺基础信息
            panelTbody = activePanel.find('table tbody'),	//面包表格tbody
            paginationContainer = activePanel.find('.pagination'),		// 分页ul标签
            workStageOption = activePanelHeading.find('.work-stage-option'), // 工序集合
            productionWorkshopOption = activePanelHeading.find('.Production-workshop-option'), // 车间集合
            statusTypeOption = activePanelHeading.find('.status-type-option'), // 类型选项
            fuzzySearchGroup = activePanelHeading.find('.fuzzy-search-group'), // 模糊搜索组
            mesloadBox = new MesloadBox(activePanel, {
              // 主数据载入窗口
              warningContent: '没有此类信息，请重新选择或输入'
            });
            createWorkstageListSelect(workStageOption);
            createWorkshopListSelect(productionWorkshopOption);
            // 主表格添加内容
            function addTableData(url, data) {
              $.ajax({
                 type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                url: url,
                data: data,
                beforeSend: function (xml) {
                  // ajax发送前
                  mesloadBox.loadingShow()
                },
                success: function (result, status, xhr) {
                  // console.log(result);
                  // ajax成功
                  mesloadBox.hide()
                  if (result.status === 0) {
                    paginationContainer.show()
                    mesVerticalTableAddData(activePanel, {
                      thead: {
                        theadContent: '序号/工单号/生产批号/工序/计划生产数量/目前生产数量/预计完成日期/实际完成日期/生产优先级/生产状态/操作',
                        theadWidth: '4%/10%/5%/5%/5%/5%/8%/8%/5%/6%/15%'
                      },
                      tbody: {
                        html: [
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                        ],
                        // '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#workOrderDetailModal"><i class="fa fa-tasks fa-fw"></i>工单详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#processDetails"><i class="fa fa-tasks fa-fw"></i>过程详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#addExecutionRecordn"><i class="fa fa-tasks fa-fw"></i>添加过程记录</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#over"><i class="fa fa-tasks fa-fw"></i>完成</a></td>'

                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                        dataAddress: function (tbodyTarget, html, result) {
                          tbodyTarget.empty() // 清空表格主体
                          let map = result.map, // 映射zszs
                            dataList = map.workOrders, // 主要数据列表
                            tempData = null; // 表格td内的临时数据
                          for (let i = 0, len = dataList.length; i < len; i++) {
                            tbodyTarget.append('<tr></tr>'); // 添加行
                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                            for (let i = 0, len = html.length; i < len; i++) {
                              currentTr.append(html[i]); // 添加表格内的HTML
                              switch (i) {
                                case 0:
                                  currentTr.children().eq(i).html(currentTr.index() + 1)
                                  break;
                                case 1: {
                                  tempData = dataList[currentTr.index()].work_order_number;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 2: {
                                	tempData = dataList[currentTr.index()].plan.production_plan_batch_number;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 3: {
                                  tempData = dataList[currentTr.index()].planQuotesWorkstage.workstage_name;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 4: {
                                  tempData = dataList[currentTr.index()].work_order_expected_output;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 5: {
                                  tempData = dataList[currentTr.index()].work_order_actual_output;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 6: {
                                  tempData = dataList[currentTr.index()].work_order_estimated_completion_time;
                                  if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                    currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                  }else{
                                    currentTr.children().eq(i).html("/")
                                  }
                                }
                                  break;
                                case 7: {
                                  tempData = dataList[currentTr.index()].work_order_actual_finish_time;
                                  if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                    currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                  }else{
                                    currentTr.children().eq(i).html("/")
                                  }
                                  
                                }
                                  break;
                                case 8: {
                                  tempData = dataList[currentTr.index()].plan.production_plan_production_priority;//优先级
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 9: {
                                  tempData = dataList[currentTr.index()].workOrderStatus.plan_production_status;
                                  if(tempData ==0){
                                    currentTr.children().eq(i).html("未生产")
                                  }else if(tempData ==1){
                                    currentTr.children().eq(i).html("生产中")
                                  }
                                  else if(tempData ==2){
                                    currentTr.children().eq(i).html("已暂停")
                                  }
                                  else if(tempData ==3){
                                    currentTr.children().eq(i).html("生产完成")
                                  }
                                  else if(tempData ==4){
                                    currentTr.children().eq(i).html("停止生产")
                                  }else if(tempData ==5){
																		currentTr.children().eq(i).html("等待生产")
																	}
                                }
                                  break;
                                case 10:
                                  tempData = dataList[currentTr.index()].workOrderStatus.plan_production_status;
                                  if(tempData == 3){
                                    currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-modal-target="#workOrderDetailModal"><i class="fa fa-tasks fa-fw"></i>工单详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#processDetails"><i class="fa fa-tasks fa-fw"></i>过程详情</a>`)
                                  }else{
                                    currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-modal-target="#workOrderDetailModal"><i class="fa fa-tasks fa-fw"></i>工单详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#processDetails"><i class="fa fa-tasks fa-fw"></i>过程详情</a>`)
                                  }
                                  currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                    workOrderId = dataList[currentTr.index()].work_order_id,
                                    workOrderStatus =dataList[currentTr.index()].workOrderStatus.plan_production_status,
                                    workstageId = []
                                    workstageId.push(dataList[currentTr.index()].workstage_id)
                                    switch (dataContent) {
                                      case '#workOrderDetailModal': {	//工单详情
                                        if(workOrderStatus == 3){//详情
                                          let dataContent = $('#workOrderDetailModal'),
                                            panelList = dataContent.find('.panel'),
                                            panel_1=panelList.eq(0),
                                            panel_2=panelList.eq(1),
                                            panel_3=panelList.eq(2),
                                            panel_4=panelList.eq(3),
                                            panel_5=panelList.eq(4),
                                            modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                            modalSubmitBtn = dataContent.find('.modal-submit')


                                          panel_1.find('.panel-heading').find('.panel-title').text("基本详情") // 更换panel标题
                                          panel_2.find('.panel-heading').find('.panel-title').text("工步") // 更换panel标题
                                          panel_3.find('.panel-heading').find('.panel-title').text("环境参数") // 更换panel标题
                                          panel_4.find('.panel-heading').find('.panel-title').text("半成品参数") // 更换panel标题
                                          panel_5.find('.panel-heading').find('.panel-title').text("其他") // 更换panel标题

                                          dataContent.modal({
                                            backdrop: false, // 黑色遮罩不可点击
                                            keyboard: false,  // esc按键不可弃用模态框
                                            show: false
                                          })
                                          dataContent.modal('show') // 运行时显示
                                          modalSubmitBtn.hide()

                                          // dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                          //   $('body').addClass('modal-open')
                                          // })

                                          modalCloseBtn.off('click').on('click', (event) => {
                                            // 点击弃用按钮隐藏该模态框
                                            dataContent.modal('hide')
                                            // 初始化表格
                                            panel_2.find("tbody").empty()
                                            panel_3.find("tbody").empty()
                                            panel_4.find("tbody").empty()
                                            panel_5.find("tbody").empty()
                                          })
                                          // 添加主体表单数据
                                          function addTableData(url, data) {
                                            $.ajax({
                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                              url: url,
                                              data: data,
                                              beforeSend: function (xml) {
                                                // ajax发送前
                                                mesloadBox.loadingShow()
                                              },
                                              success: function (result, status, xhr) {
                                                // ajax成功
                                                mesloadBox.hide()
                                                if (result.status === 0) {
                                                  //panel1 基础消息
                                                  mesHorizontalTableAddData(panel_1.find('table'), null, {
                                                    thead: '工单号/所属生产批号/产品型号/工艺/工艺版本/工序/工序优率/工序负责人/极性/半成品类型/半成品型号/预计产出量/半成品单位/生产线/生产车间/生产优先级/工单创建人/工单负责人/工单创建时间/预定开始日期/预定完成时间/实际产出量/实际开始时间/实际完成日期/班次',
                                                    tableWitch: '5%/15%/15%',
                                                    viewColGroup: 3,
                                                    importStaticData: (tbodyTd, length) => {
                                                      let map = result.map, // 映射
                                                      dataList = map.workOrder, // 主要数据列表
                                                      selectHtml = `<select class="form-control table-input input-sm"></select>`,
                                                      tempData = null; // 表格td内的临时数据

                                                      for (let i = 0, len = length; i < len; i++) {
                                                        switch (i) {
                                                          case 0: {
                                                            tempData = dataList.work_order_number
                                                            tbodyTd.eq(i).html(tempData);
                                                          }
                                                            break;
                                                          case 1: {
                                                            tempData = dataList.plan.production_plan_batch_number;
                                                            tbodyTd.eq(i).html(tempData);
                                                          }
                                                            break;
                                                          case 2: {
                                                            tempData =  dataList.plan.product_model_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 3: {
                                                            tempData = dataList.plan.craft_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 4: {
                                                            tempData = dataList.plan.craft_versions
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 5: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 6: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_quality_rate
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 7: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_responsible
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 8: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_polarity
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 9: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_type_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 10: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_genre
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 11: {
                                                            tempData = dataList.work_order_expected_output
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 12: {

                                                            tempData = dataList.planQuotesWorkstage.semi_finish_unit
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 13: {
                                                            tempData = dataList.plan.product_line_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 14: {
                                                            tempData = dataList.role_workshop_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 15: {
                                                            tempData = dataList.plan.production_plan_production_priority
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 16: {
                                                            tempData = dataList.work_order_creators
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 17: {
                                                            tempData = dataList.work_order_responsible
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 18: {
                                                            tempData = dataList.work_order_creation_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }
                                                          }
                                                          break;
                                                          case 19: {
                                                            tempData = dataList.work_order_scheduled_start_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }
                                                          }
                                                          break;
                                                          case 20: {
                                                            tempData = dataList.work_order_estimated_completion_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 21: {
                                                            tempData = dataList.work_order_actual_output
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 22: {
                                                            tempData = dataList.work_order_actual_start_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 23: {
                                                            tempData = dataList.work_order_actual_finish_time
                                                           if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 24: {
                                                            tempData = dataList.work_order_classes
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          default:
                                                            break;
                                                        }
                                                      }

                                                    }
                                                  })
                                                }
                                                else {
                                                  mesloadBox.warningShow();
                                                }
                                              }
                                            })
                                          }
                                          function addTableData2(url, data) {
                                            $.ajax({
                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                              url: url,
                                              data: data,
                                              beforeSend: function (xml) {
                                                // ajax发送前
                                                mesloadBox.loadingShow()
                                              },
                                              success: function (result, status, xhr) {
                                                // ajax成功
                                                mesloadBox.hide()
                                                if (result.status === 0) {
                                                  let parmList = result.map.workstageList[0].useParametersList,
                                                  semiProParamersList=[],//半成品参数集合
                                                  EnvirParamersList=[],//环境参数集合
                                                  otherParamersList=[]//其他参数集合

                                                  // for(var i=0;i<parmList.length;i++){
                                                  //   if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                  //     EnvirParamersList.push(parmList[i])
                                                  //   }else if(parmList[i].standard_parameter_type_id === semiProParamersTypeId){
                                                  //     semiProParamersList.push(parmList[i])
                                                  //   }else{
                                                  //     otherParamersList.push(parmList[i])
                                                  //   }
                                                  // }

                                                  for(var i=0;i<parmList.length;i++){
                                                    if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                      EnvirParamersList.push(parmList[i])
                                                    }else{
                                                      semiProParamersList.push(parmList[i])
                                                    }
                                                  }


                                                  //panel2 工步
                                                  mesVerticalTableAddData(panel_2, {
                                                    thead: {
                                                      theadContent: '序号/工步名称/工步版本/工步编号/操作',
                                                      theadWidth: '6%/10%/10%/10%/35%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal3"><i class="fa fa-tasks fa-fw"></i>查看物料使用详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#stepParm"><i class="fa fa-tasks fa-fw"></i>查看工步参数</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#devicesRecord"><i class="fa fa-tasks fa-fw"></i>查看设备操作记录</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let map = result.map, // 映射zszs
                                                        dataList = map.workstageList[0].stageAndStepRelationList, // 主要数据列表
                                                          tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_name;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_version;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_num;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 4:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  stepId = dataList[currentTr.index()].workstep.craft_control_workstep_id;
                                                                  let  stepId2 = [];
                                                                  stepId2.push(stepId)
                                                                  switch (dataContent) {
                                                                    case '#detailModal3': {	//物料详情
                                                                      let dataContent = $('#detailModal3'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        panel_1 = panelList.eq(0),
                                                                        panel_2 = panelList.eq(1),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        statusTypeOption = panel_2.find('.status-type-option'), // 类型选项
                                                                        temp=`
                                                                        <option value="norm">请选择</option>
                                                                        <option value="materialName">按物料查看</option>
                                                                        <option value="materialUseTimeAsc">按时间升序</option>
                                                                        <option value="materialUseTimeDesc">按时间降序</option>
                                                                        `

                                                                        statusTypeOption.append(temp)


                                                                        panel_1.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题
                                                                        panel_2.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                          statusTypeOption.empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              // 详情1
                                                                              mesVerticalTableAddData(panel_1, {
                                                                                thead: {
                                                                                  theadContent: '序号/物料名称/规格/型号/单位/操作',
                                                                                  theadWidth: '6%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                    dataList = map.workstepList[0].useMaterielList, // 主要数据列表

                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;

                                                                                          case 5:
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              stepMaterialId = dataList[currentTr.index()].craft_materiel_id;
                                                                                              switch (dataContent) {
                                                                                                case '#detailModal': {	//详情
                                                                                                  let dataContent = $('#detailModal2'),
                                                                                                    panelList = dataContent.find('.panel'),
                                                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                    panelThead = panelList.find('thead'),
                                                                                                    panelTbody = panelList.find('tbody');
                                                                                                    panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                                                    dataContent.modal({
                                                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                                                      show: false
                                                                                                    })
                                                                                                    dataContent.modal('show') // 运行时显示
                                                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                      $('body').addClass('modal-open')
                                                                                                    })

                                                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                                                      // 点击弃用按钮隐藏该模态框
                                                                                                      dataContent.modal('hide')
                                                                                                      // 初始化表格
                                                                                                      panelList.find('thead').empty()
                                                                                                      panelList.find('tbody').empty()
                                                                                                    })

                                                                                                  // 主表格添加内容
                                                                                                  function addTableData(url, data) {
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url: url,
                                                                                                      data: data,
                                                                                                      beforeSend: function (xml) {
                                                                                                        // ajax发送前
                                                                                                        mesloadBox.loadingShow()
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        // ajax成功
                                                                                                        mesloadBox.hide()
                                                                                                        if (result.status === 0) {
                                                                                                          //panel1
                                                                                                          mesVerticalTableAddData(panelList, {
                                                                                                            thead: {
                                                                                                              theadContent: '序号/投料时间/使用数量/投料人/物料编号/备注',
                                                                                                              theadWidth: '6%/22%/13%/15%/15%/15%'
                                                                                                            },
                                                                                                            tbody: {
                                                                                                              html: [
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>'
                                                                                                              ],

                                                                                                              // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                                              dataAddress: function (tbodyTarget, html, result) {
                                                                                                                tbodyTarget.empty() // 清空表格主体
                                                                                                                let map = result.map, // 映射zszs
                                                                                                                  dataList = map.materialUseRecords, // 主要数据列表
                                                                                                                  tempData = null; // 表格td内的临时数据
                                                                                                                for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                                                  tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                                                  let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                                                  for (let i = 0, len = html.length; i < len; i++) {
                                                                                                                    currentTr.append(html[i]); // 添加表格内的HTML
                                                                                                                    switch (i) {
                                                                                                                      case 0:
                                                                                                                        currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                                                        break;
                                                                                                                      case 1: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_time;
                                                                                                                        // tempData=
                                                                                                                        currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 2: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_amount;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 3: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_user;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 4: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_number;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 5: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_describe;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;


                                                                                                                      default:
                                                                                                                        break;
                                                                                                                    }
                                                                                                                  }
                                                                                                                }
                                                                                                              }
                                                                                                            },

                                                                                                            pagination: {
                                                                                                              totalRow: result.map.line, // 总行数
                                                                                                              displayRow: result.map.materialUseRecords.length // 显示行数
                                                                                                            },

                                                                                                            ajax: {
                                                                                                              url: url,
                                                                                                              data: data
                                                                                                            }
                                                                                                          })


                                                                                                        }
                                                                                                        else {
                                                                                                          mesloadBox.warningShow();
                                                                                                        }
                                                                                                      }
                                                                                                    })
                                                                                                  }

                                                                                                  // 导航栏点击时运行数据加载
                                                                                                  addTableData(queryWorkOrderMaterialUseRecordUrl, {
                                                                                                    type:"norm",
                                                                                                    workOrderId: workOrderId,
                                                                                                    stepMaterialId:stepMaterialId,
                                                                                                    headNum: 1
                                                                                                  });

                                                                                                  break;
                                                                                                }


                                                                                              }
                                                                                            })
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow:result.map.workstepList[0].useMaterielList.length, // 总行数
                                                                                displayRow: result.map.workstepList[0].useMaterielList.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })



                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }
                                                                      function addTableData2(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {

                                                                              mesVerticalTableAddData(panel_2, {
                                                                                thead: {
                                                                                  theadContent: '序号/物料名称/规格/型号/单位/投料时间/使用数量/投料人/物料编号/备注',
                                                                                  theadWidth: '6%/10%/9%/9%/9%/16%/9%/10%/10%/10%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.materialUseRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_amount;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 7: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_user;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 8: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;

                                                                                          case 9: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_describe;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.materialUseRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryStepParticularsUrl, {
                                                                        stepIds:stepId2,
                                                                      });
                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData2(queryWorkOrderMaterialUseRecordUrl, {
                                                                        type:"norm",
                                                                        workOrderId: workOrderId,
                                                                        stepId:stepId,
                                                                        headNum: 1
                                                                      });


                                                                      statusTypeOption.off("change").on("change",function(){
                                                                        let status = $(this).val();
                                                                        addTableData2(queryWorkOrderMaterialUseRecordUrl, {
                                                                          type:status,
                                                                          workOrderId: workOrderId,
                                                                          stepId:stepId,
                                                                          headNum: 1
                                                                        });
                                                                      })

                                                                      break;
                                                                    }
                                                                    case '#stepParm': {	//工步参数详情
                                                                      let dataContent = $('#detailModal3'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        panel_1 = panelList.eq(0),
                                                                        panel_2 = panelList.eq(1),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        statusTypeOption = panel_2.find('.status-type-option'), // 类型选项
                                                                        temp=`
                                                                        <option value="norm">请选择</option>
                                                                        <option value="stepParameteName">按参数名称</option>
                                                                        <option value="parameteRecordTimeAsc">按时间升序</option>
                                                                        <option value="parameteRecordTimeDesc">按时间降序</option>
                                                                        `

                                                                        statusTypeOption.append(temp)


                                                                        panel_1.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题
                                                                        panel_2.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示

                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                          statusTypeOption.empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panel_1, {
                                                                                thead: {
                                                                                  theadContent: '序号/参数/值类型/参考值/单位/设备类型/操作',
                                                                                  theadWidth: '6%/15%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                    dataList = map.workstepList[0].workstepParameterList, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                            if(tempData = "constantValue"){
                                                                                              currentTr.children().eq(i).html( "固定值")
                                                                                            }else if(tempData = "rangeValue"){
                                                                                              currentTr.children().eq(i).html("范围值")
                                                                                            }else if(tempData = "deviationValue"){
                                                                                              currentTr.children().eq(i).html("浮动值")
                                                                                            }
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                            let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                            let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                            let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                            let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                              if(tempData == "constantValue"){
                                                                                                currentTr.children().eq(i).html(constantValue)
                                                                                              }else if(tempData == "rangeValue"){
                                                                                                currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                              }else if(tempData == "deviationValue"){
                                                                                                currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                              }
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_type_id;
                                                                                            let 	selectHtml = `<select class="form-control table-input input-sm"></select>`
                                                                                            currentTr.children().eq(i).addClass('table-input-td')
                                                                                            currentTr.children().eq(i).html(selectHtml)

                                                                                            let target =  currentTr.children().eq(i).find('select');
                                                                                            for (let i = 0, len = devicesTypeList.length; i < len; i++) {
                                                                                              let optionStr = `<option value="${devicesTypeList[i].devices_control_devices_type_id}">${devicesTypeList[i].devices_control_devices_type_name}</option>`;
                                                                                              target.append(optionStr);
                                                                                            }
                                                                                            target.val(tempData).attr('disabled',true)
                                                                                          }
                                                                                            break;
                                                                                          case 6:
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              stepParameteId = dataList[currentTr.index()].craft_workstep_parameter_id;
                                                                                              switch (dataContent) {
                                                                                                case '#detailModal': {	//详情
                                                                                                  let dataContent = $('#detailModal2'),
                                                                                                    panelList = dataContent.find('.panel'),
                                                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                    panelThead = panelList.find('thead'),
                                                                                                    panelTbody = panelList.find('tbody');
                                                                                                    panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                                                    dataContent.modal({
                                                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                                                      show: false
                                                                                                    })
                                                                                                    dataContent.modal('show') // 运行时显示
                                                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                      $('body').addClass('modal-open')
                                                                                                    })

                                                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                                                      // 点击弃用按钮隐藏该模态框
                                                                                                      dataContent.modal('hide')
                                                                                                      // 初始化表格
                                                                                                      panelList.find('thead').empty()
                                                                                                      panelList.find('tbody').empty()
                                                                                                    })

                                                                                                  // 主表格添加内容
                                                                                                  function addTableData(url, data) {
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url: url,
                                                                                                      data: data,
                                                                                                      beforeSend: function (xml) {
                                                                                                        // ajax发送前
                                                                                                        mesloadBox.loadingShow()
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        // ajax成功
                                                                                                        mesloadBox.hide()
                                                                                                        if (result.status === 0) {
                                                                                                          //panel1
                                                                                                          mesVerticalTableAddData(panelList, {
                                                                                                            thead: {
                                                                                                              theadContent: '序号/参数值/记录人/记录时间/设备编号/备注',
                                                                                                              theadWidth: '6%/15%/15%/18%/15%/15%'
                                                                                                            },
                                                                                                            tbody: {
                                                                                                              html: [
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>'
                                                                                                              ],

                                                                                                              // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                                              dataAddress: function (tbodyTarget, html, result) {
                                                                                                                tbodyTarget.empty() // 清空表格主体
                                                                                                                let map = result.map, // 映射zszs
                                                                                                                  dataList = map.stepParameteRecords, // 主要数据列表
                                                                                                                  tempData = null; // 表格td内的临时数据
                                                                                                                  console.log(dataList)
                                                                                                                for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                                                  tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                                                  let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                                                  for (let i = 0, len = html.length; i < len; i++) {
                                                                                                                    currentTr.append(html[i]); // 添加表格内的HTML
                                                                                                                    switch (i) {
                                                                                                                      case 0:
                                                                                                                        currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                                                        break;
                                                                                                                      case 1: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_steady_state_value;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 2: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_note_taker;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 3: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_write_time;
                                                                                                                        currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 4: {
                                                                                                                        tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 5: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_describe;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      default:
                                                                                                                        break;
                                                                                                                    }
                                                                                                                  }
                                                                                                                }
                                                                                                              }
                                                                                                            },

                                                                                                            pagination: {
                                                                                                              totalRow: result.map.line, // 总行数
                                                                                                              displayRow: result.map.stepParameteRecords.length // 显示行数
                                                                                                            },

                                                                                                            ajax: {
                                                                                                              url: url,
                                                                                                              data: data
                                                                                                            }
                                                                                                          })
                                                                                                        }
                                                                                                        else {
                                                                                                          mesloadBox.warningShow();
                                                                                                        }
                                                                                                      }
                                                                                                    })
                                                                                                  }

                                                                                                  // 导航栏点击时运行数据加载
                                                                                                  addTableData(queryWorkOrderStepParameteRecordUrl, {
                                                                                                    type:"norm",
                                                                                                    workOrderId: workOrderId,
                                                                                                    stepParameteId:stepParameteId,
                                                                                                    headNum: 1
                                                                                                  });

                                                                                                  break;
                                                                                                }


                                                                                              }
                                                                                            })
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.workstepList[0].workstepParameterList.length, // 总行数
                                                                                  displayRow: result.map.workstepList[0].workstepParameterList.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })



                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }
                                                                      function addTableData2(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1

                                                                              mesVerticalTableAddData(panel_2, {
                                                                                thead: {
                                                                                  theadContent: '序号/参数名称/参数类型/参考值/实际值/单位/设备类型/设备编号/记录人/时间/备注',
                                                                                    theadWidth: '6%/10%/8%/8%/8%/8%/8%/8%/8%/8%/8%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.stepParameteRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                            if(tempData = "constantValue"){
                                                                                              currentTr.children().eq(i).html( "固定值")
                                                                                            }else if(tempData = "rangeValue"){
                                                                                              currentTr.children().eq(i).html("范围值")
                                                                                            }else if(tempData = "deviationValue"){
                                                                                              currentTr.children().eq(i).html("浮动值")
                                                                                            }
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                            let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                            let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                            let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                            let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                              if(tempData == "constantValue"){
                                                                                                currentTr.children().eq(i).html(constantValue)
                                                                                              }else if(tempData == "rangeValue"){
                                                                                                currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                              }else if(tempData == "deviationValue"){
                                                                                                currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                              }
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_type_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 7: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 8: {
                                                                                            tempData = dataList[currentTr.index()].step_use_note_taker;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 9: {
                                                                                            tempData = dataList[currentTr.index()].step_use_write_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 10: {
                                                                                            tempData = dataList[currentTr.index()].step_use_describe;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;



                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.stepParameteRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryStepParticularsUrl, {
                                                                        stepIds:stepId2,
                                                                      });
                                                                       // 导航栏点击时运行数据加载
                                                                       addTableData2(queryWorkOrderStepParameteRecordUrl, {
                                                                        type:"stepParameteName",
                                                                        workOrderId: workOrderId,
                                                                        stepId:stepId,
                                                                        headNum: 1
                                                                      });

                                                                      statusTypeOption.off("change").on("change",function(){
                                                                        let status = $(this).val();
                                                                        addTableData2(queryWorkOrderStepParameteRecordUrl, {
                                                                          type:status,
                                                                          workOrderId: workOrderId,
                                                                          stepId:stepId,
                                                                          headNum: 1
                                                                        });
                                                                      })

                                                                      break;
                                                                    }
                                                                    case '#devicesRecord': {	//设备操作记录
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/设备名称/设备编号/开始时间时间/结束时间/设备状态/操作人',
                                                                                  theadWidth: '6%/12%/12%/18%/17%/10%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.devicesOperationRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                      console.log(dataList)
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_start_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_end_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_operator_type;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_operator;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.devicesOperationRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })
                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderDevicesOperationRecordUrl, {
                                                                        stepId: stepId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: result.map.workstageList[0].stageAndStepRelationList.length, // 总行数
                                                      displayRow: result.map.workstageList[0].stageAndStepRelationList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })

                                                  //panel3 环境参数
                                                  mesVerticalTableAddData(panel_3, {
                                                    thead: {
                                                      theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                      theadWidth: '4%/15%/15%/15%/15%/15%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                          let dataList =  EnvirParamersList,//环境参数集合,
                                                          tempData = null; // 表格td内的临时数据
                                                        for (let j = 0, len = dataList.length; j < len; j++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(j); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                // tempData=
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                if(tempData = "constantValue"){
                                                                  currentTr.children().eq(i).html( "固定值")
                                                                }else if(tempData = "rangeValue"){
                                                                  currentTr.children().eq(i).html("范围值")
                                                                }else if(tempData = "deviationValue"){
                                                                  currentTr.children().eq(i).html("浮动值")
                                                                }
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                              let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                              let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                              let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                              let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                if(tempData == "constantValue"){
                                                                  currentTr.children().eq(i).html(constantValue)
                                                                }else if(tempData == "rangeValue"){
                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                }else if(tempData == "deviationValue"){
                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                }
                                                              }
                                                                break;
                                                              case 4: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id;
                                                                  switch (dataContent) {
                                                                    case '#detailModal': {	//详情
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/实际值/记录人/记录时间/备注',
                                                                                  theadWidth: '6%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.parameteRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-btn="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a>`)
                                                                                            parameteRecordIds = dataList[currentTr.index()].parameter_record_id;

                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              swal({
                                                                                                title: '您确定要删除吗？',
                                                                                                type: 'question',
                                                                                                showCancelButton: true,
                                                                                                confirmButtonText: '确定',
                                                                                                cancelButtonText: '取消'
                                                                                              }).then(function (){
                                                                                                $.ajax({
                                                                                                   type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                  url:removeWorkOrderParameteRecordUrl,
                                                                                                  data: {
                                                                                                    parameteRecordIds:parameteRecordIds,
                                                                                                  },
                                                                                                  success: function (result, status, xhr) {
                                                                                                    if (result.status === 0) {
                                                                                                      let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                      swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                    }else {
                                                                                                      swal({
                                                                                                        title: '删除失败',
                                                                                                        type: 'warning',
                                                                                                        timer: '1000',
                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                        showCancelButton: false, // 显示用户取消按钮
                                                                                                        showConfirmButton: false, // 显示用户确认按钮
                                                                                                    })
                                                                                                    }
                                                                                                  },
                                                                                                })
                                                                                              })
                                                                                            })

                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.parameteRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderParameteRecordUrl, {
                                                                        parameteId:parameteId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: EnvirParamersList.length , // 总行数
                                                      displayRow: EnvirParamersList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })

                                                  //panel3  半成品参数

                                                  if(semiProParamersList.length!==0){
                                                    mesVerticalTableAddData(panel_4, {
                                                      thead: {
                                                        theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                        theadWidth: '4%/15%/15%/15%/15%/15%'
                                                      },
                                                      tbody: {
                                                        html: [
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                        ],

                                                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                        dataAddress: function (tbodyTarget, html, result) {
                                                          tbodyTarget.empty() // 清空表格主体
                                                          let  dataList = semiProParamersList, // 主要数据列表
                                                            tempData = null; // 表格td内的临时数据
                                                          for (let i = 0, len = dataList.length; i < len; i++) {
                                                            tbodyTarget.append('<tr></tr>'); // 添加行
                                                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                            for (let i = 0, len = html.length; i < len; i++) {
                                                              currentTr.append(html[i]); // 添加表格内的HTML
                                                              switch (i) {
                                                                case 0:
                                                                  currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                  break;
                                                                case 1: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                  // tempData=
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;
                                                                case 2: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  if(tempData = "constantValue"){
                                                                    currentTr.children().eq(i).html( "固定值")
                                                                  }else if(tempData = "rangeValue"){
                                                                    currentTr.children().eq(i).html("范围值")
                                                                  }else if(tempData = "deviationValue"){
                                                                    currentTr.children().eq(i).html("浮动值")
                                                                  }
                                                                }
                                                                  break;
                                                                case 3: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                  let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                  let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                  let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                                }
                                                                  break;
                                                                case 4: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;

                                                                case 5:
                                                                  currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                    parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id;
                                                                    switch (dataContent) {
                                                                      case '#detailModal': {	//详情
                                                                        let dataContent = $('#detailModal2'),
                                                                          panelList = dataContent.find('.panel'),
                                                                          modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                          panelThead = panelList.find('thead'),
                                                                          panelTbody = panelList.find('tbody');
                                                                          panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                          dataContent.modal({
                                                                            backdrop: false, // 黑色遮罩不可点击
                                                                            keyboard: false,  // esc按键不可弃用模态框
                                                                            show: false
                                                                          })
                                                                          dataContent.modal('show') // 运行时显示
                                                                          dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                            $('body').addClass('modal-open')
                                                                          })

                                                                          modalCloseBtn.off('click').on('click', (event) => {
                                                                            // 点击弃用按钮隐藏该模态框
                                                                            dataContent.modal('hide')
                                                                            // 初始化表格
                                                                            panelList.find('thead').empty()
                                                                            panelList.find('tbody').empty()
                                                                          })

                                                                        // 主表格添加内容
                                                                        function addTableData(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {
                                                                                //panel1
                                                                                mesVerticalTableAddData(panelList, {
                                                                                  thead: {
                                                                                    theadContent: '序号/实际值/记录人/记录时间/备注',
                                                                                    theadWidth: '6%/15%/15%/15%/15%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>'
                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                        dataList = map.parameteRecords, // 主要数据列表
                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                              // tempData=
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                              currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-btn="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a>`)
                                                                                              parameteRecordIds = dataList[currentTr.index()].parameter_record_id;

                                                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                swal({
                                                                                                  title: '您确定要删除吗？',
                                                                                                  type: 'question',
                                                                                                  showCancelButton: true,
                                                                                                  confirmButtonText: '确定',
                                                                                                  cancelButtonText: '取消'
                                                                                                }).then(function (){
                                                                                                  $.ajax({
                                                                                                     type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                    url:removeWorkOrderParameteRecordUrl,
                                                                                                    data: {
                                                                                                      parameteRecordIds:parameteRecordIds,
                                                                                                    },
                                                                                                    success: function (result, status, xhr) {
                                                                                                      if (result.status === 0) {
                                                                                                        let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                        swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                      }else {
                                                                                                        swal({
                                                                                                          title: '删除失败',
                                                                                                          type: 'warning',
                                                                                                          timer: '1000',
                                                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                          showCancelButton: false, // 显示用户取消按钮
                                                                                                          showConfirmButton: false, // 显示用户确认按钮
                                                                                                      })
                                                                                                      }
                                                                                                    },
                                                                                                  })
                                                                                                })
                                                                                              })

                                                                                            }
                                                                                              break;


                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.line, // 总行数
                                                                                    displayRow: result.map.parameteRecords.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })


                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }

                                                                        // 导航栏点击时运行数据加载
                                                                        addTableData(queryWorkOrderParameteRecordUrl, {
                                                                          parameteId:parameteId,
                                                                          headNum: 1
                                                                        });

                                                                        break;
                                                                      }


                                                                    }
                                                                  })
                                                                  break;
                                                                default:
                                                                  break;
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },

                                                      pagination: {
                                                        totalRow: semiProParamersList.length, // 总行数
                                                        displayRow: semiProParamersList.length // 显示行数
                                                      },

                                                      ajax: {
                                                        url: url,
                                                        data: data
                                                      }
                                                    })
                                                  }else{
                                                    panel_4.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                  }


                                                  //panel3  其他
                                                  if(otherParamersList.length!==0){
                                                    mesVerticalTableAddData(panel_5, {
                                                      thead: {
                                                        theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                        theadWidth: '4%/15%/15%/15%/15%/15%'
                                                      },
                                                      tbody: {
                                                        html: [
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                        ],

                                                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                        dataAddress: function (tbodyTarget, html, result) {
                                                          tbodyTarget.empty() // 清空表格主体
                                                          let dataList = otherParamersList, // 主要数据列表
                                                            tempData = null; // 表格td内的临时数据
                                                          for (let i = 0, len = dataList.length; i < len; i++) {
                                                            tbodyTarget.append('<tr></tr>'); // 添加行
                                                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                            for (let i = 0, len = html.length; i < len; i++) {
                                                              currentTr.append(html[i]); // 添加表格内的HTML
                                                              switch (i) {
                                                                case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                                case 1: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                  // tempData=
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;
                                                                case 2: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  if(tempData = "constantValue"){
                                                                    currentTr.children().eq(i).html( "固定值")
                                                                  }else if(tempData = "rangeValue"){
                                                                    currentTr.children().eq(i).html("范围值")
                                                                  }else if(tempData = "deviationValue"){
                                                                    currentTr.children().eq(i).html("浮动值")
                                                                  }
                                                                }
                                                                  break;
                                                                case 3: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                  let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                  let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                  let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                                }
                                                                  break;
                                                                case 4: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;

                                                                case 5:
                                                                  currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                    parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id;
                                                                    switch (dataContent) {
                                                                      case '#detailModal': {	//详情
                                                                        let dataContent = $('#detailModal2'),
                                                                          panelList = dataContent.find('.panel'),
                                                                          modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                          panelThead = panelList.find('thead'),
                                                                          panelTbody = panelList.find('tbody');
                                                                          panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                          dataContent.modal({
                                                                            backdrop: false, // 黑色遮罩不可点击
                                                                            keyboard: false,  // esc按键不可弃用模态框
                                                                            show: false
                                                                          })
                                                                          dataContent.modal('show') // 运行时显示
                                                                          dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                            $('body').addClass('modal-open')
                                                                          })

                                                                          modalCloseBtn.off('click').on('click', (event) => {
                                                                            // 点击弃用按钮隐藏该模态框
                                                                            dataContent.modal('hide')
                                                                            // 初始化表格
                                                                            panelList.find('thead').empty()
                                                                            panelList.find('tbody').empty()
                                                                          })

                                                                        // 主表格添加内容
                                                                        function addTableData(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {
                                                                                //panel1
                                                                                mesVerticalTableAddData(panelList, {
                                                                                  thead: {
                                                                                    theadContent: '序号/实际值/记录人/记录时间/备注',
                                                                                    theadWidth: '6%/15%/15%/15%/15%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>'
                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                        dataList = map.parameteRecords, // 主要数据列表
                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                              // tempData=
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                              currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-btn="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a>`)
                                                                                              parameteRecordIds = dataList[currentTr.index()].parameter_record_id;

                                                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                swal({
                                                                                                  title: '您确定要删除吗？',
                                                                                                  type: 'question',
                                                                                                  showCancelButton: true,
                                                                                                  confirmButtonText: '确定',
                                                                                                  cancelButtonText: '取消'
                                                                                                }).then(function (){
                                                                                                  $.ajax({
                                                                                                     type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                    url:removeWorkOrderParameteRecordUrl,
                                                                                                    data: {
                                                                                                      parameteRecordIds:parameteRecordIds,
                                                                                                    },
                                                                                                    success: function (result, status, xhr) {
                                                                                                      if (result.status === 0) {
                                                                                                        let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                        swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                      }else {
                                                                                                        swal({
                                                                                                          title: '删除失败',
                                                                                                          type: 'warning',
                                                                                                          timer: '1000',
                                                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                          showCancelButton: false, // 显示用户取消按钮
                                                                                                          showConfirmButton: false, // 显示用户确认按钮
                                                                                                      })
                                                                                                      }
                                                                                                    },
                                                                                                  })
                                                                                                })
                                                                                              })

                                                                                            }
                                                                                              break;


                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.line, // 总行数
                                                                                    displayRow: result.map.parameteRecords.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })


                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }

                                                                        // 导航栏点击时运行数据加载
                                                                        addTableData(queryWorkOrderParameteRecordUrl, {
                                                                          parameteId:parameteId,
                                                                          headNum: 1
                                                                        });

                                                                        break;
                                                                      }


                                                                    }
                                                                  })
                                                                  break;
                                                                default:
                                                                  break;
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },

                                                      pagination: {
                                                        totalRow:otherParamersList.length, // 总行数
                                                        displayRow: otherParamersList.length // 显示行数
                                                      },

                                                      ajax: {
                                                        url: url,
                                                        data: data
                                                      }
                                                    })
                                                  }else{
                                                    panel_5.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                  }


                                                }
                                                else {
                                                  mesloadBox.warningShow();
                                                }
                                              }
                                            })
                                          }

                                          addTableData(queryWorkOrderParticularsUrl, {
                                            workOrderId:workOrderId
                                          });
                                          addTableData2(queryWorkstageParticularsUrl, {
                                           // workstageIds:["283b7b8fd83040d789b0dec1b88d79e5"]
                                            workstageIds:workstageId
                                          });
                                        }else {//修改
                                          let dataContent = $('#workOrderDetailModal'),
                                          panelList = dataContent.find('.panel'),
                                          panel_1=panelList.eq(0),
                                          panel_2=panelList.eq(1),
                                          panel_3=panelList.eq(2),
                                          panel_4=panelList.eq(3),
                                          panel_5=panelList.eq(4),
                                          modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                          modalSubmitBtn = dataContent.find('.modal-submit')


                                          panel_1.find('.panel-heading').find('.panel-title').text("基本详情") // 更换panel标题
                                          panel_2.find('.panel-heading').find('.panel-title').text("工步") // 更换panel标题
                                          panel_3.find('.panel-heading').find('.panel-title').text("环境参数") // 更换panel标题
                                          panel_4.find('.panel-heading').find('.panel-title').text("半成品参数") // 更换panel标题
                                          panel_5.find('.panel-heading').find('.panel-title').text("其他") // 更换panel标题

                                          dataContent.modal({
                                            backdrop: false, // 黑色遮罩不可点击
                                            keyboard: false,  // esc按键不可弃用模态框
                                            show: false
                                          })
                                          dataContent.modal('show') // 运行时显示
                                          modalSubmitBtn.hide()

                                          // dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                          //   $('body').addClass('modal-open')
                                          // })

                                          modalCloseBtn.off('click').on('click', (event) => {
                                            // 点击弃用按钮隐藏该模态框
                                            dataContent.modal('hide')
                                            panel_2.find("tbody").empty()
                                            panel_3.find("tbody").empty()
                                            panel_4.find("tbody").empty()
                                            panel_5.find("tbody").empty()
                                          })
                                          // 添加主体表单数据
                                          function addTableData(url, data) {
                                            $.ajax({
                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                              url: url,
                                              data: data,
                                              beforeSend: function (xml) {
                                                // ajax发送前
                                                mesloadBox.loadingShow()
                                              },
                                              success: function (result, status, xhr) {
                                                // ajax成功
                                                mesloadBox.hide()
                                                if (result.status === 0) {
                                                  //panel1 基础消息
                                                  mesHorizontalTableAddData(panel_1.find('table'), null, {
                                                    thead: '工单号/所属生产批号/产品型号/工艺/工艺版本/工序/工序优率/工序负责人/极性/半成品类型/半成品型号/预计产出量/半成品单位/生产线/生产车间/生产优先级/工单创建人/工单负责人/工单创建时间/预定开始日期/预定完成时间/实际产出量/实际开始时间/实际完成日期/班次',
                                                    tableWitch: '15%/15%/15%',
                                                    viewColGroup: 3,
                                                    importStaticData: (tbodyTd, length) => {
                                                      let map = result.map, // 映射
                                                      dataList = map.workOrder, // 主要数据列表
                                                      selectHtml = `<select class="form-control table-input input-sm"></select>`,
                                                      tempData = null; // 表格td内的临时数据

                                                      for (let i = 0, len = length; i < len; i++) {
                                                        switch (i) {
                                                          case 0: {
                                                            tempData = dataList.work_order_number
                                                            tbodyTd.eq(i).html(tempData);
                                                          }
                                                            break;
                                                          case 1: {
                                                            tempData = dataList.plan.production_plan_batch_number;
                                                            tbodyTd.eq(i).html(tempData);
                                                          }
                                                            break;
                                                          case 2: {
                                                            tempData =  dataList.plan.product_model_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 3: {
                                                            tempData = dataList.plan.craft_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 4: {
                                                            tempData = dataList.plan.craft_versions
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 5: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 6: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_quality_rate
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 7: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_responsible
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 8: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_polarity
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 9: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_type_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 10: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_genre
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 11: {
                                                            tempData = dataList.work_order_expected_output
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 12: {

                                                            tempData = dataList.planQuotesWorkstage.semi_finish_unit
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 13: {
                                                            tempData = dataList.plan.product_line_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 14: {
                                                            tempData = dataList.role_workshop_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 15: {
                                                            tempData = dataList.plan.production_plan_production_priority
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 16: {
                                                            tempData = dataList.work_order_creators
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 17: {
                                                            tempData = dataList.work_order_responsible
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 18: {
                                                            tempData = dataList.work_order_creation_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 19: {
                                                            tempData = dataList.work_order_scheduled_start_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 20: {
                                                            tempData = dataList.work_order_estimated_completion_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 21: {
                                                            tempData = dataList.work_order_actual_output
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 22: {
                                                            tempData = dataList.work_order_actual_start_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 23: {
                                                            tempData = dataList.work_order_actual_finish_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 24: {
                                                            tempData = dataList.work_order_classes
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          default:
                                                            break;
                                                        }
                                                      }

                                                    }
                                                  })
                                                }
                                                else {
                                                  mesloadBox.warningShow();
                                                }
                                              }
                                            })
                                          }
                                          function addTableData2(url, data) {
                                            $.ajax({
                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                              url: url,
                                              data: data,
                                              beforeSend: function (xml) {
                                                // ajax发送前
                                                mesloadBox.loadingShow()
                                              },
                                              success: function (result, status, xhr) {
                                                // ajax成功
                                                mesloadBox.hide()
                                                if (result.status === 0) {
                                                  let parmList = result.map.workstageList[0].useParametersList,
                                                  semiProParamersList=[],//半成品参数集合
                                                  EnvirParamersList=[],//环境参数集合
                                                  otherParamersList=[]//其他参数集合

                                                  for(var i=0;i<parmList.length;i++){
                                                    if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                      EnvirParamersList.push(parmList[i])
                                                    }else{
                                                      semiProParamersList.push(parmList[i])
                                                    }
                                                  }
                                                  // for(var i=0;i<parmList.length;i++){
                                                  //   if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                  //     EnvirParamersList.push(parmList[i])
                                                  //   }else if(parmList[i].standard_parameter_type_id === semiProParamersTypeId){
                                                  //     semiProParamersList.push(parmList[i])
                                                  //   }else{
                                                  //     otherParamersList.push(parmList[i])
                                                  //   }
                                                  // }
                                                  //panel2 工步
                                                  mesVerticalTableAddData(panel_2, {
                                                    thead: {
                                                      theadContent: '序号/工步名称/工步版本/工步编号/操作',
                                                      theadWidth: '6%/10%/10%/10%/35%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal3"><i class="fa fa-tasks fa-fw"></i>查看物料使用详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#stepParm"><i class="fa fa-tasks fa-fw"></i>查看工步参数</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#devicesRecord"><i class="fa fa-tasks fa-fw"></i>查看设备操作记录</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let map = result.map, // 映射zszs
                                                        dataList = map.workstageList[0].stageAndStepRelationList, // 主要数据列表
                                                          tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_name;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_version;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_num;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 4:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  stepId = dataList[currentTr.index()].workstep.craft_control_workstep_id;
                                                                  let  stepId2 = [];
                                                                  stepId2.push(stepId)
                                                                  switch (dataContent) {
                                                                    case '#detailModal3': {	//物料详情
                                                                      let dataContent = $('#detailModal3'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        panel_1 = panelList.eq(0),
                                                                        panel_2 = panelList.eq(1),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        statusTypeOption = panel_2.find('.status-type-option'), // 类型选项
                                                                        temp=`
                                                                        <option value="norm">请选择</option>
                                                                        <option value="materialName">按物料查看</option>
                                                                        <option value="materialUseTimeAsc">按时间升序</option>
                                                                        <option value="materialUseTimeDesc">按时间降序</option>
                                                                        `

                                                                        statusTypeOption.append(temp)


                                                                        panel_1.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题
                                                                        panel_2.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                          statusTypeOption.empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              // 详情1
                                                                              mesVerticalTableAddData(panel_1, {
                                                                                thead: {
                                                                                  theadContent: '序号/物料名称/规格/型号/单位/操作',
                                                                                  theadWidth: '4%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                    dataList = map.workstepList[0].useMaterielList, // 主要数据列表

                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;

                                                                                          case 5:
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              stepMaterialId = dataList[currentTr.index()].craft_materiel_id;
                                                                                              switch (dataContent) {
                                                                                                case '#detailModal': {	//详情
                                                                                                  let dataContent = $('#detailModal2'),
                                                                                                    panelList = dataContent.find('.panel'),
                                                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                    panelThead = panelList.find('thead'),
                                                                                                    panelTbody = panelList.find('tbody');
                                                                                                    panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                                                    dataContent.modal({
                                                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                                                      show: false
                                                                                                    })
                                                                                                    dataContent.modal('show') // 运行时显示
                                                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                      $('body').addClass('modal-open')
                                                                                                    })

                                                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                                                      // 点击弃用按钮隐藏该模态框
                                                                                                      dataContent.modal('hide')
                                                                                                      // 初始化表格
                                                                                                      panelList.find('thead').empty()
                                                                                                      panelList.find('tbody').empty()
                                                                                                    })

                                                                                                  // 主表格添加内容
                                                                                                  function addTableData(url, data) {
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url: url,
                                                                                                      data: data,
                                                                                                      beforeSend: function (xml) {
                                                                                                        // ajax发送前
                                                                                                        mesloadBox.loadingShow()
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        // ajax成功
                                                                                                        mesloadBox.hide()
                                                                                                        if (result.status === 0) {
                                                                                                          //panel1
                                                                                                          mesVerticalTableAddData(panelList, {
                                                                                                            thead: {
                                                                                                              theadContent: '序号/投料时间/使用数量/投料人/物料编号/备注/操作',
                                                                                                              theadWidth: '6%/20%/13%/15%/15%/15%/15%'
                                                                                                            },
                                                                                                            tbody: {
                                                                                                              html: [
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'
                                                                                                              ],

                                                                                                              // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                                              dataAddress: function (tbodyTarget, html, result) {
                                                                                                                tbodyTarget.empty() // 清空表格主体
                                                                                                                let map = result.map, // 映射zszs
                                                                                                                  dataList = map.materialUseRecords, // 主要数据列表
                                                                                                                  tempData = null; // 表格td内的临时数据
                                                                                                                for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                                                  tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                                                  let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                                                  for (let i = 0, len = html.length; i < len; i++) {
                                                                                                                    currentTr.append(html[i]); // 添加表格内的HTML
                                                                                                                    switch (i) {
                                                                                                                      case 0:
                                                                                                                        currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                                                        break;
                                                                                                                      case 1: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_time;
                                                                                                                        let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                                                        currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                        currentTr.children().eq(i).html(inputHtml)

                                                                                                                        currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 2: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_amount;
                                                                                                                        let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                        currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                        currentTr.children().eq(i).html(inputHtml)

                                                                                                                        currentTr.children().eq(i).find('input').val(tempData)



                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 3: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_user;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 4: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_number;
                                                                                                                        let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                        currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                        currentTr.children().eq(i).html(inputHtml)

                                                                                                                        currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 5: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_describe;
                                                                                                                        let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                        currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                        currentTr.children().eq(i).html(inputHtml)

                                                                                                                        currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 6: {
                                                                                                                        currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                                          let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                                                          materialUseRecordIds = dataList[currentTr.index()].material_use_record_id,
                                                                                                                          materielID = dataList[currentTr.index()].craft_materiel_id;
                                                                                                                          mainMaterielID = dataList[currentTr.index()].craft_materiel_main_id;
                                                                                                                          materielUnit= dataList[currentTr.index()].craft_materiel_unit;
                                                                                                                          materielName= dataList[currentTr.index()].craft_materiel_name;
                                                                                                                          materielSpecifications= dataList[currentTr.index()].craft_materiel_specifications;
                                                                                                                          materielModel= dataList[currentTr.index()].craft_materiel_model;
                                                                                                                          materialUseRecordIdsList=[]
                                                                                                                          materialUseRecordIdsList.push(materialUseRecordIds)
                                                                                                                          switch (dataContent) {
                                                                                                                            case '#edit': {	//修改
                                                                                                                              req={
                                                                                                                                craft_materiel_id:"",//使用物料id /
                                                                                                                                craft_materiel_main_id:"",//工步物料使用列表id/
                                                                                                                                step_use_material_time:"",//使用时间//
                                                                                                                                step_use_material_amount:"",//使用数量//
                                                                                                                                step_use_material_user:"",//使用人
                                                                                                                                step_use_material_user_id:"",//使用人id
                                                                                                                                step_use_material_describe:"",//备注
                                                                                                                                craft_materiel_unit:"",//
                                                                                                                                craft_materiel_name:"",//
                                                                                                                                craft_materiel_specifications:"",//
                                                                                                                                craft_materiel_model:"",//
                                                                                                                                step_use_material_number:"",//
                                                                                                                                work_order_id:"",//
                                                                                                                                material_use_record_id:"",//
                                                                                                                              }
                                                                                                                              req.craft_materiel_id=materielID
                                                                                                                              req.craft_materiel_main_id=mainMaterielID
                                                                                                                              req.craft_materiel_unit=materielUnit
                                                                                                                              req.craft_materiel_name=materielName
                                                                                                                              req.craft_materiel_specifications=materielSpecifications
                                                                                                                              req.craft_materiel_model=materielModel
                                                                                                                              req.work_order_id=workOrderId
                                                                                                                              req.material_use_record_id=materialUseRecordIds
                                                                                                                              let thisTr =currentTr.find("td")
                                                                                                                              req.step_use_material_time = thisTr.eq(1).find("input").val()
                                                                                                                              req.step_use_material_amount = thisTr.eq(2).find("input").val()
                                                                                                                              req.step_use_material_number = thisTr.eq(4).find("input").val()
                                                                                                                              req.step_use_material_describe = thisTr.eq(5).find("input").val()
                                                                                                                              req.step_use_material_user = thisTr.eq(3).text()

                                                                                                                              let req2 = [] ,req3
                                                                                                                              req2.push(req)
                                                                                                                              req3 = JSON.stringify(req2)
                                                                                                                              swal({
                                                                                                                                title: '您确定要修改吗？',
                                                                                                                                type: 'question',
                                                                                                                                showCancelButton: true,
                                                                                                                                confirmButtonText: '确定',
                                                                                                                                cancelButtonText: '取消'
                                                                                                                              }).then(function (){
                                                                                                                                $.ajax({
                                                                                                                                   type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                                                  url:saveWorkOrderMaterialUseRecordUrl,
                                                                                                                                  data: {
                                                                                                                                    type:"modify",
                                                                                                                                    materialUseRecords:req3,
                                                                                                                                  },
                                                                                                                                  success: function (result, status, xhr) {
                                                                                                                                    if (result.status === 0) {
                                                                                                                                      let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                                                      swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                                                    }else {
                                                                                                                                      swal({
                                                                                                                                        title: '删除失败',
                                                                                                                                        type: 'warning',
                                                                                                                                        timer: '1000',
                                                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                                                        showCancelButton: false, // 显示用户取消按钮
                                                                                                                                        showConfirmButton: false, // 显示用户确认按钮
                                                                                                                                    })
                                                                                                                                    }
                                                                                                                                  },
                                                                                                                                })
                                                                                                                              })
                                                                                                                              break;
                                                                                                                            }
                                                                                                                            case '#delete' :{
                                                                                                                              swal({
                                                                                                                                title: '您确定要删除吗？',
                                                                                                                                type: 'question',
                                                                                                                                showCancelButton: true,
                                                                                                                                confirmButtonText: '确定',
                                                                                                                                cancelButtonText: '取消'
                                                                                                                              }).then(function (){
                                                                                                                                $.ajax({
                                                                                                                                   type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                                                  url:removeWorkOrderMaterialUseRecordUrl,
                                                                                                                                  data: {
                                                                                                                                    materialUseRecordIds:materialUseRecordIdsList,
                                                                                                                                  },
                                                                                                                                  success: function (result, status, xhr) {
                                                                                                                                    if (result.status === 0) {
                                                                                                                                      let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                                                      swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                                                    }else {
                                                                                                                                      swal({
                                                                                                                                        title: '删除失败',
                                                                                                                                        type: 'warning',
                                                                                                                                        timer: '1000',
                                                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                                                        showCancelButton: false, // 显示用户取消按钮
                                                                                                                                        showConfirmButton: false, // 显示用户确认按钮
                                                                                                                                    })
                                                                                                                                    }
                                                                                                                                  },
                                                                                                                                })
                                                                                                                              })
                                                                                                                              break;
                                                                                                                            }
                                                                                                                          }
                                                                                                                        })
                                                                                                                      }
                                                                                                                        break;


                                                                                                                      default:
                                                                                                                        break;
                                                                                                                    }
                                                                                                                  }
                                                                                                                }
                                                                                                              }
                                                                                                            },

                                                                                                            pagination: {
                                                                                                              totalRow: result.map.line, // 总行数
                                                                                                              displayRow: result.map.materialUseRecords.length // 显示行数
                                                                                                            },

                                                                                                            ajax: {
                                                                                                              url: url,
                                                                                                              data: data
                                                                                                            }
                                                                                                          })


                                                                                                        }
                                                                                                        else {
                                                                                                          mesloadBox.warningShow();
                                                                                                        }
                                                                                                      }
                                                                                                    })
                                                                                                  }

                                                                                                  // 导航栏点击时运行数据加载
                                                                                                  addTableData(queryWorkOrderMaterialUseRecordUrl, {
                                                                                                    type:"norm",
                                                                                                    workOrderId: workOrderId,
                                                                                                    stepMaterialId:stepMaterialId,
                                                                                                    headNum: 1
                                                                                                  });

                                                                                                  break;
                                                                                                }


                                                                                              }
                                                                                            })
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow:result.map.workstepList[0].useMaterielList.length, // 总行数
                                                                                displayRow: result.map.workstepList[0].useMaterielList.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })



                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }
                                                                      function addTableData2(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {

                                                                              mesVerticalTableAddData(panel_2, {
                                                                                thead: {
                                                                                  theadContent: '序号/物料名称/规格/型号/单位/投料时间/使用数量/投料人/物料编号/备注',
                                                                                  theadWidth: '6%/10%/9%/9%/9%/16%/9%/10%/10%/10%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.materialUseRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_amount;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 7: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_user;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 8: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;

                                                                                          case 9: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_describe;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.materialUseRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      addTableData(queryStepParticularsUrl, {
                                                                        stepIds:stepId2,
                                                                      });

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData2(queryWorkOrderMaterialUseRecordUrl, {
                                                                        type:"materialName",
                                                                        workOrderId: workOrderId,
                                                                        stepId:stepId,
                                                                        headNum: 1
                                                                      });

                                                                      statusTypeOption.off("change").on("change",function(){
                                                                        let status = $(this).val();
                                                                        addTableData2(queryWorkOrderMaterialUseRecordUrl, {
                                                                          type:status,
                                                                          workOrderId: workOrderId,
                                                                          stepId:stepId,
                                                                          headNum: 1
                                                                        });
                                                                      })

                                                                      break;
                                                                    }
                                                                    case '#stepParm': {	//工步参数详情
                                                                      let dataContent = $('#detailModal3'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        panel_1 = panelList.eq(0),
                                                                        panel_2 = panelList.eq(1),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        statusTypeOption = panel_2.find('.status-type-option'), // 类型选项
                                                                        temp=`
                                                                        <option value="norm">请选择</option>
                                                                        <option value="stepParameteName">按参数名称</option>
                                                                        <option value="parameteRecordTimeAsc">按时间升序</option>
                                                                        <option value="parameteRecordTimeDesc">按时间降序</option>
                                                                        `

                                                                        statusTypeOption.append(temp)


                                                                        panel_1.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题
                                                                        panel_2.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示

                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                          statusTypeOption.empty()
                                                                        })

                                                                        // 主表格添加内容
                                                                        function addTableData(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {
                                                                                //panel1
                                                                                mesVerticalTableAddData(panel_1, {
                                                                                  thead: {
                                                                                    theadContent: '序号/参数/值类型/参考值/单位/设备类型/操作',
                                                                                    theadWidth: '6%/15%/15%/15%/15%/15%/15%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                      dataList = map.workstepList[0].workstepParameterList, // 主要数据列表

                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                              if(tempData = "constantValue"){
                                                                                                currentTr.children().eq(i).html( "固定值")
                                                                                              }else if(tempData = "rangeValue"){
                                                                                                currentTr.children().eq(i).html("范围值")
                                                                                              }else if(tempData = "deviationValue"){
                                                                                                currentTr.children().eq(i).html("浮动值")
                                                                                              }
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                              let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                              let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                              let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                              let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                                if(tempData == "constantValue"){
                                                                                                  currentTr.children().eq(i).html(constantValue)
                                                                                                }else if(tempData == "rangeValue"){
                                                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                                }else if(tempData == "deviationValue"){
                                                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                                }
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              tempData = dataList[currentTr.index()].devices_control_devices_type_id;
                                                                                              let 	selectHtml = `<select class="form-control table-input input-sm"></select>`
                                                                                              currentTr.children().eq(i).addClass('table-input-td')
                                                                                              currentTr.children().eq(i).html(selectHtml)

                                                                                              let target =  currentTr.children().eq(i).find('select');
                                                                                              for (let i = 0, len = devicesTypeList.length; i < len; i++) {
                                                                                                let optionStr = `<option value="${devicesTypeList[i].devices_control_devices_type_id}">${devicesTypeList[i].devices_control_devices_type_name}</option>`;
                                                                                                target.append(optionStr);
                                                                                              }
                                                                                              target.val(tempData).attr('disabled',true)
                                                                                            }
                                                                                              break;
                                                                                            case 6:
                                                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                                stepParameteId = dataList[currentTr.index()].craft_workstep_parameter_id;
                                                                                                switch (dataContent) {
                                                                                                  case '#detailModal': {	//详情
                                                                                                    let dataContent = $('#detailModal2'),
                                                                                                      panelList = dataContent.find('.panel'),
                                                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                      panelThead = panelList.find('thead'),
                                                                                                      panelTbody = panelList.find('tbody');
                                                                                                      panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                                                      dataContent.modal({
                                                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                                                        show: false
                                                                                                      })
                                                                                                      dataContent.modal('show') // 运行时显示
                                                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                        $('body').addClass('modal-open')
                                                                                                      })

                                                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                                                        // 点击弃用按钮隐藏该模态框
                                                                                                        dataContent.modal('hide')
                                                                                                        // 初始化表格
                                                                                                        panelList.find('thead').empty()
                                                                                                        panelList.find('tbody').empty()
                                                                                                      })

                                                                                                    // 主表格添加内容
                                                                                                    function addTableData(url, data) {
                                                                                                      $.ajax({
                                                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                        url: url,
                                                                                                        data: data,
                                                                                                        beforeSend: function (xml) {
                                                                                                          // ajax发送前
                                                                                                          mesloadBox.loadingShow()
                                                                                                        },
                                                                                                        success: function (result, status, xhr) {
                                                                                                          // ajax成功
                                                                                                          mesloadBox.hide()
                                                                                                          if (result.status === 0) {
                                                                                                            //panel1
                                                                                                            mesVerticalTableAddData(panelList, {
                                                                                                              thead: {
                                                                                                                theadContent: '序号/参数值/记录人/记录时间/设备编号/备注/操作',
                                                                                                                theadWidth: '6%/15%/15%/18%/15%/15%/15%'
                                                                                                              },
                                                                                                              tbody: {
                                                                                                                html: [
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                                                ],

                                                                                                                // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                                                dataAddress: function (tbodyTarget, html, result) {
                                                                                                                  tbodyTarget.empty() // 清空表格主体
                                                                                                                  let map = result.map, // 映射zszs
                                                                                                                    dataList = map.stepParameteRecords, // 主要数据列表
                                                                                                                    tempData = null; // 表格td内的临时数据
                                                                                                                    console.log(dataList)
                                                                                                                  for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                                                    tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                                                    let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                                                    for (let i = 0, len = html.length; i < len; i++) {
                                                                                                                      currentTr.append(html[i]); // 添加表格内的HTML
                                                                                                                      switch (i) {
                                                                                                                        case 0:
                                                                                                                          currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                                                          break;
                                                                                                                        case 1: {
                                                                                                                          tempData = dataList[currentTr.index()].step_use_steady_state_value;
                                                                                                                          let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                          currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                          currentTr.children().eq(i).html(inputHtml)

                                                                                                                          currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 2: {
                                                                                                                          tempData = dataList[currentTr.index()].step_use_note_taker;
                                                                                                                        let  takerID = dataList[currentTr.index()].step_use_note_taker_id;
                                                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                                                          currentTr.children().eq(i).attr("takerID",takerID)
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 3: {
                                                                                                                          tempData = dataList[currentTr.index()].step_use_write_time;
                                                                                                                          let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                                                          currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                          currentTr.children().eq(i).html(inputHtml)

                                                                                                                          currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 4: {
                                                                                                                          tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                                                          let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                          currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                          currentTr.children().eq(i).html(inputHtml)

                                                                                                                          currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 5: {
                                                                                                                          tempData = dataList[currentTr.index()].step_use_describe;
                                                                                                                          let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                          currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                          currentTr.children().eq(i).html(inputHtml)

                                                                                                                          currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 6: {
                                                                                                                          currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                                            let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                                                            stepParameteRecords = dataList[currentTr.index()].step_parameter_record_id,
                                                                                                                            stepParameteId = dataList[currentTr.index()].craft_workstep_parameter_main_id,
                                                                                                                            unit = dataList[currentTr.index()].workstep_parameter_unit,
                                                                                                                            ParameteId = dataList[currentTr.index()].craft_control_workstep_id,
                                                                                                                            ParameteName = dataList[currentTr.index()].craft_workstep_parameter_name,
                                                                                                                            ParameteValueType = dataList[currentTr.index()].craft_workstep_parameter_value_type,
                                                                                                                            ParameteConstantValue = dataList[currentTr.index()].workstep_parameter_constant_value,
                                                                                                                            devicesTypeId= dataList[currentTr.index()].devices_control_devices_type_id,
                                                                                                                            valueType= dataList[currentTr.index()].craft_workstep_parameter_value_type,
                                                                                                                            stepParameteRecordsList=[]
                                                                                                                            stepParameteRecordsList.push(stepParameteRecords)
                                                                                                                            switch (dataContent) {
                                                                                                                              case '#edit': {	//
                                                                                                                                req={
                                                                                                                                  craft_workstep_parameter_main_id:"",//工步参数列表id
                                                                                                                                  step_use_steady_state_value:"",//恒定值
                                                                                                                                  step_use_note_taker:"",//记录人
                                                                                                                                  step_use_note_taker_id:"",//记录人id
                                                                                                                                  step_use_write_time:"",//记录时间
                                                                                                                                  devices_control_devices_number:"",//设备编号
                                                                                                                                  step_use_describe:"",//备注
                                                                                                                                  workstep_parameter_unit:"",//
                                                                                                                                  craft_workstep_parameter_id:"",//备注
                                                                                                                                  craft_workstep_parameter_name:"",//备注
                                                                                                                                  work_order_id:"",//备注
                                                                                                                                  step_use_parameter_value_type:"",//值类型
                                                                                                                                  devices_control_devices_type_id:"",
                                                                                                                                  step_parameter_record_id:""
                                                                                                                                }
                                                                                                                                req.craft_workstep_parameter_main_id = stepParameteId
                                                                                                                                req.workstep_parameter_unit = unit
                                                                                                                                req.craft_workstep_parameter_id = ParameteId
                                                                                                                                req.craft_workstep_parameter_name = ParameteName
                                                                                                                                req.devices_control_devices_type_id = devicesTypeId
                                                                                                                                req.work_order_id = workOrderId
                                                                                                                                req.step_use_parameter_value_type = valueType
                                                                                                                                req.step_parameter_record_id = stepParameteRecords

                                                                                                                                let thisTr =currentTr.find("td")
                                                                                                                                req.step_use_steady_state_value = thisTr.eq(1).find("input").val()
                                                                                                                                req.step_use_note_taker = thisTr.eq(2).text()
                                                                                                                                req.step_use_note_taker_id = thisTr.eq(2).attr("takerID")
                                                                                                                                req.step_use_write_time = thisTr.eq(3).find("input").val()
                                                                                                                                req.devices_control_devices_number= thisTr.eq(4).find("input").val()
                                                                                                                                req.craft_workstep_parameter_name= thisTr.eq(5).find("input").val()

                                                                                                                                let req2=[],req3
                                                                                                                                req2.push(req)
                                                                                                                                req3 = JSON.stringify(req2)

                                                                                                                                swal({
                                                                                                                                  title: '您确定要修改吗？',
                                                                                                                                  type: 'question',
                                                                                                                                  showCancelButton: true,
                                                                                                                                  confirmButtonText: '确定',
                                                                                                                                  cancelButtonText: '取消'
                                                                                                                                }).then(function (){
                                                                                                                                  $.ajax({
                                                                                                                                     type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                                                    url:saveWorkOrderStepParameteRecordUrl,
                                                                                                                                    data: {
                                                                                                                                      type:"modify",
                                                                                                                                      stepParameteRecords:req3,
                                                                                                                                    },
                                                                                                                                    success: function (result, status, xhr) {
                                                                                                                                      if (result.status === 0) {
                                                                                                                                        let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                                                        swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                                                      }else {
                                                                                                                                        swal({
                                                                                                                                          title: '操作失败',
                                                                                                                                          type: 'warning',
                                                                                                                                          timer: '1000',
                                                                                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                                                          showCancelButton: false, // 显示用户取消按钮
                                                                                                                                          showConfirmButton: false, // 显示用户确认按钮
                                                                                                                                      })
                                                                                                                                      }
                                                                                                                                    },
                                                                                                                                  })
                                                                                                                                })
                                                                                                                                break;
                                                                                                                              }
                                                                                                                              case '#delete' :{
                                                                                                                                swal({
                                                                                                                                  title: '您确定要删除吗？',
                                                                                                                                  type: 'question',
                                                                                                                                  showCancelButton: true,
                                                                                                                                  confirmButtonText: '确定',
                                                                                                                                  cancelButtonText: '取消'
                                                                                                                                }).then(function (){
                                                                                                                                  $.ajax({
                                                                                                                                     type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                                                    url:removeWorkOrderStepParameteRecordUrl,
                                                                                                                                    data: {
                                                                                                                                      stepParameteRecordIds:stepParameteRecordsList,
                                                                                                                                    },
                                                                                                                                    success: function (result, status, xhr) {
                                                                                                                                      if (result.status === 0) {
                                                                                                                                        let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                                                        swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                                                      }else {
                                                                                                                                        swal({
                                                                                                                                          title: '删除失败',
                                                                                                                                          type: 'warning',
                                                                                                                                          timer: '1000',
                                                                                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                                                          showCancelButton: false, // 显示用户取消按钮
                                                                                                                                          showConfirmButton: false, // 显示用户确认按钮
                                                                                                                                      })
                                                                                                                                      }
                                                                                                                                    },
                                                                                                                                  })
                                                                                                                                })
                                                                                                                                break;
                                                                                                                              }
                                                                                                                            }
                                                                                                                          })
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        default:
                                                                                                                          break;
                                                                                                                      }
                                                                                                                    }
                                                                                                                  }
                                                                                                                }
                                                                                                              },

                                                                                                              pagination: {
                                                                                                                totalRow: result.map.line, // 总行数
                                                                                                                displayRow: result.map.stepParameteRecords.length // 显示行数
                                                                                                              },

                                                                                                              ajax: {
                                                                                                                url: url,
                                                                                                                data: data
                                                                                                              }
                                                                                                            })
                                                                                                          }
                                                                                                          else {
                                                                                                            mesloadBox.warningShow();
                                                                                                          }
                                                                                                        }
                                                                                                      })
                                                                                                    }

                                                                                                    // 导航栏点击时运行数据加载
                                                                                                    addTableData(queryWorkOrderStepParameteRecordUrl, {
                                                                                                      type:"norm",
                                                                                                      workOrderId: workOrderId,
                                                                                                      stepParameteId:stepParameteId,
                                                                                                      headNum: 1
                                                                                                    });

                                                                                                    break;
                                                                                                  }


                                                                                                }
                                                                                              })
                                                                                              break;
                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.workstepList[0].workstepParameterList.length, // 总行数
                                                                                    displayRow: result.map.workstepList[0].workstepParameterList.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })



                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }
                                                                        function addTableData2(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {

                                                                                mesVerticalTableAddData(panel_2, {
                                                                                  thead: {
                                                                                    theadContent: '序号/参数名称/参数类型/参考值/实际值/单位/设备类型/设备编号/记录人/时间/备注',
                                                                                    theadWidth: '6%/10%/8%/8%/8%/8%/8%/8%/8%/8%/8%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                        dataList = map.stepParameteRecords, // 主要数据列表
                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                              // tempData=
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                              if(tempData = "constantValue"){
                                                                                                currentTr.children().eq(i).html( "固定值")
                                                                                              }else if(tempData = "rangeValue"){
                                                                                                currentTr.children().eq(i).html("范围值")
                                                                                              }else if(tempData = "deviationValue"){
                                                                                                currentTr.children().eq(i).html("浮动值")
                                                                                              }
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                              let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                              let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                              let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                              let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                                if(tempData == "constantValue"){
                                                                                                  currentTr.children().eq(i).html(constantValue)
                                                                                                }else if(tempData == "rangeValue"){
                                                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                                }else if(tempData == "deviationValue"){
                                                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                                }
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].step_use_steady_state_value;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 6: {
                                                                                              tempData = dataList[currentTr.index()].devices_control_devices_type_name;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 7: {
                                                                                              tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 8: {
                                                                                              tempData = dataList[currentTr.index()].step_use_note_taker;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 9: {
                                                                                              tempData = dataList[currentTr.index()].step_use_write_time;
                                                                                              currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                            }
                                                                                              break;
                                                                                            case 10: {
                                                                                              tempData = dataList[currentTr.index()].step_use_describe;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;



                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.line, // 总行数
                                                                                    displayRow: result.map.stepParameteRecords.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })


                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }

                                                                      addTableData(queryStepParticularsUrl, {
                                                                        stepIds:stepId2,
                                                                      });

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData2(queryWorkOrderStepParameteRecordUrl, {
                                                                        type:"stepParameteName",
                                                                        workOrderId: workOrderId,
                                                                        stepId:stepId,
                                                                        headNum: 1
                                                                      });
                                                                      statusTypeOption.off("change").on("change",function(){
                                                                        let status = $(this).val();
                                                                        addTableData2(queryWorkOrderStepParameteRecordUrl, {
                                                                          type:status,
                                                                          workOrderId: workOrderId,
                                                                          stepId:stepId,
                                                                          headNum: 1
                                                                        });
                                                                      })

                                                                      break;
                                                                    }
                                                                    case '#devicesRecord': {	//设备操作记录
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/设备名称/设备编号/开始时间时间/结束时间/操作状态/操作人/操作',
                                                                                  theadWidth: '6%/12%/12%/15%/15%/15%/10%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.devicesOperationRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                      console.log(dataList)
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_start_time;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)
                                                                                            currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_end_time;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_operator_type;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_operator;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 7: {
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              devicesOperationRecordIds = dataList[currentTr.index()].devices_operation_record_id,
                                                                                              deviceId = dataList[currentTr.index()].devices_control_devices_id,
                                                                                              recordId = dataList[currentTr.index()].devices_operation_record_id,
                                                                                              operatorId = dataList[currentTr.index()].devices_operation_operator_id,
                                                                                              operatorType = dataList[currentTr.index()].devices_operation_operator_type,
                                                                                              devicesOperationRecordIdsList=[]
                                                                                              devicesOperationRecordIdsList.push(devicesOperationRecordIds)
                                                                                              switch (dataContent) {
                                                                                                case '#edit': {	//修改
                                                                                                 let req={
                                                                                                    work_order_id:"",
                                                                                                    craft_control_workstep_id:"",
                                                                                                    devices_control_devices_id:"",//设备id
                                                                                                    devices_control_devices_name:"",//设备名称
                                                                                                    devices_control_devices_number:"",//设备编号
                                                                                                    devices_operation_start_time:"",//开始时间
                                                                                                    devices_operation_end_time:"",//结束时间
                                                                                                    devices_operation_operator:"",//操作人
                                                                                                    devices_operation_operator_id:"",//操作人id
                                                                                                    devices_operation_operator_type:"",//操作类型
                                                                                                    devices_operation_record_id:""//操作类型
                                                                                                  }
                                                                                                  req.craft_control_workstep_id = stepId
                                                                                                  req.work_order_id = workOrderId
                                                                                                  req.devices_operation_record_id = recordId
                                                                                                  req.devices_operation_operator_type = operatorType
                                                                                                  let thisTr =currentTr.find("td")
                                                                                                    req.devices_control_devices_name = thisTr.eq(1).html()
                                                                                                    req.devices_control_devices_id = deviceId
                                                                                                    req.devices_operation_operator_id = operatorId
                                                                                                    req.devices_control_devices_number = thisTr.eq(2).text()
                                                                                                    req.devices_operation_start_time = thisTr.eq(3).find("input").val()
                                                                                                    req.devices_operation_end_time = thisTr.eq(4).find("input").val()
                                                                                                    req.devices_operation_operator = thisTr.eq(6).text()
                                                                                                  let req3=[] ,req4
                                                                                                  req3.push(req)
                                                                                                  req4 = JSON.stringify(req3)
                                                                                                    swal({
                                                                                                      title: '您确定要修改吗？',
                                                                                                      type: 'question',
                                                                                                      showCancelButton: true,
                                                                                                      confirmButtonText: '确定',
                                                                                                      cancelButtonText: '取消'
                                                                                                    }).then(function (){
                                                                                                      $.ajax({
                                                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                        url:saveWorkOrderDevicesOperationRecordUrl,
                                                                                                        data: {
                                                                                                          type:"modify",
                                                                                                          devicesOperationRecords:req4,
                                                                                                        },
                                                                                                        success: function (result, status, xhr) {
                                                                                                          if (result.status === 0) {
                                                                                                            let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                            swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                          }else {
                                                                                                            swal({
                                                                                                              title: '修改失败',
                                                                                                              type: 'warning',
                                                                                                              timer: '1000',
                                                                                                              allowEscapeKey: false, // 用户按esc键不退出
                                                                                                              allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                              showCancelButton: false, // 显示用户取消按钮
                                                                                                              showConfirmButton: false, // 显示用户确认按钮
                                                                                                          })
                                                                                                          }
                                                                                                        },
                                                                                                      })
                                                                                                    })
                                                                                                    break;
                                                                                                }
                                                                                                case '#delete' :{
                                                                                                  swal({
                                                                                                    title: '您确定要删除吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:removeWorkOrderDevicesOperationRecordUrl,
                                                                                                      data: {
                                                                                                        devicesOperationRecordIds:devicesOperationRecordIdsList,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
																																					                              	swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                              }
                                                                                            })
                                                                                          }
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.devicesOperationRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })
                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderDevicesOperationRecordUrl, {
                                                                        stepId: stepId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: result.map.workstageList[0].stageAndStepRelationList.length, // 总行数
                                                      displayRow: result.map.workstageList[0].stageAndStepRelationList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })

                                                  //panel3 环境参数
                                                  mesVerticalTableAddData(panel_3, {
                                                    thead: {
                                                      theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                      theadWidth: '4%/15%/15%/15%/15%/15%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let dataList =  EnvirParamersList,//环境参数集合,
                                                          tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                // tempData=
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                if(tempData = "constantValue"){
                                                                  currentTr.children().eq(i).html( "固定值")
                                                                }else if(tempData = "rangeValue"){
                                                                  currentTr.children().eq(i).html("范围值")
                                                                }else if(tempData = "deviationValue"){
                                                                  currentTr.children().eq(i).html("浮动值")
                                                                }
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                if(tempData == "constantValue"){
                                                                  currentTr.children().eq(i).html(constantValue)
                                                                }else if(tempData == "rangeValue"){
                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                }else if(tempData == "deviationValue"){
                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                }
                                                              }
                                                                break;
                                                              case 4: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  workstageId = dataList[currentTr.index()].workstage_id,
                                                                  parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                  ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type
                                                                  switch (dataContent) {
                                                                    case '#detailModal': {	//详情
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/实际值/记录人/记录时间/备注/操作',
                                                                                  theadWidth: '6%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.parameteRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                            let takerId = dataList[currentTr.index()].parameter_record_note_taker_id;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                            currentTr.children().eq(i).attr("takerId",takerId)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              parameteRecordIds = dataList[currentTr.index()].parameter_record_id,
                                                                                              parameteRecordIdsList=[]
                                                                                              parameteRecordIdsList.push(parameteRecordIds)
                                                                                              switch (dataContent) {
                                                                                                case '#edit': {	//
                                                                                                  req={
                                                                                                    craft_workstep_parameter_main_id:"",//参数id//
                                                                                                    craft_workstep_parameter_id:"",//参数id
                                                                                                    standard_parameter_type_id:"",//参数lx id//
                                                                                                    workstage_id:"",//工序id//
                                                                                                    work_order_id:"",//工序id//
                                                                                                    parameter_record_steady_state_value:"",//参数记录值
                                                                                                    parameter_record_write_time:"",//记录时间
                                                                                                    parameter_record_note_taker:"",//记录人
                                                                                                    parameter_record_note_taker_id:"",//记录id
                                                                                                    parameter_record_describe:"",//描述
                                                                                                    parameter_record_value_type:"",////
                                                                                                    parameter_record_id:""
                                                                                                  }
                                                                                                  req.craft_workstep_parameter_main_id = parameteRecordId
                                                                                                  req.workstage_id = workstageId
                                                                                                  req.standard_parameter_type_id = parametertypeId
                                                                                                  req.work_order_id = workOrderId
                                                                                                  req.parameter_record_value_type = ParameteValueType
                                                                                                  req.parameter_record_id = parameteRecordIds

                                                                                                  let thisTr =currentTr.find("td")
                                                                                                  req.parameter_record_steady_state_value = thisTr.eq(1).find("input").val()
                                                                                                  req.parameter_record_note_taker = thisTr.eq(2).text()
                                                                                                  req.parameter_record_note_taker_id = thisTr.eq(2).attr("takerId")
                                                                                                  req.parameter_record_write_time = thisTr.eq(3).find("input").val()
                                                                                                  req.parameter_record_describe = thisTr.eq(1).find("input").val()

                                                                                                  let req2=[], req3
                                                                                                  req2.push(req)
                                                                                                  req3 = JSON.stringify(req2)

                                                                                                  swal({
                                                                                                    title: '您确定要修改吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:saveWorkOrderParameteRecordUrl,
                                                                                                      data: {
                                                                                                        type:"modify",
                                                                                                        parameteRecords:req3,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                          swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                                case '#delete' :{
                                                                                                  swal({
                                                                                                    title: '您确定要删除吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:removeWorkOrderParameteRecordUrl,
                                                                                                      data: {
                                                                                                        parameteRecordIds:parameteRecordIdsList,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                          swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                              }
                                                                                            })

                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.parameteRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              panelTbody.empty().append(NO_DATA_NOTICE)

                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderParameteRecordUrl, {
                                                                        parameteId:parameteId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: EnvirParamersList.length , // 总行数
                                                      displayRow:EnvirParamersList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })
                                                    //panel3  半成品参数

                                                  if(semiProParamersList.length!==0){
                                                    mesVerticalTableAddData(panel_4, {
                                                      thead: {
                                                        theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                        theadWidth: '4%/15%/15%/15%/15%/15%'
                                                      },
                                                      tbody: {
                                                        html: [
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                        ],

                                                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                        dataAddress: function (tbodyTarget, html, result) {
                                                          tbodyTarget.empty() // 清空表格主体
                                                          let  dataList = semiProParamersList, // 主要数据列表
                                                              tempData = null; // 表格td内的临时数据
                                                          for (let i = 0, len = dataList.length; i < len; i++) {
                                                            tbodyTarget.append('<tr></tr>'); // 添加行
                                                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                            for (let i = 0, len = html.length; i < len; i++) {
                                                              currentTr.append(html[i]); // 添加表格内的HTML
                                                              switch (i) {
                                                                case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                                case 1: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                  // tempData=
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;
                                                                case 2: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  if(tempData = "constantValue"){
                                                                    currentTr.children().eq(i).html( "固定值")
                                                                  }else if(tempData = "rangeValue"){
                                                                    currentTr.children().eq(i).html("范围值")
                                                                  }else if(tempData = "deviationValue"){
                                                                    currentTr.children().eq(i).html("浮动值")
                                                                  }
                                                                }
                                                                  break;
                                                                case 3: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                  let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                  let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                  let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                                }
                                                                  break;
                                                                case 4: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;

                                                                case 5:
                                                                  currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                    parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                    parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                    workstageId = dataList[currentTr.index()].workstage_id,
                                                                    parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                    ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type
                                                                    switch (dataContent) {
                                                                      case '#detailModal': {	//详情
                                                                        let dataContent = $('#detailModal2'),
                                                                          panelList = dataContent.find('.panel'),
                                                                          modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                          panelThead = panelList.find('thead'),
                                                                          panelTbody = panelList.find('tbody');
                                                                          panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                          dataContent.modal({
                                                                            backdrop: false, // 黑色遮罩不可点击
                                                                            keyboard: false,  // esc按键不可弃用模态框
                                                                            show: false
                                                                          })
                                                                          dataContent.modal('show') // 运行时显示
                                                                          dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                            $('body').addClass('modal-open')
                                                                          })

                                                                          modalCloseBtn.off('click').on('click', (event) => {
                                                                            // 点击弃用按钮隐藏该模态框
                                                                            dataContent.modal('hide')
                                                                            // 初始化表格
                                                                            panelList.find('thead').empty()
                                                                            panelList.find('tbody').empty()
                                                                          })

                                                                        // 主表格添加内容
                                                                        function addTableData(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {
                                                                                //panel1
                                                                                mesVerticalTableAddData(panelList, {
                                                                                  thead: {
                                                                                    theadContent: '序号/实际值/记录人/记录时间/备注/操作',
                                                                                    theadWidth: '6%/15%/15%/15%/15%/15%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                        dataList = map.parameteRecords, // 主要数据列表
                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_steady_state_value;

                                                                                              let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                              currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                              currentTr.children().eq(i).html(inputHtml)

                                                                                              currentTr.children().eq(i).find('input').val(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                              let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                              currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                              currentTr.children().eq(i).html(inputHtml)

                                                                                              currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                              let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                              currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                              currentTr.children().eq(i).html(inputHtml)

                                                                                              currentTr.children().eq(i).find('input').val(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                                parameteRecordIds = dataList[currentTr.index()].parameter_record_id,
                                                                                                parameteRecordIdsList=[]
                                                                                                parameteRecordIdsList.push(parameteRecordIds)
                                                                                                switch (dataContent) {
                                                                                                  case '#edit': {	//
                                                                                                    req={
                                                                                                      craft_workstep_parameter_main_id:"",//参数id//
                                                                                                      craft_workstep_parameter_id:"",//参数id
                                                                                                      standard_parameter_type_id:"",//参数lx id//
                                                                                                      workstage_id:"",//工序id//
                                                                                                      work_order_id:"",//工序id//
                                                                                                      parameter_record_steady_state_value:"",//参数记录值
                                                                                                      parameter_record_write_time:"",//记录时间
                                                                                                      parameter_record_note_taker:"",//记录人
                                                                                                      parameter_record_note_taker_id:"",//记录id
                                                                                                      parameter_record_describe:"",//描述
                                                                                                      parameter_record_value_type:"",////
                                                                                                      parameter_record_id:""
                                                                                                    }
                                                                                                    req.craft_workstep_parameter_main_id = parameteRecordId
                                                                                                    req.workstage_id = workstageId
                                                                                                    req.standard_parameter_type_id = parametertypeId
                                                                                                    req.work_order_id = workOrderId
                                                                                                    req.parameter_record_value_type = ParameteValueType
                                                                                                    req.parameter_record_id = parameteRecordIds

                                                                                                    let thisTr =currentTr.find("td")
                                                                                                    req.parameter_record_steady_state_value = thisTr.eq(1).find("input").val()
                                                                                                    req.parameter_record_note_taker = thisTr.eq(2).text()
                                                                                                    req.parameter_record_note_taker_id = thisTr.eq(2).attr("takerId")
                                                                                                    req.parameter_record_write_time = thisTr.eq(3).find("input").val()
                                                                                                    req.parameter_record_describe = thisTr.eq(1).find("input").val()

                                                                                                    let req2=[], req3
                                                                                                    req2.push(req)
                                                                                                    req3 = JSON.stringify(req2)

                                                                                                    swal({
                                                                                                      title: '您确定要修改吗？',
                                                                                                      type: 'question',
                                                                                                      showCancelButton: true,
                                                                                                      confirmButtonText: '确定',
                                                                                                      cancelButtonText: '取消'
                                                                                                    }).then(function (){
                                                                                                      $.ajax({
                                                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                        url:saveWorkOrderParameteRecordUrl,
                                                                                                        data: {
                                                                                                          type:"modify",
                                                                                                          parameteRecords:req3,
                                                                                                        },
                                                                                                        success: function (result, status, xhr) {
                                                                                                          if (result.status === 0) {
                                                                                                            let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                            swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                          }else {
                                                                                                            swal({
                                                                                                              title: '删除失败',
                                                                                                              type: 'warning',
                                                                                                              timer: '1000',
                                                                                                              allowEscapeKey: false, // 用户按esc键不退出
                                                                                                              allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                              showCancelButton: false, // 显示用户取消按钮
                                                                                                              showConfirmButton: false, // 显示用户确认按钮
                                                                                                          })
                                                                                                          }
                                                                                                        },
                                                                                                      })
                                                                                                    })
                                                                                                    break;
                                                                                                  }
                                                                                                  case '#delete' :{
                                                                                                    swal({
                                                                                                      title: '您确定要删除吗？',
                                                                                                      type: 'question',
                                                                                                      showCancelButton: true,
                                                                                                      confirmButtonText: '确定',
                                                                                                      cancelButtonText: '取消'
                                                                                                    }).then(function (){
                                                                                                      $.ajax({
                                                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                        url:removeWorkOrderParameteRecordUrl,
                                                                                                        data: {
                                                                                                          parameteRecordIds:parameteRecordIdsList,
                                                                                                        },
                                                                                                        success: function (result, status, xhr) {
                                                                                                          if (result.status === 0) {
                                                                                                            let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                            swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                          }else {
                                                                                                            swal({
                                                                                                              title: '删除失败',
                                                                                                              type: 'warning',
                                                                                                              timer: '1000',
                                                                                                              allowEscapeKey: false, // 用户按esc键不退出
                                                                                                              allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                              showCancelButton: false, // 显示用户取消按钮
                                                                                                              showConfirmButton: false, // 显示用户确认按钮
                                                                                                          })
                                                                                                          }
                                                                                                        },
                                                                                                      })
                                                                                                    })
                                                                                                    break;
                                                                                                  }
                                                                                                }
                                                                                              })

                                                                                            }
                                                                                              break;


                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.line, // 总行数
                                                                                    displayRow: result.map.parameteRecords.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })


                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }

                                                                        // 导航栏点击时运行数据加载
                                                                        addTableData(queryWorkOrderParameteRecordUrl, {
                                                                          parameteId:parameteId,
                                                                          headNum: 1
                                                                        });

                                                                        break;
                                                                      }


                                                                    }
                                                                  })
                                                                  break;
                                                                default:
                                                                  break;
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },

                                                      pagination: {
                                                        totalRow: semiProParamersList.length, // 总行数
                                                        displayRow: semiProParamersList.length // 显示行数
                                                      },

                                                      ajax: {
                                                        url: url,
                                                        data: data
                                                      }
                                                    })
                                                  }else{
                                                    panel_4.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                  }


                                                  // panel3  其他
                                                  if(otherParamersList.length!==0){
                                                    mesVerticalTableAddData(panel_5, {
                                                      thead: {
                                                        theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                        theadWidth: '4%/15%/15%/15%/15%/15%'
                                                      },
                                                      tbody: {
                                                        html: [
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                        ],

                                                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                        dataAddress: function (tbodyTarget, html, result) {
                                                          tbodyTarget.empty() // 清空表格主体
                                                          let dataList = otherParamersList, // 主要数据列表
                                                          tempData = null; // 表格td内的临时数据
                                                          for (let i = 0, len = dataList.length; i < len; i++) {
                                                            tbodyTarget.append('<tr></tr>'); // 添加行
                                                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                            for (let i = 0, len = html.length; i < len; i++) {
                                                              currentTr.append(html[i]); // 添加表格内的HTML
                                                              switch (i) {
                                                                case 0:
                                                                  currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                  break;
                                                                case 1: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                  // tempData=
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;
                                                                case 2: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  if(tempData = "constantValue"){
                                                                    currentTr.children().eq(i).html( "固定值")
                                                                  }else if(tempData = "rangeValue"){
                                                                    currentTr.children().eq(i).html("范围值")
                                                                  }else if(tempData = "deviationValue"){
                                                                    currentTr.children().eq(i).html("浮动值")
                                                                  }
                                                                }
                                                                  break;
                                                                case 3: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                  let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                  let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                  let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                                }
                                                                  break;
                                                                case 4: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;

                                                                case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  workstageId = dataList[currentTr.index()].workstage_id,
                                                                  parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                  ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type
                                                                  switch (dataContent) {
                                                                    case '#detailModal': {	//详情
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/实际值/记录人/记录时间/备注/操作',
                                                                                  theadWidth: '6%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.parameteRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              parameteRecordIds = dataList[currentTr.index()].parameter_record_id,
                                                                                              parameteRecordIdsList=[]
                                                                                              parameteRecordIdsList.push(parameteRecordIds)
                                                                                              switch (dataContent) {
                                                                                                case '#edit': {	//
                                                                                                  req={
                                                                                                    craft_workstep_parameter_main_id:"",//参数id//
                                                                                                    craft_workstep_parameter_id:"",//参数id
                                                                                                    standard_parameter_type_id:"",//参数lx id//
                                                                                                    workstage_id:"",//工序id//
                                                                                                    work_order_id:"",//工序id//
                                                                                                    parameter_record_steady_state_value:"",//参数记录值
                                                                                                    parameter_record_write_time:"",//记录时间
                                                                                                    parameter_record_note_taker:"",//记录人
                                                                                                    parameter_record_note_taker_id:"",//记录id
                                                                                                    parameter_record_describe:"",//描述
                                                                                                    parameter_record_value_type:"",////
                                                                                                    parameter_record_id:""
                                                                                                  }
                                                                                                  req.craft_workstep_parameter_main_id = parameteRecordId
                                                                                                  req.workstage_id = workstageId
                                                                                                  req.standard_parameter_type_id = parametertypeId
                                                                                                  req.work_order_id = workOrderId
                                                                                                  req.parameter_record_value_type = ParameteValueType
                                                                                                  req.parameter_record_id = parameteRecordIds

                                                                                                  let thisTr =currentTr.find("td")
                                                                                                  req.parameter_record_steady_state_value = thisTr.eq(1).find("input").val()
                                                                                                  req.parameter_record_note_taker = thisTr.eq(2).text()
                                                                                                  req.parameter_record_note_taker_id = thisTr.eq(2).attr("takerId")
                                                                                                  req.parameter_record_write_time = thisTr.eq(3).find("input").val()
                                                                                                  req.parameter_record_describe = thisTr.eq(1).find("input").val()

                                                                                                  let req2=[], req3
                                                                                                  req2.push(req)
                                                                                                  req3 = JSON.stringify(req2)

                                                                                                  swal({
                                                                                                    title: '您确定要修改吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:saveWorkOrderParameteRecordUrl,
                                                                                                      data: {
                                                                                                        type:"modify",
                                                                                                        parameteRecords:req3,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                          swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                                case '#delete' :{
                                                                                                  swal({
                                                                                                    title: '您确定要删除吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:removeWorkOrderParameteRecordUrl,
                                                                                                      data: {
                                                                                                        parameteRecordIds:parameteRecordIdsList,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                          swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                              }
                                                                                            })

                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.parameteRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              panelTbody.empty().append(NO_DATA_NOTICE)
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderParameteRecordUrl, {
                                                                        parameteId:parameteId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                  break;
                                                                default:
                                                                  break;
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },

                                                      pagination: {
                                                        totalRow:otherParamersList.length, // 总行数
                                                        displayRow: otherParamersList.length // 显示行数
                                                      },

                                                      ajax: {
                                                        url: url,
                                                        data: data
                                                      }
                                                    })
                                                  }else{
                                                    panel_5.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                  }


                                                }
                                                else {
                                                  mesloadBox.warningShow();
                                                }
                                              }
                                            })
                                          }

                                          addTableData(queryWorkOrderParticularsUrl, {
                                            workOrderId:workOrderId
                                          });
                                          addTableData2(queryWorkstageParticularsUrl, {
                                            // workstageIds:["283b7b8fd83040d789b0dec1b88d79e5"]
                                            workstageIds:workstageId
                                          });

                                        }


                                        break;
                                      }
                                      case "#processDetails": { //过程详情
                                        let dataContent = $('#detailModal8'),
                                        panelList = dataContent.find('.panel'),
                                        modalCloseBtn = dataContent.find('.modal-header').find('.close')
                                        panelList.find('.panel-heading').find('.modal-title').text('工单过程详情') // 更换panel标题

                                        dataContent.modal('show') // 运行时显示

                                        modalCloseBtn.off('click').on('click', (event) => {
                                          // 点击弃用按钮隐藏该模态框
                                          dataContent.modal('hide')
                                          // 初始化表格
                                          panelList.find("ul").empty()
                                        })

                                        // 主表格添加内容
                                        function addTableData(url, data) {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: url,
                                            data: data,
                                            beforeSend: function (xml) {
                                              // ajax发送前
                                              mesloadBox.loadingShow()
                                            },
                                            success: function (result, status, xhr) {
                                              // ajax成功
                                              mesloadBox.hide()
                                              if (result.status === 0) {
                                                let map = result.map, // 映射
                                                dataList = map.processRecord ,// 主要数据列表
                                                html=""
                                                $.each(dataList,function(i,p){
                                                let tempData = p.process_records_operation_time;
                                                tempData=moment(tempData).format('YYYY-MM-DD HH:mm')
                                                html+=`<li>${p.process_records_operator}在${tempData}${p.process_records_operation_executive}<li/>`
                                                })
                                                panelList.find("ul").html(html)
                                              }
                                              else {
                                                mesloadBox.warningShow();
                                              }
                                            }
                                          })
                                        }

                                        // 导航栏点击时运行数据加载
                                        addTableData(queryWorkOrderProcessParticularsUrl, {
                                          workOrderId:workOrderId,
                                          headNum:1
                                        });

                                        panelList.find(".about4_main ul li:first-child").css("height",30)
                                        panelList.find(".about4_main ul li:last-child").prev().css("height",30)
                                        let h = panelList.find(".about4_main ul li:first-child").height()/2;//<!--第一个li高度的一半-->
                                        let h1 = panelList.find(".about4_main ul li:last-child").prev().height()/2;//<!--第一个li高度的一半--

                                        console.log(h)
                                        console.log(h1)
                                        console.log($(".about4_main").height())

                                        panelList.find(".line").css("top",35);
                                        panelList.find(".line").css("bottom",35);
                                        panelList.find(".line").height($(".about4_main").height()-h1-h);
                                        console.log($(".line").height())



                                        break;
                                      }
                                      case '#addExecutionRecordn': {	//添加执行记录
                                        let dataContent = $('#workOrderDetailModal'),
                                        panelList = dataContent.find('.panel'),
                                        panel_1=panelList.eq(0),
                                        panel_2=panelList.eq(1),
                                        panel_3=panelList.eq(2),
                                        panel_4=panelList.eq(3),
                                        panel_5=panelList.eq(4),
                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                        modalSubmitBtn = dataContent.find('.modal-submit')


                                        panel_1.find('.panel-heading').find('.panel-title').text("基本详情") // 更换panel标题
                                        panel_2.find('.panel-heading').find('.panel-title').text("工步") // 更换panel标题
                                        panel_3.find('.panel-heading').find('.panel-title').text("环境参数") // 更换panel标题
                                        panel_4.find('.panel-heading').find('.panel-title').text("半成品参数") // 更换panel标题
                                        panel_5.find('.panel-heading').find('.panel-title').text("其他") // 更换panel标题

                                        dataContent.modal({
                                          backdrop: false, // 黑色遮罩不可点击
                                          keyboard: false,  // esc按键不可弃用模态框
                                          show: false
                                        })
                                        dataContent.modal('show') // 运行时显示
                                        modalSubmitBtn.hide()

                                        // dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                        //   $('body').addClass('modal-open')
                                        // })

                                        modalCloseBtn.off('click').on('click', (event) => {
                                          // 点击弃用按钮隐藏该模态框
                                          dataContent.modal('hide')
                                          // 初始化表格
                                          panel_2.find("tbody").empty()
                                          panel_3.find("tbody").empty()
                                          panel_4.find("tbody").empty()
                                          panel_5.find("tbody").empty()
                                        })
                                        // 添加主体表单数据
                                        function addTableData(url, data) {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: url,
                                            data: data,
                                            beforeSend: function (xml) {
                                              // ajax发送前
                                              mesloadBox.loadingShow()
                                            },
                                            success: function (result, status, xhr) {
                                              // ajax成功
                                              mesloadBox.hide()
                                              if (result.status === 0) {
                                                //panel1 基础消息
                                                mesHorizontalTableAddData(panel_1.find('table'), null, {
                                                  thead: '工单号/所属生产批号/产品型号/工艺/工艺版本/工序/工序优率/工序负责人/极性/半成品类型/半成品型号/预计产出量/半成品单位/生产线/生产车间/生产优先级/工单创建人/工单负责人/工单创建时间/预定开始日期/预定完成时间/实际产出量/实际开始时间/实际完成日期/班次',
                                                  tableWitch: '15%/15%/15%',
                                                  viewColGroup: 3,
                                                  importStaticData: (tbodyTd, length) => {
                                                    let map = result.map, // 映射
                                                    dataList = map.workOrder, // 主要数据列表
                                                    selectHtml = `<select class="form-control table-input input-sm"></select>`,
                                                    tempData = null; // 表格td内的临时数据

                                                    for (let i = 0, len = length; i < len; i++) {
                                                      switch (i) {
                                                        case 0: {
                                                          tempData = dataList.work_order_number
                                                          tbodyTd.eq(i).html(tempData);
                                                        }
                                                          break;
                                                        case 1: {
                                                          tempData = dataList.plan.production_plan_batch_number;
                                                          tbodyTd.eq(i).html(tempData);
                                                        }
                                                          break;
                                                        case 2: {
                                                          tempData =  dataList.plan.product_model_name
                                                          tbodyTd.eq(i).html(tempData)
                                                        }
                                                        break;
                                                        case 3: {
                                                          tempData = dataList.plan.craft_name
                                                          tbodyTd.eq(i).html(tempData)
                                                        }
                                                        break;
                                                        case 4: {
                                                          tempData = dataList.plan.craft_versions
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 5: {
                                                          tempData =dataList.planQuotesWorkstage.workstage_name
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 6: {
                                                          tempData =dataList.planQuotesWorkstage.workstage_quality_rate
                                                           tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 7: {
                                                          tempData =dataList.planQuotesWorkstage.workstage_responsible
                                                           tbodyTd.eq(i).html(tempData)
                                                        }
                                                        break;
                                                        case 8: {
                                                          tempData =dataList.planQuotesWorkstage.workstage_polarity
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 9: {
                                                          tempData = dataList.planQuotesWorkstage.semi_finish_type_name
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 10: {
                                                          tempData = dataList.planQuotesWorkstage.semi_finish_genre
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 11: {
                                                          tempData = dataList.work_order_expected_output
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 12: {

                                                          tempData = dataList.planQuotesWorkstage.semi_finish_unit
                                                          tbodyTd.eq(i).html(tempData)
                                                        }
                                                        break;
                                                        case 13: {
                                                          tempData = dataList.plan.product_line_name
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 14: {
                                                          tempData = dataList.plan.product_line_name
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 15: {
                                                          tempData = dataList.plan.production_plan_production_priority
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 16: {
                                                          tempData = dataList.work_order_creators
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 17: {
                                                          tempData = dataList.work_order_responsible
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 18: {
                                                          tempData = dataList.work_order_creation_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 19: {
                                                          tempData = dataList.work_order_scheduled_start_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 20: {
                                                          tempData = dataList.work_order_estimated_completion_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 21: {
                                                          tempData = dataList.work_order_actual_output
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 22: {
                                                          tempData = dataList.work_order_actual_start_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 23: {
                                                          tempData = dataList.work_order_actual_finish_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 24: {
                                                          tempData = dataList.work_order_classes
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        default:
                                                          break;
                                                      }
                                                    }

                                                  }
                                                })
                                              }
                                              else {
                                                mesloadBox.warningShow();
                                              }
                                            }
                                          })
                                        }
                                        function addTableData2(url, data) {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: url,
                                            data: data,
                                            beforeSend: function (xml) {
                                              // ajax发送前
                                              mesloadBox.loadingShow()
                                            },
                                            success: function (result, status, xhr) {
                                              // ajax成功
                                              mesloadBox.hide()
                                              if (result.status === 0) {
                                                let parmList = result.map.workstageList[0].useParametersList,
                                                semiProParamersList=[],//半成品参数集合
                                                EnvirParamersList=[],//环境参数集合
                                                otherParamersList=[]//其他参数集合

                                                // for(var i=0;i<parmList.length;i++){
                                                //   if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                //     EnvirParamersList.push(parmList[i])
                                                //   }else if(parmList[i].standard_parameter_type_id === semiProParamersTypeId){
                                                //     semiProParamersList.push(parmList[i])
                                                //   }else{
                                                //     otherParamersList.push(parmList[i])
                                                //   }
                                                // }
                                                for(var i=0;i<parmList.length;i++){
                                                  if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                    EnvirParamersList.push(parmList[i])
                                                  }else{
                                                    semiProParamersList.push(parmList[i])
                                                  }
                                                }

                                                //panel2 工步
                                                mesVerticalTableAddData(panel_2, {
                                                  thead: {
                                                    theadContent: '序号/工步名称/工步版本/工步编号/操作',
                                                    theadWidth: '6%/10%/10%/10%/35%'
                                                  },
                                                  tbody: {
                                                    html: [
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      // '<td></td>',
                                                      // '<td></td>',
                                                      '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal3"><i class="fa fa-tasks fa-fw"></i>添加物料使用详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#stepParm"><i class="fa fa-tasks fa-fw"></i>添加工步参数记录</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#devicesOperate"><i class="fa fa-tasks fa-fw"></i>添加设备操作记录</a></td>'
                                                    ],

                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                    dataAddress: function (tbodyTarget, html, result) {
                                                      tbodyTarget.empty() // 清空表格主体
                                                      let map = result.map, // 映射zszs
                                                      dataList = map.workstageList[0].stageAndStepRelationList, // 主要数据列表
                                                      tempData = null; // 表格td内的临时数据
                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                          switch (i) {
                                                            case 0:
                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                              break;
                                                            case 1: {
                                                              tempData = dataList[currentTr.index()].workstep.craft_control_workstep_name;
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;
                                                            case 2: {
                                                              tempData = dataList[currentTr.index()].workstep.craft_control_workstep_version;
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;
                                                            case 3: {
                                                              tempData = dataList[currentTr.index()].workstep.craft_control_workstep_num;
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;
                                                            case 4:
                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                stepList = []
                                                                stepId = dataList[currentTr.index()].workstep.craft_control_workstep_id;
                                                                stepList.push(stepId)
                                                                switch (dataContent) {
                                                                  case '#detailModal3': {	//添加物料使用详情
                                                                    let dataContent = $('#submitModelModal3'),
                                                                      panelList = dataContent.find('.panel'),
                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                      modalSubmitBtn = dataContent.find('.modal-submit')
                                                                      panelList.find('.panel-heading').find('.panel-title').text("添加投料详情") // 更换panel标题


                                                                      dataContent.modal({
                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                        show: false
                                                                      })

                                                                      dataContent.modal('show') // 运行时显示
                                                                      modalSubmitBtn.hide()

                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                        $('body').addClass('modal-open')
                                                                      })

                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                        // 点击弃用按钮隐藏该模态框
                                                                        dataContent.modal('hide')
                                                                        // 初始化表格
                                                                        panelList.find('thead').empty()
                                                                        panelList.find('tbody').empty()
                                                                      })

                                                                    // 主表格添加内容
                                                                    function addTableData(url, data) {
                                                                      $.ajax({
                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                        url: url,
                                                                        data: data,
                                                                        beforeSend: function (xml) {
                                                                          // ajax发送前
                                                                          mesloadBox.loadingShow()
                                                                        },
                                                                        success: function (result, status, xhr) {
                                                                          // ajax成功
                                                                          mesloadBox.hide()
                                                                          if (result.status === 0) {
                                                                            //panel1
                                                                            mesVerticalTableAddData(panelList, {
                                                                              thead: {
                                                                                theadContent: '序号/物料名称/规格/型号/单位/操作',
                                                                                theadWidth: '4%/15%/15%/15%/15%/15%'
                                                                              },
                                                                              tbody: {
                                                                                html: [
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#add"><i class="fa fa-tasks fa-fw"></i>添加</a></td>'
                                                                                ],

                                                                                // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                dataAddress: function (tbodyTarget, html, result) {
                                                                                  tbodyTarget.empty() // 清空表格主体
                                                                                  let map = result.map, // 映射zszs
                                                                                  dataList = map.workstepList[0].useMaterielList, // 主要数据列表
                                                                                    tempData = null; // 表格td内的临时数据
                                                                                  for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                    tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                    let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                    for (let i = 0, len = html.length; i < len; i++) {
                                                                                      currentTr.append(html[i]); // 添加表格内的HTML
                                                                                      switch (i) {
                                                                                        case 0:
                                                                                          currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                          break;
                                                                                        case 1: {
                                                                                          tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                          // tempData=
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 2: {
                                                                                          tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 3: {
                                                                                          tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 4: {
                                                                                          tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;

                                                                                        case 5:
                                                                                          currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                            let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                             materielID = dataList[currentTr.index()].craft_materiel_id;
                                                                                             mainMaterielID = dataList[currentTr.index()].craft_materiel_main_id;
                                                                                             materielUnit= dataList[currentTr.index()].craft_materiel_unit;
                                                                                             materielName= dataList[currentTr.index()].craft_materiel_name;
                                                                                             materielSpecifications= dataList[currentTr.index()].craft_materiel_specifications;
                                                                                             materielModel= dataList[currentTr.index()].craft_materiel_model;
                                                                                            switch (dataContent) {
                                                                                              case '#add': {	//t添加
                                                                                                let dataContent = $('#submitModelModal4'),
                                                                                                  panelList = dataContent.find('.panel'),
                                                                                                  modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                  panelThead = panelList.find('thead'),
                                                                                                  panelTbody = panelList.find('tbody'),
                                                                                                  modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                                                  headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                                                  panelList.find('.panel-heading').find('.panel-title').text('添加物料记录') // 更换panel标题

                                                                                                  dataContent.modal({
                                                                                                    backdrop: false, // 黑色遮罩不可点击
                                                                                                    keyboard: false,  // esc按键不可弃用模态框
                                                                                                    show: false
                                                                                                  })

                                                                                                  dataContent.modal('show') // 运行时显示
                                                                                                  dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                    $('body').addClass('modal-open')
                                                                                                  })

                                                                                                  modalCloseBtn.off('click').on('click', (event) => {
                                                                                                    // 点击弃用按钮隐藏该模态框
                                                                                                    dataContent.modal('hide')
                                                                                                    // 初始化表格
                                                                                                    panelList.find('thead').empty()
                                                                                                    panelList.find('tbody').empty()
                                                                                                  })
                                                                                                  let term= `
                                                                                                  <tr>
                                                                                                  <th style="width:5%">序号</th>
                                                                                                  <th style="width:10%">投料时间</th>
                                                                                                  <th style="width:8%"> 使用数量</th>
                                                                                                  <th style="width:8%"> 物料编号</th>
                                                                                                  <th style="width:8%">投料人</th>
                                                                                                  <th style="width:8%">备注</th>
                                                                                                  <th style="width:18%">操作</th>
                                                                                                  </tr>
                                                                                                  `
                                                                                                  panelThead.empty().append(term)

                                                                                                  headingMainBtn_1.off('click').on('click', (event) => {
                                                                                                    let term2 =`
                                                                                                    <tr>
                                                                                                      <td ></td>
                                                                                                      <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input class="table-input" type="text" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input class="table-input" type="text" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                                                      <td class="table-input-td">
                                                                                                        <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                                                        <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                                                        <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                                                      </td>
                                                                                                    </tr>
                                                                                                    `
                                                                                                    panelTbody.append(term2)

                                                                                                    let tr = panelTbody.find('tr');
                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      // panel_table.find('tbody').append(temStr)
                                                                                                      panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                                                      ;
                                                                                                    }

                                                                                                    panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                                                      // 添加员工选择模态框
                                                                                                      let $this = $(this),
                                                                                                        promise = new Promise(function (resolve, reject) {
                                                                                                        selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                                                      });
                                                                                                      promise.then(function (resolveData) {
                                                                                                        $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                                                        // submithData.creator = resolveData.roleStaffId
                                                                                                      })

                                                                                                      $this.prop('readonly', true) // 输入框只读
                                                                                                      $this.off('blur').on('blur', () => {
                                                                                                        $this.removeProp('readonly') // 输入移除框只读
                                                                                                      })

                                                                                                    })

                                                                                                  })

                                                                                                  headingMainBtn_1.trigger('click')		//默认添加一行


                                                                                                  panelList.off('click').on('click', 'tr td a', function(event) {
                                                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                                                    let tr = panelTbody.find('tr');
                                                                                                    switch (dataContent) {
                                                                                                      case "delete":{
                                                                                                        $(this).closest('tr').remove();
                                                                                                      }
                                                                                                        break;
                                                                                                      case "down":{
                                                                                                        let thisTr=$(this).closest('tr');
                                                                                                        if(thisTr.index()!=tr.length-1){
                                                                                                          thisTr.fadeOut().fadeIn();
                                                                                                          thisTr.next().after(thisTr);
                                                                                                          }
                                                                                                      }
                                                                                                        break;
                                                                                                      case "up":{
                                                                                                        let thisTr=$(this).closest('tr');  //
                                                                                                        if(thisTr.index()!=0){
                                                                                                          thisTr.fadeOut().fadeIn();
                                                                                                          thisTr.prev().before(thisTr);
                                                                                                        }
                                                                                                      }
                                                                                                        break;
                                                                                                    }

                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                                                      ;
                                                                                                    }
                                                                                                  });

                                                                                                  modalSubmitBtn.off("click").on("click",(event)=>{
                                                                                                    let tr = panelTbody.find('tr'),
                                                                                                    materialUseRecords=[]

                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      let $td = tr.eq(i).find('td')
                                                                                                      req={
                                                                                                        craft_materiel_id:"",//使用物料id
                                                                                                        craft_materiel_main_id:"",//工步物料使用列表id
                                                                                                        step_use_material_time:"",//使用时间
                                                                                                        step_use_material_amount:"",//使用数量
                                                                                                        step_use_material_user:"",//使用人
                                                                                                        step_use_material_user_id:"",//使用人id
                                                                                                        step_use_material_describe:"",//备注
                                                                                                        craft_materiel_unit:"",
                                                                                                        craft_materiel_name:"",
                                                                                                        craft_materiel_specifications:"",
                                                                                                        craft_materiel_model:"",
                                                                                                        work_order_id:"",
                                                                                                        step_use_material_number:""
                                                                                                      }
                                                                                                      req.craft_materiel_id=materielID
                                                                                                      req.craft_materiel_main_id=mainMaterielID
                                                                                                      req.craft_materiel_unit=materielUnit
                                                                                                      req.craft_materiel_name=materielName
                                                                                                      req.craft_materiel_specifications=materielSpecifications
                                                                                                      req.craft_materiel_model=materielModel
                                                                                                      req.work_order_id=workOrderId

                                                                                                      for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                                                        switch (i) {
                                                                                                          case 0: {

                                                                                                            break;
                                                                                                          }
                                                                                                          case 1: {
                                                                                                            req.step_use_material_time = $td.eq(i).find('input').val()
                                                                                                            break;
                                                                                                          }
                                                                                                          case 2: {
                                                                                                            req.step_use_material_amount = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 3: {
                                                                                                            req.step_use_material_number = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 4: {
                                                                                                            req.step_use_material_user= $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            req.step_use_material_user_id = $td.eq(i).find('input').attr("principal");

                                                                                                            break;
                                                                                                          }
                                                                                                          case 5: {
                                                                                                            req.step_use_material_describe = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }

                                                                                                        }
                                                                                                      }
                                                                                                      materialUseRecords.push(req)

                                                                                                    }
                                                                                                    let materialUseRecords2
                                                                                                    materialUseRecords2= JSON.stringify(materialUseRecords);
                                                                                                    if (true
                                                                                                    ) {
                                                                                                      swal({
                                                                                                        title: '您确定要提交本次操作吗?',
                                                                                                        text: '请确保填写信息无误后点击确定按钮',
                                                                                                        type: 'question',
                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                        showCancelButton: true, // 显示用户取消按钮
                                                                                                        confirmButtonText: '确定',
                                                                                                        cancelButtonText: '取消',
                                                                                                      }).then(function () {
                                                                                                        $.ajax({
                                                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                          url: saveWorkOrderMaterialUseRecordUrl,
                                                                                                          data: {
                                                                                                            type:"save",
                                                                                                            materialUseRecords:materialUseRecords2
                                                                                                          },
                                                                                                          success: function (result, status, xhr) {
                                                                                                            if (result.status === 0) {
                                                                                                              swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                                                            }else if(result.status !== 0) {
                                                                                                              let msg = result.msg
                                                                                                              if(msg!==null){
                                                                                                                swallFail2(msg)
                                                                                                              }else{
                                                                                                                swallError();	//格式不正确
                                                                                                              }

                                                                                                            }
                                                                                                          }
                                                                                                        })
                                                                                                      });
                                                                                                    }
                                                                                                    else {
                                                                                                      swallError();	//格式不正确
                                                                                                    }

                                                                                                  })


                                                                                                break;
                                                                                              }
                                                                                            }
                                                                                          })
                                                                                          break;
                                                                                        default:
                                                                                          break;
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                }
                                                                              },

                                                                              pagination: {
                                                                                totalRow:result.map.workstepList[0].useMaterielList.length, // 总行数
                                                                                displayRow: result.map.workstepList[0].useMaterielList.length // 显示行数
                                                                              },

                                                                              ajax: {
                                                                                url: url,
                                                                                data: data
                                                                              }
                                                                            })
                                                                          }
                                                                          else {
                                                                            mesloadBox.warningShow();
                                                                          }
                                                                        }
                                                                      })
                                                                    }

                                                                    // 导航栏点击时运行数据加载
                                                                    addTableData(queryStepParticularsUrl, {
                                                                      stepIds:["0167c491214a45bc96e1523026d1f7f0"],
                                                                    });

                                                                    break;
                                                                  }
                                                                  case '#stepParm': {	//工步参数记录详情
                                                                    let dataContent = $('#submitModelModal3'),
                                                                      panelList = dataContent.find('.panel'),
                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                      modalSubmitBtn = dataContent.find('.modal-submit')
                                                                      panelList.find('.panel-heading').find('.panel-title').text("添加工步参数详情")// 更换panel标题


                                                                      dataContent.modal({
                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                        show: false
                                                                      })

                                                                      dataContent.modal('show') // 运行时显示
                                                                      modalSubmitBtn.hide()
                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                        $('body').addClass('modal-open')
                                                                      })

                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                        // 点击弃用按钮隐藏该模态框
                                                                        dataContent.modal('hide')
                                                                        // 初始化表格
                                                                        panelList.find('thead').empty()
                                                                        panelList.find('tbody').empty()
                                                                      })

                                                                    // 主表格添加内容
                                                                    function addTableData(url, data) {
                                                                      $.ajax({
                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                        url: url,
                                                                        data: data,
                                                                        beforeSend: function (xml) {
                                                                          // ajax发送前
                                                                          mesloadBox.loadingShow()
                                                                        },
                                                                        success: function (result, status, xhr) {
                                                                          // ajax成功
                                                                          mesloadBox.hide()
                                                                          if (result.status === 0) {
                                                                            //panel1
                                                                            mesVerticalTableAddData(panelList, {
                                                                              thead: {
                                                                                theadContent: '序号/参数/值类型/参考值/单位/设备类型/操作',
                                                                                theadWidth: '6%/15%/15%/15%/15%/15%/15%'
                                                                              },
                                                                              tbody: {
                                                                                html: [
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#add"><i class="fa fa-tasks fa-fw"></i>添加</a></td>'
                                                                                ],

                                                                                // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                dataAddress: function (tbodyTarget, html, result) {
                                                                                  tbodyTarget.empty() // 清空表格主体
                                                                                  let map = result.map, // 映射zszs
                                                                                    dataList = map.workstepList[0].workstepParameterList, // 主要数据列表
                                                                                    tempData = null; // 表格td内的临时数据
                                                                                  for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                    tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                    let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                    for (let i = 0, len = html.length; i < len; i++) {
                                                                                      currentTr.append(html[i]); // 添加表格内的HTML
                                                                                      switch (i) {
                                                                                        case 0:
                                                                                          currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                          break;
                                                                                        case 1: {
                                                                                          tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                          // tempData=
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 2: {
                                                                                          tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                          if(tempData = "constantValue"){
                                                                                            currentTr.children().eq(i).html( "固定值")
                                                                                          }else if(tempData = "rangeValue"){
                                                                                            currentTr.children().eq(i).html("范围值")
                                                                                          }else if(tempData = "deviationValue"){
                                                                                            currentTr.children().eq(i).html("浮动值")
                                                                                          }
                                                                                        }
                                                                                          break;
                                                                                        case 3: {
                                                                                          tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                          let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                          let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                          let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                          let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                            if(tempData == "constantValue"){
                                                                                              currentTr.children().eq(i).html(constantValue)
                                                                                            }else if(tempData == "rangeValue"){
                                                                                              currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                            }else if(tempData == "deviationValue"){
                                                                                              currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                            }
                                                                                        }
                                                                                          break;
                                                                                        case 4: {
                                                                                          tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 5: {
                                                                                          tempData = dataList[currentTr.index()].devices_control_devices_type_id;
                                                                                          let 	selectHtml = `<select class="form-control table-input input-sm"></select>`
                                                                                          currentTr.children().eq(i).addClass('table-input-td')
                                                                                          currentTr.children().eq(i).html(selectHtml)

                                                                                          let target =  currentTr.children().eq(i).find('select');
                                                                                          for (let i = 0, len = devicesTypeList.length; i < len; i++) {
                                                                                            let optionStr = `<option value="${devicesTypeList[i].devices_control_devices_type_id}">${devicesTypeList[i].devices_control_devices_type_name}</option>`;
                                                                                            target.append(optionStr);
                                                                                          }
                                                                                          target.val(tempData).attr('disabled',true)
                                                                                        }
                                                                                          break;

                                                                                        case 6:
                                                                                          currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                            let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                            stepParameteId = dataList[currentTr.index()].craft_workstep_parameter_main_id,
                                                                                            unit = dataList[currentTr.index()].workstep_parameter_unit,
                                                                                            ParameteId = dataList[currentTr.index()].craft_control_workstep_id,
                                                                                            ParameteName = dataList[currentTr.index()].craft_workstep_parameter_name,
                                                                                            ParameteValueType = dataList[currentTr.index()].craft_workstep_parameter_value_type,
                                                                                            ParameteConstantValue = dataList[currentTr.index()].workstep_parameter_constant_value,
                                                                                            devicesTypeId= dataList[currentTr.index()].devices_control_devices_type_id,
                                                                                            valueType= dataList[currentTr.index()].craft_workstep_parameter_value_type
                                                                                            switch (dataContent) {
                                                                                              case '#add': {	//t添加
                                                                                                let dataContent = $('#submitModelModal4'),
                                                                                                  panelList = dataContent.find('.panel'),
                                                                                                  modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                  panelThead = panelList.find('thead'),
                                                                                                  panelTbody = panelList.find('tbody'),
                                                                                                  modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                                                  headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                                                  panelList.find('.panel-heading').find('.panel-title').text('添加物料记录') // 更换panel标题

                                                                                                  dataContent.modal({
                                                                                                    backdrop: false, // 黑色遮罩不可点击
                                                                                                    keyboard: false,  // esc按键不可弃用模态框
                                                                                                    show: false
                                                                                                  })

                                                                                                  dataContent.modal('show') // 运行时显示
                                                                                                  dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                    $('body').addClass('modal-open')
                                                                                                  })

                                                                                                  modalCloseBtn.off('click').on('click', (event) => {
                                                                                                    // 点击弃用按钮隐藏该模态框
                                                                                                    dataContent.modal('hide')
                                                                                                    // 初始化表格
                                                                                                    panelList.find('thead').empty()
                                                                                                    panelList.find('tbody').empty()
                                                                                                  })
                                                                                                  let term= `
                                                                                                  <tr>
                                                                                                  <th style="width:2%">序号</th>
                                                                                                  <th style="width:4%">参数值</th>
                                                                                                  <th style="width:5%">记录人</th>
                                                                                                  <th style="width:7%">记录时间</th>
                                                                                                  <th style="width:8%"> 设备编号</th>
                                                                                                  <th style="width:8%">备注</th>
                                                                                                  <th style="width:8%">操作</th>
                                                                                                  </tr>
                                                                                                  `
                                                                                                  panelThead.empty().append(term)

                                                                                                  headingMainBtn_1.off('click').on('click', (event) => {
                                                                                                    let term2 =`
                                                                                                    <tr>
                                                                                                      <td ></td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input class="table-input" type="text" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                                                      <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                                                      <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                                                      <td class="table-input-td">
                                                                                                        <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                                                        <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                                                        <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                                                      </td>
                                                                                                    </tr>
                                                                                                    `
                                                                                                    panelTbody.append(term2)

                                                                                                    let tr = panelTbody.find('tr');
                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      // panel_table.find('tbody').append(temStr)
                                                                                                      panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                                                      ;
                                                                                                    }

                                                                                                    panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                                                      // 添加员工选择模态框
                                                                                                      let $this = $(this),
                                                                                                        promise = new Promise(function (resolve, reject) {
                                                                                                        selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                                                      });
                                                                                                      promise.then(function (resolveData) {
                                                                                                        $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                                                        // submithData.creator = resolveData.roleStaffId
                                                                                                      })

                                                                                                      $this.prop('readonly', true) // 输入框只读
                                                                                                      $this.off('blur').on('blur', () => {
                                                                                                        $this.removeProp('readonly') // 输入移除框只读
                                                                                                      })

                                                                                                    })

                                                                                                  })

                                                                                                  headingMainBtn_1.trigger('click')		//默认添加一行


                                                                                                  panelList.off('click').on('click', 'tr td a', function(event) {
                                                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                                                    let tr = panelTbody.find('tr');
                                                                                                    switch (dataContent) {
                                                                                                      case "delete":{
                                                                                                        $(this).closest('tr').remove();
                                                                                                      }
                                                                                                        break;
                                                                                                      case "down":{
                                                                                                        let thisTr=$(this).closest('tr');
                                                                                                        if(thisTr.index()!=tr.length-1){
                                                                                                          thisTr.fadeOut().fadeIn();
                                                                                                          thisTr.next().after(thisTr);
                                                                                                          }
                                                                                                      }
                                                                                                        break;
                                                                                                      case "up":{
                                                                                                        let thisTr=$(this).closest('tr');  //
                                                                                                        if(thisTr.index()!=0){
                                                                                                          thisTr.fadeOut().fadeIn();
                                                                                                          thisTr.prev().before(thisTr);
                                                                                                        }
                                                                                                      }
                                                                                                        break;
                                                                                                    }

                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                                                      ;
                                                                                                    }
                                                                                                  });

                                                                                                  modalSubmitBtn.off("click").on("click",(event)=>{
                                                                                                    let tr = panelTbody.find('tr'),
                                                                                                    stepParameteRecords=[]

                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      let $td = tr.eq(i).find('td')
                                                                                                      req={
                                                                                                        craft_workstep_parameter_main_id:"",//工步参数列表id
                                                                                                        step_use_steady_state_value:"",//恒定值
                                                                                                        step_use_note_taker:"",//记录人
                                                                                                        step_use_note_taker_id:"",//记录人id
                                                                                                        step_use_write_time:"",//记录时间
                                                                                                        devices_control_devices_number:"",//设备编号
                                                                                                        step_use_describe:"",//备注
                                                                                                        workstep_parameter_unit:"",//
                                                                                                        craft_workstep_parameter_id:"",//备注
                                                                                                        craft_workstep_parameter_name:"",//备注
                                                                                                        work_order_id:"",//备注
                                                                                                        step_use_parameter_value_type:"",//值类型
                                                                                                        devices_control_devices_type_id:""
                                                                                                      }
                                                                                                      req.craft_workstep_parameter_main_id = stepParameteId
                                                                                                      req.workstep_parameter_unit = unit
                                                                                                      req.craft_workstep_parameter_id = ParameteId
                                                                                                      req.craft_workstep_parameter_name = ParameteName
                                                                                                      req.devices_control_devices_type_id = devicesTypeId
                                                                                                      req.work_order_id = workOrderId
                                                                                                      req.step_use_parameter_value_type = valueType
                                                                                                      for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                                                        switch (i) {
                                                                                                          case 0: {

                                                                                                            break;
                                                                                                          }
                                                                                                          case 1: {
                                                                                                            req.step_use_steady_state_value = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 2: {
                                                                                                            req.step_use_note_taker_id = $td.eq(i).find('input').attr("principal");
                                                                                                            req.step_use_note_taker = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 3: {
                                                                                                            req.step_use_write_time = $td.eq(i).find('input').val()
                                                                                                            break;
                                                                                                          }
                                                                                                          case 4: {
                                                                                                            req.devices_control_devices_number = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }

                                                                                                        }
                                                                                                      }
                                                                                                      // 拼成字符串
                                                                                                      stepParameteRecords.push(req)
                                                                                                      console.log(stepParameteRecords)

                                                                                                    }
                                                                                                    let stepParameteRecords2
                                                                                                    stepParameteRecords2= JSON.stringify(stepParameteRecords);

                                                                                                    if (true
                                                                                                    ) {
                                                                                                      swal({
                                                                                                        title: '您确定要提交本次操作吗?',
                                                                                                        text: '请确保填写信息无误后点击确定按钮',
                                                                                                        type: 'question',
                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                        showCancelButton: true, // 显示用户取消按钮
                                                                                                        confirmButtonText: '确定',
                                                                                                        cancelButtonText: '取消',
                                                                                                      }).then(function () {
                                                                                                        $.ajax({
                                                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                          url: saveWorkOrderStepParameteRecordUrl,
                                                                                                          data: {
                                                                                                            type:"save",
                                                                                                            stepParameteRecords:stepParameteRecords2
                                                                                                          },
                                                                                                          success: function (result, status, xhr) {
                                                                                                            if (result.status === 0) {
                                                                                                              swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                                                            }else if(result.status !== 0) {
                                                                                                              let msg = result.msg
                                                                                                              if(msg!==null){
                                                                                                                swallFail2(msg)
                                                                                                              }else{
                                                                                                                swallError();	//格式不正确
                                                                                                              }

                                                                                                            }
                                                                                                          }
                                                                                                        })
                                                                                                      });
                                                                                                    }
                                                                                                    else {
                                                                                                      swallError();	//格式不正确
                                                                                                    }


                                                                                                  })


                                                                                                break;
                                                                                              }
                                                                                            }
                                                                                          })
                                                                                          break;
                                                                                        default:
                                                                                          break;
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                }
                                                                              },

                                                                              pagination: {
                                                                                totalRow: result.map.workstepList[0].workstepParameterList.length, // 总行数
                                                                                displayRow: result.map.workstepList[0].workstepParameterList.length // 显示行数
                                                                              },

                                                                              ajax: {
                                                                                url: url,
                                                                                data: data
                                                                              }
                                                                            })
                                                                          }
                                                                          else {
                                                                            mesloadBox.warningShow();
                                                                          }
                                                                        }
                                                                      })
                                                                    }

                                                                    // 导航栏点击时运行数据加载
                                                                    addTableData(queryStepParticularsUrl, {
                                                                      stepIds:["0167c491214a45bc96e1523026d1f7f0"],
                                                                    });

                                                                    break;
                                                                  }
                                                                  case '#devicesOperate': {	//添加设备记录详情
                                                                    let dataContent = $('#submitModelModal4'),
                                                                    panelList = dataContent.find('.panel'),
                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                    panelThead = panelList.find('thead'),
                                                                    panelTbody = panelList.find('tbody'),
                                                                    modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                    headingMainBtn_1 = panelList.find('.head-main-btn-1')

                                                                    panelList.find('.panel-heading').find('.panel-title').text('添加设备操作记录') // 更换panel标题

                                                                    dataContent.modal({
                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                      show: false
                                                                    })

                                                                    dataContent.modal('show') // 运行时显示
                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                      $('body').addClass('modal-open')
                                                                    })

                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                      // 点击弃用按钮隐藏该模态框
                                                                      dataContent.modal('hide')
                                                                      // 初始化表格
                                                                      panelList.find('thead').empty()
                                                                      panelList.find('tbody').empty()
                                                                    })
                                                                    let term= `
                                                                    <tr>
                                                                    <th style="width:4%">序号</th>
                                                                    <th style="width:10%">设备名称</th>
                                                                    <th style="width:10%"> 设备编号</th>
                                                                    <th style="width:13%">开始时间</th>
                                                                    <th style="width:13%">结束时间</th>
                                                                    <th style="width:10%">设备状态</th>
                                                                    <th style="width:8%">操作人</th>
                                                                    <th style="width:14%">操作</th>
                                                                    </tr>
                                                                    `
                                                                    panelThead.empty().append(term)

                                                                    headingMainBtn_1.off('click').on('click', (event) => {
                                                                      let term2 =`
                                                                      <tr>
                                                                        <td ></td>
                                                                        <td class="table-input-td">
                                                                          <input class="table-input deviceName" type="text" placeholder="请选择设备名称" />
                                                                        </td>
                                                                        <td>

                                                                        </td>
                                                                        <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                        <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                        <td class="table-input-td"> <select class="form-control table-input input-sm OperatorType"></select></td>
                                                                        <td class="table-input-td"> <input type="text" class="table-input projectPrincipal" placeholder="请输入" /></td>
                                                                        <td class="table-input-td">
                                                                          <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                          <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                          <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                        </td>
                                                                      </tr>
                                                                      `
                                                                      panelTbody.append(term2)

                                                                      let OperatorType2 = panelTbody.find('.OperatorType')
                                                                      // OperatorType2.append('<option value="">设备状态</option>')
                                                                      for (let i = 0, len = OperatorType.length; i < len; i++) {
                                                                        //设备类型id作为value,名称作为text
                                                                        let optionStr = `<option value="${OperatorType[i]}">${OperatorType[i]}</option>`;
                                                                        OperatorType2.append(optionStr);
                                                                      }

                                                                      panelTbody.find('.deviceName').off('focus').on('focus', function () {
                                                                        let $this = $(this);
                                                                        // 添加设备选择模态框
                                                                        let promise = new Promise(function (resolve, reject) {
                                                                          selectDevicessAddData2(resolve)
                                                                        });
                                                                        promise.then(function (resolveData) {
                                                                          $this.val(resolveData.devicesName)
                                                                          $this.closest('tr').find('td').eq(2).html(resolveData.devicesNumber)
                                                                          $this.attr('devicesID', resolveData.devicesId)

                                                                        })

                                                                        $(this).prop('readonly', true) // 输入框只读
                                                                        $(this).off('blur').on('blur', () => {
                                                                          $(this).removeProp('readonly') // 输入移除框只读
                                                                        })

                                                                      })

                                                                      let tr = panelTbody.find('tr');
                                                                      for(let i = 0;i<tr.length;i++){
                                                                        // panel_table.find('tbody').append(temStr)
                                                                        panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                        ;
                                                                      }

                                                                      panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                        // 添加员工选择模态框
                                                                        let $this = $(this),
                                                                          promise = new Promise(function (resolve, reject) {
                                                                          selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                        });
                                                                        promise.then(function (resolveData) {
                                                                          $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                        })

                                                                        $this.prop('readonly', true) // 输入框只读
                                                                        $this.off('blur').on('blur', () => {
                                                                          $this.removeProp('readonly') // 输入移除框只读
                                                                        })

                                                                      })

                                                                    })

                                                                    headingMainBtn_1.trigger('click')		//默认添加一行


                                                                    panelList.off('click').on('click', 'tr td a', function(event) {
                                                                      let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                      let tr = panelTbody.find('tr');
                                                                      switch (dataContent) {
                                                                        case "delete":{
                                                                          $(this).closest('tr').remove();
                                                                        }
                                                                          break;
                                                                        case "down":{
                                                                          let thisTr=$(this).closest('tr');
                                                                          if(thisTr.index()!=tr.length-1){
                                                                            thisTr.fadeOut().fadeIn();
                                                                            thisTr.next().after(thisTr);
                                                                            }
                                                                        }
                                                                          break;
                                                                        case "up":{
                                                                          let thisTr=$(this).closest('tr');  //
                                                                          if(thisTr.index()!=0){
                                                                            thisTr.fadeOut().fadeIn();
                                                                            thisTr.prev().before(thisTr);
                                                                          }
                                                                        }
                                                                          break;
                                                                      }

                                                                      for(let i = 0;i<tr.length;i++){
                                                                        panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                        ;
                                                                      }
                                                                    });

                                                                    modalSubmitBtn.off("click").on("click",(event)=>{

                                                                      let tr = panelTbody.find('tr')
                                                                      devicesOperationRecords=[]


                                                                      for(let i = 0;i<tr.length;i++){
                                                                        let $td = tr.eq(i).find('td')
                                                                        req={
                                                                          work_order_id:"",
                                                                          craft_control_workstep_id:"",
                                                                          devices_control_devices_id:"",//设备id
                                                                          devices_control_devices_name:"",//设备名称
                                                                          devices_control_devices_number:"",//设备编号
                                                                          devices_operation_start_time:"",//开始时间
                                                                          devices_operation_end_time:"",//结束时间
                                                                          devices_operation_operator:"",//操作人
                                                                          devices_operation_operator_id:"",//操作人id
                                                                          devices_operation_operator_type:""//操作类型
                                                                        }
                                                                        req.craft_control_workstep_id = stepId
                                                                        req.work_order_id = workOrderId
                                                                        for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                          switch (i) {
                                                                            case 0: {

                                                                              break;
                                                                            }
                                                                            case 1: {
                                                                              req.devices_control_devices_id = $td.eq(i).find('input').attr("devicesID");
                                                                              req.devices_control_devices_name = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                              break;
                                                                            }
                                                                            case 2: {
                                                                              req.devices_control_devices_number = $td.eq(i).text();
                                                                              break;
                                                                            }
                                                                            case 3: {
                                                                              req.devices_operation_start_time = $td.eq(i).find('input').val()
                                                                              break;
                                                                            }
                                                                            case 4: {
                                                                              req.devices_operation_end_time = $td.eq(i).find('input').val()
                                                                              break;
                                                                            }
                                                                            case 5: {
                                                                              req.devices_operation_operator_type = $td.eq(i).find('select').val()
                                                                              break;
                                                                            }
                                                                            case 6: {
                                                                              req.devices_operation_operator_id = $td.eq(i).find('input').attr("principal");
                                                                              req.devices_operation_operator = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                              break;
                                                                            }

                                                                          }
                                                                        }
                                                                        devicesOperationRecords.push(req)

                                                                      }
                                                                      let devicesOperationRecords2
                                                                       devicesOperationRecords2= JSON.stringify(devicesOperationRecords);
                                                                      if (true
                                                                      ) {
                                                                        swal({
                                                                          title: '您确定要提交本次操作吗?',
                                                                          text: '请确保填写信息无误后点击确定按钮',
                                                                          type: 'question',
                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                          showCancelButton: true, // 显示用户取消按钮
                                                                          confirmButtonText: '确定',
                                                                          cancelButtonText: '取消',
                                                                        }).then(function () {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: saveWorkOrderDevicesOperationRecordUrl,
                                                                            data: {
                                                                              type:"save",
                                                                              devicesOperationRecords:devicesOperationRecords2
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              if (result.status === 0) {
                                                                                swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                              }else if(result.status !== 0) {
                                                                                let msg = result.msg
                                                                                if(msg!==null){
                                                                                  swallFail2(msg)
                                                                                }else{
                                                                                  swallError();	//格式不正确
                                                                                }

                                                                              }
                                                                            }
                                                                          })
                                                                        });
                                                                      }
                                                                      else {
                                                                        swallError();	//格式不正确
                                                                      }

                                                                    })

                                                                    break;
                                                                  }


                                                                }
                                                              })
                                                              break;
                                                            default:
                                                              break;
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },

                                                  pagination: {
                                                    totalRow: result.map.workstageList[0].stageAndStepRelationList.length, // 总行数
                                                    displayRow: result.map.workstageList[0].stageAndStepRelationList.length // 显示行数
                                                  },

                                                  ajax: {
                                                    url: url,
                                                    data: data
                                                  }
                                                })

                                                //panel3 环境参数
                                                mesVerticalTableAddData(panel_3, {
                                                  thead: {
                                                    theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                    theadWidth: '4%/15%/15%/15%/15%/15%'
                                                  },
                                                  tbody: {
                                                    html: [
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#addParm"><i class="fa fa-tasks fa-fw"></i>添加参数详情</a></td>'
                                                    ],

                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                    dataAddress: function (tbodyTarget, html, result) {
                                                      tbodyTarget.empty() // 清空表格主体
                                                      let dataList =  EnvirParamersList,//环境参数集合,
                                                        tempData = null; // 表格td内的临时数据
                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                          switch (i) {
                                                            case 0:
                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                              break;
                                                            case 1: {
                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                              // tempData=
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;
                                                            case 2: {
                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                              if(tempData = "constantValue"){
                                                                currentTr.children().eq(i).html( "固定值")
                                                              }else if(tempData = "rangeValue"){
                                                                currentTr.children().eq(i).html("范围值")
                                                              }else if(tempData = "deviationValue"){
                                                                currentTr.children().eq(i).html("浮动值")
                                                              }
                                                            }
                                                              break;
                                                            case 3: {
                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                             let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                             let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                             let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                             let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                              if(tempData == "constantValue"){
                                                                currentTr.children().eq(i).html(constantValue)
                                                              }else if(tempData == "rangeValue"){
                                                                currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                              }else if(tempData == "deviationValue"){
                                                                currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                              }
                                                            }
                                                              break;
                                                            case 4: {
                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;

                                                            case 5:
                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                workstageId = dataList[currentTr.index()].workstage_id,
                                                                parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type
                                                                switch (dataContent) {
                                                                  case '#addParm': {	//添加
                                                                    let dataContent = $('#submitModelModal4'),
                                                                    panelList = dataContent.find('.panel'),
                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                    panelThead = panelList.find('thead'),
                                                                    panelTbody = panelList.find('tbody'),
                                                                    modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                    headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                    panelList.find('.panel-heading').find('.panel-title').text('添加物料记录') // 更换panel标题

                                                                    dataContent.modal({
                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                      show: false
                                                                    })

                                                                    dataContent.modal('show') // 运行时显示
                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                      $('body').addClass('modal-open')
                                                                    })

                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                      // 点击弃用按钮隐藏该模态框
                                                                      dataContent.modal('hide')
                                                                      // 初始化表格
                                                                      panelList.find('thead').empty()
                                                                      panelList.find('tbody').empty()
                                                                    })
                                                                    let term= `
                                                                      <tr>
                                                                      <th style="width:2%">序号</th>
                                                                      <th style="width:4%">参数值</th>
                                                                      <th style="width:5%">记录人</th>
                                                                      <th style="width:7%">记录时间</th>
                                                                      <th style="width:8%">备注</th>
                                                                      <th style="width:8%">操作</th>
                                                                      </tr>
                                                                      `
                                                                    panelThead.empty().append(term)

                                                                    headingMainBtn_1.off('click').on('click', (event) => {
                                                                      let term2 =`
                                                                        <tr>
                                                                          <td ></td>
                                                                          <td class="table-input-td">
                                                                            <input class="table-input" type="text" placeholder="请输入" />
                                                                          </td>
                                                                          <td class="table-input-td">
                                                                            <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                          </td>
                                                                          <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                          <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                          <td class="table-input-td">
                                                                            <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                            <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                            <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                          </td>
                                                                        </tr>
                                                                        `
                                                                      panelTbody.append(term2)

                                                                      let tr = panelTbody.find('tr');
                                                                      for(let i = 0;i<tr.length;i++){
                                                                        // panel_table.find('tbody').append(temStr)
                                                                        panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                        ;
                                                                      }

                                                                      panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                        // 添加员工选择模态框
                                                                        let $this = $(this),
                                                                          promise = new Promise(function (resolve, reject) {
                                                                          selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                        });
                                                                        promise.then(function (resolveData) {
                                                                          $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                          // submithData.creator = resolveData.roleStaffId
                                                                        })

                                                                        $this.prop('readonly', true) // 输入框只读
                                                                        $this.off('blur').on('blur', () => {
                                                                          $this.removeProp('readonly') // 输入移除框只读
                                                                        })

                                                                      })

                                                                    })

                                                                    headingMainBtn_1.trigger('click')		//默认添加一行


                                                                    panelList.off('click').on('click', 'tr td a', function(event) {
                                                                      let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                      let tr = panelTbody.find('tr');
                                                                      switch (dataContent) {
                                                                        case "delete":{
                                                                          $(this).closest('tr').remove();
                                                                        }
                                                                          break;
                                                                        case "down":{
                                                                          let thisTr=$(this).closest('tr');
                                                                          if(thisTr.index()!=tr.length-1){
                                                                            thisTr.fadeOut().fadeIn();
                                                                            thisTr.next().after(thisTr);
                                                                            }
                                                                        }
                                                                          break;
                                                                        case "up":{
                                                                          let thisTr=$(this).closest('tr');  //
                                                                          if(thisTr.index()!=0){
                                                                            thisTr.fadeOut().fadeIn();
                                                                            thisTr.prev().before(thisTr);
                                                                          }
                                                                        }
                                                                          break;
                                                                      }

                                                                      for(let i = 0;i<tr.length;i++){
                                                                        panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                        ;
                                                                      }
                                                                    });

                                                                    modalSubmitBtn.off("click").on("click",(event)=>{
                                                                      let tr = panelTbody.find('tr'),
                                                                          parameteRecords=[]

                                                                      for(let i = 0;i<tr.length;i++){
                                                                        let $td = tr.eq(i).find('td'),
                                                                        req={
                                                                          craft_workstep_parameter_main_id:"",//参数id
                                                                          craft_workstep_parameter_id:"",//参数id
                                                                          standard_parameter_type_id:"",//参数lx id
                                                                          workstage_id:"",//工序id
                                                                          work_order_id:"",//工序id
                                                                          parameter_record_steady_state_value:"",//参数记录值
                                                                          parameter_record_write_time:"",//记录时间
                                                                          parameter_record_note_taker:"",//记录人
                                                                          parameter_record_note_taker_id:"",//记录id
                                                                          parameter_record_describe:"",//描述
                                                                          parameter_record_value_type:"",//描述
                                                                        }
                                                                        req.craft_workstep_parameter_main_id = parameteRecordId
                                                                        req.workstage_id = workstageId
                                                                        req.standard_parameter_type_id = parametertypeId
                                                                        req.work_order_id = workOrderId
                                                                        req.parameter_record_value_type = ParameteValueType

                                                                        for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                          switch (i) {
                                                                            case 0: {

                                                                              break;
                                                                            }
                                                                            case 1: {
                                                                              req.parameter_record_steady_state_value = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                              break;
                                                                            }
                                                                            case 2: {
                                                                              req.parameter_record_note_taker_id = $td.eq(i).find('input').attr("principal");
                                                                              req.parameter_record_note_taker = $td.eq(i).find('input').val().replace(/\s/g, "");


                                                                              break;
                                                                            }
                                                                            case 3: {

                                                                              req.parameter_record_write_time = $td.eq(i).find('input').val()
                                                                              break;
                                                                            }
                                                                            case 4: {
                                                                              req.parameter_record_describe = $td.eq(i).find('input').val().replace(/\s/g, "");

                                                                              break;
                                                                            }

                                                                          }
                                                                        }
                                                                        parameteRecords.push(req)

                                                                      }
                                                                      let parameteRecords2
                                                                      parameteRecords2= JSON.stringify(parameteRecords);
                                                                      if (true
                                                                      ) {
                                                                        swal({
                                                                          title: '您确定要提交本次操作吗?',
                                                                          text: '请确保填写信息无误后点击确定按钮',
                                                                          type: 'question',
                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                          showCancelButton: true, // 显示用户取消按钮
                                                                          confirmButtonText: '确定',
                                                                          cancelButtonText: '取消',
                                                                        }).then(function () {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: saveWorkOrderParameteRecordUrl,
                                                                            data: {
                                                                              type:"save",
                                                                              parameteRecords:parameteRecords2
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              if (result.status === 0) {
                                                                                swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                              }else if(result.status !== 0) {
                                                                                let msg = result.msg
                                                                                if(msg!==null){
                                                                                  swallFail2(msg)
                                                                                }else{
                                                                                  swallError();	//格式不正确
                                                                                }

                                                                              }
                                                                            }
                                                                          })
                                                                        });
                                                                      }
                                                                      else {
                                                                        swallError();	//格式不正确
                                                                      }

                                                                    })


                                                                    break;
                                                                  }


                                                                }
                                                              })
                                                              break;
                                                            default:
                                                              break;
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },

                                                  pagination: {
                                                    totalRow:EnvirParamersList.length ,//环境参数集合,
                                                    displayRow: EnvirParamersList.length // 显示行数
                                                  },

                                                  ajax: {
                                                    url: url,
                                                    data: data
                                                  }
                                                })

                                                //panel3  半成品参数
                                                if(semiProParamersList.length!==0){
                                                  mesVerticalTableAddData(panel_4, {
                                                    thead: {
                                                      theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                      theadWidth: '4%/15%/15%/15%/15%/15%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#addParm"><i class="fa fa-tasks fa-fw"></i>添加参数详情</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let  dataList = semiProParamersList, // 主要数据列表
                                                        tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                               currentTr.children().eq(i).html(currentTr.index() + 1)
                                                               break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                // tempData=
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                if(tempData = "constantValue"){
                                                                  currentTr.children().eq(i).html( "固定值")
                                                                }else if(tempData = "rangeValue"){
                                                                  currentTr.children().eq(i).html("范围值")
                                                                }else if(tempData = "deviationValue"){
                                                                  currentTr.children().eq(i).html("浮动值")
                                                                }
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                              let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                              let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                              let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                              let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                if(tempData == "constantValue"){
                                                                  currentTr.children().eq(i).html(constantValue)
                                                                }else if(tempData == "rangeValue"){
                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                }else if(tempData == "deviationValue"){
                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                }
                                                              }
                                                                break;
                                                              case 4: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  workstageId = dataList[currentTr.index()].workstage_id,
                                                                 parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                 ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type

                                                                  switch (dataContent) {
                                                                    case '#addParm': {	//
                                                                      let dataContent = $('#submitModelModal4'),
                                                                      panelList = dataContent.find('.panel'),
                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                      panelThead = panelList.find('thead'),
                                                                      panelTbody = panelList.find('tbody'),
                                                                      modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                      headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                      panelList.find('.panel-heading').find('.panel-title').text('添加物料记录') // 更换panel标题

                                                                      dataContent.modal({
                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                        show: false
                                                                      })

                                                                      dataContent.modal('show') // 运行时显示
                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                        $('body').addClass('modal-open')
                                                                      })

                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                        // 点击弃用按钮隐藏该模态框
                                                                        dataContent.modal('hide')
                                                                        // 初始化表格
                                                                        panelList.find('thead').empty()
                                                                        panelList.find('tbody').empty()
                                                                      })
                                                                      let term= `
                                                                        <tr>
                                                                        <th style="width:2%">序号</th>
                                                                        <th style="width:4%">参数值</th>
                                                                        <th style="width:5%">记录人</th>
                                                                        <th style="width:7%">记录时间</th>
                                                                        <th style="width:8%">备注</th>
                                                                        <th style="width:8%">操作</th>
                                                                        </tr>
                                                                        `
                                                                      panelThead.empty().append(term)

                                                                      headingMainBtn_1.off('click').on('click', (event) => {
                                                                        let term2 =`
                                                                          <tr>
                                                                            <td ></td>
                                                                            <td class="table-input-td">
                                                                              <input class="table-input" type="text" placeholder="请输入" />
                                                                            </td>
                                                                            <td class="table-input-td">
                                                                              <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                            </td>
                                                                            <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                            <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                            <td class="table-input-td">
                                                                              <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                              <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                              <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                            </td>
                                                                          </tr>
                                                                          `
                                                                        panelTbody.append(term2)

                                                                        let tr = panelTbody.find('tr');
                                                                        for(let i = 0;i<tr.length;i++){
                                                                          // panel_table.find('tbody').append(temStr)
                                                                          panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                          ;
                                                                        }

                                                                        panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                          // 添加员工选择模态框
                                                                          let $this = $(this),
                                                                            promise = new Promise(function (resolve, reject) {
                                                                            selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                          });
                                                                          promise.then(function (resolveData) {
                                                                            $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                            // submithData.creator = resolveData.roleStaffId
                                                                          })

                                                                          $this.prop('readonly', true) // 输入框只读
                                                                          $this.off('blur').on('blur', () => {
                                                                            $this.removeProp('readonly') // 输入移除框只读
                                                                          })

                                                                        })

                                                                      })

                                                                      headingMainBtn_1.trigger('click')		//默认添加一行


                                                                      panelList.off('click').on('click', 'tr td a', function(event) {
                                                                        let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                        let tr = panelTbody.find('tr');
                                                                        switch (dataContent) {
                                                                          case "delete":{
                                                                            $(this).closest('tr').remove();
                                                                          }
                                                                            break;
                                                                          case "down":{
                                                                            let thisTr=$(this).closest('tr');
                                                                            if(thisTr.index()!=tr.length-1){
                                                                              thisTr.fadeOut().fadeIn();
                                                                              thisTr.next().after(thisTr);
                                                                              }
                                                                          }
                                                                            break;
                                                                          case "up":{
                                                                            let thisTr=$(this).closest('tr');  //
                                                                            if(thisTr.index()!=0){
                                                                              thisTr.fadeOut().fadeIn();
                                                                              thisTr.prev().before(thisTr);
                                                                            }
                                                                          }
                                                                            break;
                                                                        }

                                                                        for(let i = 0;i<tr.length;i++){
                                                                          panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                          ;
                                                                        }
                                                                      });

                                                                      modalSubmitBtn.off("click").on("click",(event)=>{
                                                                        let tr = panelTbody.find('tr'),
                                                                            parameteRecords=[]

                                                                        for(let i = 0;i<tr.length;i++){
                                                                          let $td = tr.eq(i).find('td'),
                                                                          req={
                                                                            craft_workstep_parameter_main_id:"",//参数id
                                                                            craft_workstep_parameter_id:"",//参数id
                                                                            standard_parameter_type_id:"",//参数lx id
                                                                            workstage_id:"",//工序id
                                                                            work_order_id:"",//工序id
                                                                            parameter_record_steady_state_value:"",//参数记录值
                                                                            parameter_record_write_time:"",//记录时间
                                                                            parameter_record_note_taker:"",//记录人
                                                                            parameter_record_note_taker_id:"",//记录id
                                                                            parameter_record_describe:"",//描述
                                                                            parameter_record_value_type:"",//描述
                                                                          }
                                                                          req.craft_workstep_parameter_main_id = parameteRecordId
                                                                          req.workstage_id = workstageId
                                                                          req.standard_parameter_type_id = parametertypeId
                                                                          req.work_order_id = workOrderId
                                                                          req.parameter_record_value_type = ParameteValueType

                                                                          for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                            switch (i) {
                                                                              case 0: {

                                                                                break;
                                                                              }
                                                                              case 1: {
                                                                                req.parameter_record_steady_state_value = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                break;
                                                                              }
                                                                              case 2: {
                                                                                req.parameter_record_note_taker_id = $td.eq(i).find('input').attr("principal");
                                                                                req.parameter_record_note_taker = $td.eq(i).find('input').val().replace(/\s/g, "");


                                                                                break;
                                                                              }
                                                                              case 3: {

                                                                                req.parameter_record_write_time = $td.eq(i).find('input').val()
                                                                                break;
                                                                              }
                                                                              case 4: {
                                                                                req.parameter_record_describe = $td.eq(i).find('input').val().replace(/\s/g, "");

                                                                                break;
                                                                              }

                                                                            }
                                                                          }
                                                                          parameteRecords.push(req)

                                                                        }
                                                                        let parameteRecords2
                                                                          parameteRecords2= JSON.stringify(parameteRecords);
                                                                        if (true
                                                                        ) {
                                                                          swal({
                                                                            title: '您确定要提交本次操作吗?',
                                                                            text: '请确保填写信息无误后点击确定按钮',
                                                                            type: 'question',
                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                            showCancelButton: true, // 显示用户取消按钮
                                                                            confirmButtonText: '确定',
                                                                            cancelButtonText: '取消',
                                                                          }).then(function () {
                                                                            $.ajax({
                                                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                              url: saveWorkOrderParameteRecordUrl,
                                                                              data: {
                                                                                type:"save",
                                                                                parameteRecords:parameteRecords2
                                                                              },
                                                                              success: function (result, status, xhr) {
                                                                                if (result.status === 0) {
                                                                                  swallSuccess()	//操作成功提示并刷新页面
                                                                                }else if(result.status !== 0) {
                                                                                  let msg = result.msg
                                                                                  if(msg!==null){
                                                                                    swallFail2(msg)
                                                                                  }else{
                                                                                    swallError();	//格式不正确
                                                                                  }

                                                                                }
                                                                              }
                                                                            })
                                                                          });
                                                                        }
                                                                        else {
                                                                          swallError();	//格式不正确
                                                                        }

                                                                      })


                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow:semiProParamersList.length , // 总行数
                                                      displayRow:semiProParamersList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })
                                                }else{
                                                  panel_4.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                }

                                                 //panel3  其他
                                                if(otherParamersList.length!==0){
                                                  mesVerticalTableAddData(panel_5, {
                                                    thead: {
                                                      theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                      theadWidth: '4%/15%/15%/15%/15%/15%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#addParm"><i class="fa fa-tasks fa-fw"></i>添加参数详情</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let dataList = otherParamersList, // 主要数据列表
                                                        tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                // tempData=
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                if(tempData = "constantValue"){
                                                                  currentTr.children().eq(i).html( "固定值")
                                                                }else if(tempData = "rangeValue"){
                                                                  currentTr.children().eq(i).html("范围值")
                                                                }else if(tempData = "deviationValue"){
                                                                  currentTr.children().eq(i).html("浮动值")
                                                                }
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                              }
                                                                break;
                                                              case 4: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                workstageId = dataList[currentTr.index()].workstage_id,
                                                                parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type

                                                                  switch (dataContent) {
                                                                    case '#addParm': {	//
                                                                      let dataContent = $('#submitModelModal4'),
                                                                      panelList = dataContent.find('.panel'),
                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                      panelThead = panelList.find('thead'),
                                                                      panelTbody = panelList.find('tbody'),
                                                                      modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                      headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                      panelList.find('.panel-heading').find('.panel-title').text('添加物料记录') // 更换panel标题

                                                                      dataContent.modal({
                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                        show: false
                                                                      })

                                                                      dataContent.modal('show') // 运行时显示
                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                        $('body').addClass('modal-open')
                                                                      })

                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                        // 点击弃用按钮隐藏该模态框
                                                                        dataContent.modal('hide')
                                                                        // 初始化表格
                                                                        panelList.find('thead').empty()
                                                                        panelList.find('tbody').empty()
                                                                      })
                                                                      let term= `
                                                                        <tr>
                                                                        <th style="width:2%">序号</th>
                                                                        <th style="width:4%">参数值</th>
                                                                        <th style="width:5%">记录人</th>
                                                                        <th style="width:7%">记录时间</th>
                                                                        <th style="width:8%">备注</th>
                                                                        <th style="width:8%">操作</th>
                                                                        </tr>
                                                                        `
                                                                      panelThead.empty().append(term)

                                                                      headingMainBtn_1.off('click').on('click', (event) => {
                                                                        let term2 =`
                                                                          <tr>
                                                                            <td ></td>
                                                                            <td class="table-input-td">
                                                                              <input class="table-input" type="text" placeholder="请输入" />
                                                                            </td>
                                                                            <td class="table-input-td">
                                                                              <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                            </td>
                                                                            <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                            <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                            <td class="table-input-td">
                                                                              <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                              <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                              <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                            </td>
                                                                          </tr>
                                                                          `
                                                                        panelTbody.append(term2)

                                                                        let tr = panelTbody.find('tr');
                                                                        for(let i = 0;i<tr.length;i++){
                                                                          // panel_table.find('tbody').append(temStr)
                                                                          panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                          ;
                                                                        }

                                                                        panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                          // 添加员工选择模态框
                                                                          let $this = $(this),
                                                                            promise = new Promise(function (resolve, reject) {
                                                                            selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                          });
                                                                          promise.then(function (resolveData) {
                                                                            $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                            // submithData.creator = resolveData.roleStaffId
                                                                          })

                                                                          $this.prop('readonly', true) // 输入框只读
                                                                          $this.off('blur').on('blur', () => {
                                                                            $this.removeProp('readonly') // 输入移除框只读
                                                                          })

                                                                        })

                                                                      })

                                                                      headingMainBtn_1.trigger('click')		//默认添加一行


                                                                      panelList.off('click').on('click', 'tr td a', function(event) {
                                                                        let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                        let tr = panelTbody.find('tr');
                                                                        switch (dataContent) {
                                                                          case "delete":{
                                                                            $(this).closest('tr').remove();
                                                                          }
                                                                            break;
                                                                          case "down":{
                                                                            let thisTr=$(this).closest('tr');
                                                                            if(thisTr.index()!=tr.length-1){
                                                                              thisTr.fadeOut().fadeIn();
                                                                              thisTr.next().after(thisTr);
                                                                              }
                                                                          }
                                                                            break;
                                                                          case "up":{
                                                                            let thisTr=$(this).closest('tr');  //
                                                                            if(thisTr.index()!=0){
                                                                              thisTr.fadeOut().fadeIn();
                                                                              thisTr.prev().before(thisTr);
                                                                            }
                                                                          }
                                                                            break;
                                                                        }

                                                                        for(let i = 0;i<tr.length;i++){
                                                                          panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                          ;
                                                                        }
                                                                      });

                                                                      modalSubmitBtn.off("click").on("click",(event)=>{
                                                                        let tr = panelTbody.find('tr'),
                                                                            parameteRecords=[]

                                                                        for(let i = 0;i<tr.length;i++){
                                                                          let $td = tr.eq(i).find('td'),
                                                                          req={
                                                                            craft_workstep_parameter_main_id:"",//参数id
                                                                            craft_workstep_parameter_id:"",//参数id
                                                                            standard_parameter_type_id:"",//参数lx id
                                                                            workstage_id:"",//工序id
                                                                            work_order_id:"",//工序id
                                                                            parameter_record_steady_state_value:"",//参数记录值
                                                                            parameter_record_write_time:"",//记录时间
                                                                            parameter_record_note_taker:"",//记录人
                                                                            parameter_record_note_taker_id:"",//记录id
                                                                            parameter_record_describe:"",//描述
                                                                            parameter_record_value_type:"",//描述
                                                                          }
                                                                          req.craft_workstep_parameter_main_id = parameteRecordId
                                                                          req.workstage_id = workstageId
                                                                          req.standard_parameter_type_id = parametertypeId
                                                                          req.work_order_id = workOrderId
                                                                          req.parameter_record_value_type = ParameteValueType

                                                                          for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                            switch (i) {
                                                                              case 0: {

                                                                                break;
                                                                              }
                                                                              case 1: {
                                                                                req.parameter_record_steady_state_value = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                break;
                                                                              }
                                                                              case 2: {
                                                                                req.parameter_record_note_taker_id = $td.eq(i).find('input').attr("principal");
                                                                                req.parameter_record_note_taker = $td.eq(i).find('input').val().replace(/\s/g, "");


                                                                                break;
                                                                              }
                                                                              case 3: {

                                                                                req.parameter_record_write_time = $td.eq(i).find('input').val()
                                                                                break;
                                                                              }
                                                                              case 4: {
                                                                                req.parameter_record_describe = $td.eq(i).find('input').val().replace(/\s/g, "");

                                                                                break;
                                                                              }

                                                                            }
                                                                          }
                                                                          parameteRecords.push(req)
                                                                          console.log(parameteRecords)

                                                                        }
                                                                        let parameteRecords2
                                                                        parameteRecords2= JSON.stringify(parameteRecords);
                                                                        if (true
                                                                        ) {
                                                                          swal({
                                                                            title: '您确定要提交本次操作吗?',
                                                                            text: '请确保填写信息无误后点击确定按钮',
                                                                            type: 'question',
                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                            showCancelButton: true, // 显示用户取消按钮
                                                                            confirmButtonText: '确定',
                                                                            cancelButtonText: '取消',
                                                                          }).then(function () {
                                                                            $.ajax({
                                                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                              url: saveWorkOrderParameteRecordUrl,
                                                                              data: {
                                                                                type:"save",
                                                                                parameteRecords:parameteRecords2
                                                                              },
                                                                              success: function (result, status, xhr) {
                                                                                if (result.status === 0) {
                                                                                  swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                                }else if(result.status !== 0) {
                                                                                  let msg = result.msg
                                                                                  if(msg!==null){
                                                                                    swallFail2(msg)
                                                                                  }else{
                                                                                    swallError();	//格式不正确
                                                                                  }

                                                                                }
                                                                              }
                                                                            })
                                                                          });
                                                                        }
                                                                        else {
                                                                          swallError();	//格式不正确
                                                                        }

                                                                      })


                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: otherParamersList.length, // 总行数
                                                      displayRow: otherParamersList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })
                                                }else{
                                                  panel_5.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                }


                                              }
                                              else {
                                                mesloadBox.warningShow();
                                              }
                                            }
                                          })
                                        }


                                        addTableData(queryWorkOrderParticularsUrl, {
                                          workOrderId:workOrderId
                                        });
                                        addTableData2(queryWorkstageParticularsUrl, {
                                          workstageIds:["283b7b8fd83040d789b0dec1b88d79e5"]
                                        });

                                        break;
                                      }
                                      case "#over":{//
                                        let wordList = []
                                        wordList.push(workOrderId)
                                        swal({
                                          title: '您确定工单生产完成?',
                                          text: '完成后生产数据不可修改',
                                          type: 'question',
                                          allowEscapeKey: false, // 用户按esc键不退出
                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                          showCancelButton: true, // 显示用户取消按钮
                                          confirmButtonText: '确定',
                                          cancelButtonText: '取消',
                                        }).then(function () {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: modifyWorkOrderProductionStatusUrl,
                                            data:{
                                              type:"complete",
                                              userId:USERID,
                                              workOrderIds:wordList
                                            },
                                            success: function (result, status, xhr) {
                                              if (result.status === 0) {
                                                let activePaginationBtn = activeSwiper.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                              }else {
                                                swallFail2();	//操作失败
                                              }
                                            },

                                          })
                                        });
                                      }

                                    }
                                  })
                                  break;
                                default:
                                  break;
                              }
                            }
                          }
                        }
                      },

                      pagination: {
                        totalRow: result.map.line, // 总行数
                        displayRow: result.map.workOrders.length // 显示行数
                      },

                      ajax: {
                        url: url,
                        data: data
                      }
                    })
                  }
                  else {
                    panelTbody.empty().append(NO_DATA_NOTICE)
                    paginationContainer.hide()	//隐藏分页按钮
                    mesloadBox.warningShow();
                  }
                }
              })
            }

            // 导航栏点击时运行数据加载
            addTableData(queryWorkOrderOutlineUrl, {
							type: 'vague',
							headNum: 1
						});

            // 模糊搜索组加载数据
            fuzzySearchGroup.find('.btn').off('click').on('click', function (event) {
              let keyword = $(this).closest('.input-group').find('input').val()
              let status =statusTypeOption.val()
              let workStageID =workStageOption.val()
              let productionWorkshopID = productionWorkshopOption.val()
              // status=staffTypeOption.val()
              event.stopPropagation() // 禁止向上冒泡
              addTableData(queryWorkOrderOutlineUrl, {
                type: 'vague',
                workshopId:productionWorkshopID,
                workstageId:workStageID,
                keyword:keyword,
                workOrderProductionStatus:status,
                headNum:1
              });
            });
            // 工序集合下拉选事件
            workStageOption.off('change').on('change',function(){
              let workStageID = $(this).val()
              let status =statusTypeOption.val()
              let productionWorkshopID = productionWorkshopOption.val()
              let keyword = fuzzySearchGroup.closest('.input-group').find('input').val()
              addTableData(queryWorkOrderOutlineUrl, {
                type: 'vague',
                workshopId:productionWorkshopID,
                workstageId:workStageID,
                keyword:keyword,
                workOrderProductionStatus:status,
                headNum:1
              });
            });
            // 车间集合下拉选事件
            productionWorkshopOption.off('change').on('change',function(){
              let status =statusTypeOption.val()
              let workStageID =workStageOption.val()
              let productionWorkshopID = $(this).val()
              let keyword = fuzzySearchGroup.closest('.input-group').find('input').val()
              addTableData(queryWorkOrderOutlineUrl, {
                type: 'vague',
                workshopId:productionWorkshopID,
                workstageId:workStageID,
                keyword:keyword,
                workOrderProductionStatus:status,
                headNum:1
                });
            });
            // 状态下拉选事件
            statusTypeOption.off('change').on('change',function(){
              let status = $(this).val()
              let workStageID =workStageOption.val()
              let productionWorkshopID = productionWorkshopOption.val()
              let keyword = fuzzySearchGroup.closest('.input-group').find('input').val()
              addTableData(queryWorkOrderOutlineUrl, {
                type: 'vague',
                workshopId:productionWorkshopID,
                workstageId:workStageID,
                keyword:keyword,
                workOrderProductionStatus:status,
                headNum:1
                });
            });

      }())
				break;
			case '#myOorkOrder':	//我的工单管理
        (function () {
          let activeSwiper = $('#myOorkOrder'), // 右侧外部swiper
            activeSubSwiper = $('#myOorkOrderInerSwiper'), // 右侧内部swiper
            activePanel = activeSubSwiper.find('.panel'), // 内部swiper的面板
            activePanelHeading = activePanel.find('.panel-heading'), // 面板头部
            headingMainBtn_1 = activePanelHeading.find('.head-main-btn-1'), // 头部主要按键_1新增工艺基础信息
            panelTbody = activePanel.find('table tbody'),	//面包表格tbody
            paginationContainer = activePanel.find('.pagination'),		// 分页ul标签
            workStageOption = activePanelHeading.find('.work-stage-option'), // 工序集合
            productionWorkshopOption = activePanelHeading.find('.Production-workshop-option'), // 车间集合
            statusTypeOption = activePanelHeading.find('.status-type-option'), // 类型选项
            fuzzySearchGroup = activePanelHeading.find('.fuzzy-search-group'), // 模糊搜索组
            mesloadBox = new MesloadBox(activePanel, {
              // 主数据载入窗口
              warningContent: '没有此类信息，请重新选择或输入'
            });
            createWorkstageListSelect(workStageOption);
            createWorkshopListSelect(productionWorkshopOption);
            // 主表格添加内容
            function addTableData(url, data) {
              $.ajax({
                 type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                url: url,
                data: data,
                beforeSend: function (xml) {
                  // ajax发送前
                  mesloadBox.loadingShow()
                },
                success: function (result, status, xhr) {
                  // console.log(result);
                  // ajax成功
                  mesloadBox.hide()
                  if (result.status === 0) {
                    paginationContainer.show()
                    mesVerticalTableAddData(activePanel, {
                      thead: {
                        theadContent: '序号/工单号/生产批号/工序/计划生产数量/目前生产数量/预计完成日期/实际完成日期/生产优先级/生产状态/操作',
                        theadWidth: '4%/10%/5%/5%/5%/5%/8%/8%/5%/6%/15%'
                      },
                      tbody: {
                        html: [
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                          '<td></td>',
                        ],
                        // '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#workOrderDetailModal"><i class="fa fa-tasks fa-fw"></i>工单详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#processDetails"><i class="fa fa-tasks fa-fw"></i>过程详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#addExecutionRecordn"><i class="fa fa-tasks fa-fw"></i>添加过程记录</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#over"><i class="fa fa-tasks fa-fw"></i>完成</a></td>'

                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                        dataAddress: function (tbodyTarget, html, result) {
                          tbodyTarget.empty() // 清空表格主体
                          let map = result.map, // 映射zszs
                            dataList = map.workOrders, // 主要数据列表
                            tempData = null; // 表格td内的临时数据
                          for (let i = 0, len = dataList.length; i < len; i++) {
                            tbodyTarget.append('<tr></tr>'); // 添加行
                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                            for (let i = 0, len = html.length; i < len; i++) {
                              currentTr.append(html[i]); // 添加表格内的HTML
                              switch (i) {
                                case 0:
                                  currentTr.children().eq(i).html(currentTr.index() + 1)
                                  break;
                                case 1: {
                                  tempData = dataList[currentTr.index()].work_order_number;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 2: {
                                	tempData = dataList[currentTr.index()].plan.production_plan_batch_number;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 3: {
                                  tempData = dataList[currentTr.index()].planQuotesWorkstage.workstage_name;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 4: {
                                  tempData = dataList[currentTr.index()].work_order_expected_output;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 5: {
                                  tempData = dataList[currentTr.index()].work_order_actual_output;
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 6: {
                                  tempData = dataList[currentTr.index()].work_order_estimated_completion_time;
                                  if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                    currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                  }else{
                                    currentTr.children().eq(i).html("/")
                                  }
                                }
                                  break;
                                case 7: {
                                  tempData = dataList[currentTr.index()].work_order_actual_finish_time;
                                  if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                    currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                  }else{
                                    currentTr.children().eq(i).html("/")
                                  }
                                }
                                  break;
                                case 8: {
                                  tempData = dataList[currentTr.index()].plan.production_plan_production_priority;//优先级
                                  currentTr.children().eq(i).html(tempData)
                                }
                                  break;
                                case 9: {
                                  tempData = dataList[currentTr.index()].workOrderStatus.plan_production_status;
                                  if(tempData ==0){
                                    currentTr.children().eq(i).html("未生产")
                                  }else if(tempData ==1){
                                    currentTr.children().eq(i).html("生产中")
                                  }
                                  else if(tempData ==2){
                                    currentTr.children().eq(i).html("已暂停")
                                  }
                                  else if(tempData ==3){
                                    currentTr.children().eq(i).html("生产完成")
                                  }
                                  else if(tempData ==4){
                                    currentTr.children().eq(i).html("停止生产")
                                  }else if(tempData ==5){
																		currentTr.children().eq(i).html("等待生产")
																	}
                                }
                                  break;
                                case 10:
                                  tempData = dataList[currentTr.index()].workOrderStatus.plan_production_status;
                                  if(tempData == 3){
                                    currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-modal-target="#workOrderDetailModal"><i class="fa fa-tasks fa-fw"></i>工单详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#processDetails"><i class="fa fa-tasks fa-fw"></i>过程详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#addExecutionRecordn"><i class="fa fa-tasks fa-fw"></i>添加过程记录</a>`)
                                  }
                                  else if(tempData == 2){
                                    currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-modal-target="#workOrderDetailModal"><i class="fa fa-tasks fa-fw"></i>工单详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#processDetails"><i class="fa fa-tasks fa-fw"></i>过程详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#addExecutionRecordn"><i class="fa fa-tasks fa-fw"></i>添加过程记录</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#start"><i class="fa fa-tasks fa-fw"></i>开始</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#over"><i class="fa fa-tasks fa-fw"></i>完成</a>`)

                                  }
                                  else if(tempData == 1){
                                    currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-modal-target="#workOrderDetailModal"><i class="fa fa-tasks fa-fw"></i>工单详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#processDetails"><i class="fa fa-tasks fa-fw"></i>过程详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#addExecutionRecordn"><i class="fa fa-tasks fa-fw"></i>添加过程记录</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#pause"><i class="fa fa-tasks fa-fw"></i>暂停</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#over"><i class="fa fa-tasks fa-fw"></i>完成</a>`)

                                  }
                                  else{
                                    currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-modal-target="#workOrderDetailModal"><i class="fa fa-tasks fa-fw"></i>工单详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#processDetails"><i class="fa fa-tasks fa-fw"></i>过程详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#addExecutionRecordn"><i class="fa fa-tasks fa-fw"></i>添加过程记录</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#over"><i class="fa fa-tasks fa-fw"></i>完成</a>`)
                                  }
                                  currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                    workOrderId = dataList[currentTr.index()].work_order_id,
                                    workOrderStatus =dataList[currentTr.index()].workOrderStatus.plan_production_status,
                                    workstageId = []
                                    workstageId.push(dataList[currentTr.index()].workstage_id)
                                    console.log(dataContent)
                                    switch (dataContent) {
                                      case '#workOrderDetailModal': {	//工单详情
                                        if(workOrderStatus == 3){//详情
                                          let dataContent = $('#workOrderDetailModal'),
                                            panelList = dataContent.find('.panel'),
                                            panel_1=panelList.eq(0),
                                            panel_2=panelList.eq(1),
                                            panel_3=panelList.eq(2),
                                            panel_4=panelList.eq(3),
                                            panel_5=panelList.eq(4),
                                            modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                            modalSubmitBtn = dataContent.find('.modal-submit')


                                          panel_1.find('.panel-heading').find('.panel-title').text("基本详情") // 更换panel标题
                                          panel_2.find('.panel-heading').find('.panel-title').text("工步") // 更换panel标题
                                          panel_3.find('.panel-heading').find('.panel-title').text("环境参数") // 更换panel标题
                                          panel_4.find('.panel-heading').find('.panel-title').text("半成品参数") // 更换panel标题
                                          panel_5.find('.panel-heading').find('.panel-title').text("其他") // 更换panel标题

                                          dataContent.modal({
                                            backdrop: false, // 黑色遮罩不可点击
                                            keyboard: false,  // esc按键不可弃用模态框
                                            show: false
                                          })
                                          dataContent.modal('show') // 运行时显示
                                          modalSubmitBtn.hide()

                                          // dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                          //   $('body').addClass('modal-open')
                                          // })

                                          modalCloseBtn.off('click').on('click', (event) => {
                                            // 点击弃用按钮隐藏该模态框
                                            dataContent.modal('hide')
                                            // 初始化表格
                                            panel_2.find("tbody").empty()
                                            panel_3.find("tbody").empty()
                                            panel_4.find("tbody").empty()
                                            panel_5.find("tbody").empty()
                                          })
                                          // 添加主体表单数据
                                          function addTableData(url, data) {
                                            $.ajax({
                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                              url: url,
                                              data: data,
                                              beforeSend: function (xml) {
                                                // ajax发送前
                                                mesloadBox.loadingShow()
                                              },
                                              success: function (result, status, xhr) {
                                                // ajax成功
                                                mesloadBox.hide()
                                                if (result.status === 0) {
                                                  //panel1 基础消息
                                                  mesHorizontalTableAddData(panel_1.find('table'), null, {
                                                    thead: '工单号/所属生产批号/产品型号/工艺/工艺版本/工序/工序优率/工序负责人/极性/半成品类型/半成品型号/预计产出量/半成品单位/生产线/生产车间/生产优先级/工单创建人/工单负责人/工单创建时间/预定开始日期/预定完成时间/实际产出量/实际开始时间/实际完成日期/班次',
                                                    tableWitch: '15%/15%/15%',
                                                    viewColGroup: 3,
                                                    importStaticData: (tbodyTd, length) => {
                                                      let map = result.map, // 映射
                                                      dataList = map.workOrder, // 主要数据列表
                                                      selectHtml = `<select class="form-control table-input input-sm"></select>`,
                                                      tempData = null; // 表格td内的临时数据

                                                      for (let i = 0, len = length; i < len; i++) {
                                                        switch (i) {
                                                          case 0: {
                                                            tempData = dataList.work_order_number
                                                            tbodyTd.eq(i).html(tempData);
                                                          }
                                                            break;
                                                          case 1: {
                                                            tempData = dataList.plan.production_plan_batch_number;
                                                            tbodyTd.eq(i).html(tempData);
                                                          }
                                                            break;
                                                          case 2: {
                                                            tempData =  dataList.plan.product_model_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 3: {
                                                            tempData = dataList.plan.craft_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 4: {
                                                            tempData = dataList.plan.craft_versions
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 5: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 6: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_quality_rate
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 7: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_responsible
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 8: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_polarity
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 9: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_type_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 10: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_genre
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 11: {
                                                            tempData = dataList.work_order_expected_output
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 12: {

                                                            tempData = dataList.planQuotesWorkstage.semi_finish_unit
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 13: {
                                                            tempData = dataList.plan.product_line_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 14: {
                                                            tempData = dataList.plan.product_line_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 15: {
                                                            tempData = dataList.plan.production_plan_production_priority
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 16: {
                                                            tempData = dataList.work_order_creators
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 17: {
                                                            tempData = dataList.work_order_responsible
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 18: {
                                                            tempData = dataList.work_order_creation_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 19: {
                                                            tempData = dataList.work_order_scheduled_start_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 20: {
                                                            tempData = dataList.work_order_estimated_completion_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 21: {
                                                            tempData = dataList.work_order_actual_output
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 22: {
                                                            tempData = dataList.work_order_actual_start_time
                                                           
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 23: {
                                                            tempData = dataList.work_order_actual_finish_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }

                                                          }
                                                          break;
                                                          case 24: {
                                                            tempData = dataList.work_order_classes
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          default:
                                                            break;
                                                        }
                                                      }

                                                    }
                                                  })
                                                }
                                                else {
                                                  mesloadBox.warningShow();
                                                }
                                              }
                                            })
                                          }
                                          function addTableData2(url, data) {
                                            $.ajax({
                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                              url: url,
                                              data: data,
                                              beforeSend: function (xml) {
                                                // ajax发送前
                                                mesloadBox.loadingShow()
                                              },
                                              success: function (result, status, xhr) {
                                                // ajax成功
                                                mesloadBox.hide()
                                                if (result.status === 0) {
                                                  let parmList = result.map.workstageList[0].useParametersList,
                                                  semiProParamersList=[],//半成品参数集合
                                                  EnvirParamersList=[],//环境参数集合
                                                  otherParamersList=[]//其他参数集合

                                                  // for(var i=0;i<parmList.length;i++){
                                                  //   if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                  //     EnvirParamersList.push(parmList[i])
                                                  //   }else if(parmList[i].standard_parameter_type_id === semiProParamersTypeId){
                                                  //     semiProParamersList.push(parmList[i])
                                                  //   }else{
                                                  //     otherParamersList.push(parmList[i])
                                                  //   }
                                                  // }
                                                  for(var i=0;i<parmList.length;i++){
                                                    if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                      EnvirParamersList.push(parmList[i])
                                                    }else{
                                                      semiProParamersList.push(parmList[i])
                                                    }
                                                  }

                                                  //panel2 工步
                                                  mesVerticalTableAddData(panel_2, {
                                                    thead: {
                                                      theadContent: '序号/工步名称/工步版本/工步编号/操作',
                                                      theadWidth: '6%/10%/10%/10%/35%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal3"><i class="fa fa-tasks fa-fw"></i>查看物料使用详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#stepParm"><i class="fa fa-tasks fa-fw"></i>查看工步参数</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#devicesRecord"><i class="fa fa-tasks fa-fw"></i>查看设备操作记录</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let map = result.map, // 映射zszs
                                                        dataList = map.workstageList[0].stageAndStepRelationList, // 主要数据列表
                                                          tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_name;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_version;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_num;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 4:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  stepId = dataList[currentTr.index()].workstep.craft_control_workstep_id;
                                                                  let  stepId2 = [];
                                                                  stepId2.push(stepId)
                                                                  switch (dataContent) {
                                                                    case '#detailModal3': {	//物料详情
                                                                      let dataContent = $('#detailModal3'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        panel_1 = panelList.eq(0),
                                                                        panel_2 = panelList.eq(1),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        statusTypeOption = panel_2.find('.status-type-option'), // 类型选项
                                                                        temp=`
                                                                        <option value="norm">请选择</option>
                                                                        <option value="materialName">按物料查看</option>
                                                                        <option value="materialUseTimeAsc">按时间升序</option>
                                                                        <option value="materialUseTimeDesc">按时间降序</option>
                                                                        `

                                                                        statusTypeOption.append(temp)


                                                                        panel_1.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题
                                                                        panel_2.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                          statusTypeOption.empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              // 详情1
                                                                              mesVerticalTableAddData(panel_1, {
                                                                                thead: {
                                                                                  theadContent: '序号/物料名称/规格/型号/单位/操作',
                                                                                  theadWidth: '6%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                    dataList = map.workstepList[0].useMaterielList, // 主要数据列表

                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;

                                                                                          case 5:
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              stepMaterialId = dataList[currentTr.index()].craft_materiel_id;
                                                                                              switch (dataContent) {
                                                                                                case '#detailModal': {	//详情
                                                                                                  let dataContent = $('#detailModal2'),
                                                                                                    panelList = dataContent.find('.panel'),
                                                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                    panelThead = panelList.find('thead'),
                                                                                                    panelTbody = panelList.find('tbody');
                                                                                                    panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                                                    dataContent.modal({
                                                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                                                      show: false
                                                                                                    })
                                                                                                    dataContent.modal('show') // 运行时显示
                                                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                      $('body').addClass('modal-open')
                                                                                                    })

                                                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                                                      // 点击弃用按钮隐藏该模态框
                                                                                                      dataContent.modal('hide')
                                                                                                      // 初始化表格
                                                                                                      panelList.find('thead').empty()
                                                                                                      panelList.find('tbody').empty()
                                                                                                    })

                                                                                                  // 主表格添加内容
                                                                                                  function addTableData(url, data) {
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url: url,
                                                                                                      data: data,
                                                                                                      beforeSend: function (xml) {
                                                                                                        // ajax发送前
                                                                                                        mesloadBox.loadingShow()
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        // ajax成功
                                                                                                        mesloadBox.hide()
                                                                                                        if (result.status === 0) {
                                                                                                          //panel1
                                                                                                          mesVerticalTableAddData(panelList, {
                                                                                                            thead: {
                                                                                                              theadContent: '序号/投料时间/使用数量/投料人/物料编号/备注',
                                                                                                              theadWidth: '6%/22%/13%/15%/15%/15%'
                                                                                                            },
                                                                                                            tbody: {
                                                                                                              html: [
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>'
                                                                                                              ],

                                                                                                              // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                                              dataAddress: function (tbodyTarget, html, result) {
                                                                                                                tbodyTarget.empty() // 清空表格主体
                                                                                                                let map = result.map, // 映射zszs
                                                                                                                  dataList = map.materialUseRecords, // 主要数据列表
                                                                                                                  tempData = null; // 表格td内的临时数据
                                                                                                                for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                                                  tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                                                  let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                                                  for (let i = 0, len = html.length; i < len; i++) {
                                                                                                                    currentTr.append(html[i]); // 添加表格内的HTML
                                                                                                                    switch (i) {
                                                                                                                      case 0:
                                                                                                                        currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                                                        break;
                                                                                                                      case 1: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_time;
                                                                                                                        // tempData=
                                                                                                                        currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 2: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_amount;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 3: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_user;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 4: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_number;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 5: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_describe;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;


                                                                                                                      default:
                                                                                                                        break;
                                                                                                                    }
                                                                                                                  }
                                                                                                                }
                                                                                                              }
                                                                                                            },

                                                                                                            pagination: {
                                                                                                              totalRow: result.map.line, // 总行数
                                                                                                              displayRow: result.map.materialUseRecords.length // 显示行数
                                                                                                            },

                                                                                                            ajax: {
                                                                                                              url: url,
                                                                                                              data: data
                                                                                                            }
                                                                                                          })


                                                                                                        }
                                                                                                        else {
                                                                                                          mesloadBox.warningShow();
                                                                                                        }
                                                                                                      }
                                                                                                    })
                                                                                                  }

                                                                                                  // 导航栏点击时运行数据加载
                                                                                                  addTableData(queryWorkOrderMaterialUseRecordUrl, {
                                                                                                    type:"norm",
                                                                                                    workOrderId: workOrderId,
                                                                                                    stepMaterialId:stepMaterialId,
                                                                                                    headNum: 1
                                                                                                  });

                                                                                                  break;
                                                                                                }


                                                                                              }
                                                                                            })
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow:result.map.workstepList[0].useMaterielList.length, // 总行数
                                                                                displayRow: result.map.workstepList[0].useMaterielList.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })



                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }
                                                                      function addTableData2(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {

                                                                              mesVerticalTableAddData(panel_2, {
                                                                                thead: {
                                                                                  theadContent: '序号/物料名称/规格/型号/单位/投料时间/使用数量/投料人/物料编号/备注',
                                                                                  theadWidth: '6%/10%/9%/9%/9%/16%/9%/10%/10%/10%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.materialUseRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_amount;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 7: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_user;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 8: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;

                                                                                          case 9: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_describe;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.materialUseRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryStepParticularsUrl, {
                                                                        stepIds:stepId2,
                                                                      });
                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData2(queryWorkOrderMaterialUseRecordUrl, {
                                                                        type:"norm",
                                                                        workOrderId: workOrderId,
                                                                        stepId:stepId,
                                                                        headNum: 1
                                                                      });


                                                                      statusTypeOption.off("change").on("change",function(){
                                                                        let status = $(this).val();
                                                                        addTableData2(queryWorkOrderMaterialUseRecordUrl, {
                                                                          type:status,
                                                                          workOrderId: workOrderId,
                                                                          stepId:stepId,
                                                                          headNum: 1
                                                                        });
                                                                      })

                                                                      break;
                                                                    }
                                                                    case '#stepParm': {	//工步参数详情
                                                                      let dataContent = $('#detailModal3'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        panel_1 = panelList.eq(0),
                                                                        panel_2 = panelList.eq(1),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        statusTypeOption = panel_2.find('.status-type-option'), // 类型选项
                                                                        temp=`
                                                                        <option value="norm">请选择</option>
                                                                        <option value="stepParameteName">按参数名称</option>
                                                                        <option value="parameteRecordTimeAsc">按时间升序</option>
                                                                        <option value="parameteRecordTimeDesc">按时间降序</option>
                                                                        `

                                                                        statusTypeOption.append(temp)


                                                                        panel_1.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题
                                                                        panel_2.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示

                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                          statusTypeOption.empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panel_1, {
                                                                                thead: {
                                                                                  theadContent: '序号/参数/值类型/参考值/单位/设备类型/操作',
                                                                                  theadWidth: '6%/15%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                    dataList = map.workstepList[0].workstepParameterList, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                            if(tempData = "constantValue"){
                                                                                              currentTr.children().eq(i).html( "固定值")
                                                                                            }else if(tempData = "rangeValue"){
                                                                                              currentTr.children().eq(i).html("范围值")
                                                                                            }else if(tempData = "deviationValue"){
                                                                                              currentTr.children().eq(i).html("浮动值")
                                                                                            }
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                            let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                            let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                            let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                            let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                              if(tempData == "constantValue"){
                                                                                                currentTr.children().eq(i).html(constantValue)
                                                                                              }else if(tempData == "rangeValue"){
                                                                                                currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                              }else if(tempData == "deviationValue"){
                                                                                                currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                              }
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_type_id;
                                                                                            let 	selectHtml = `<select class="form-control table-input input-sm"></select>`
                                                                                            currentTr.children().eq(i).addClass('table-input-td')
                                                                                            currentTr.children().eq(i).html(selectHtml)

                                                                                            let target =  currentTr.children().eq(i).find('select');
                                                                                            for (let i = 0, len = devicesTypeList.length; i < len; i++) {
                                                                                              let optionStr = `<option value="${devicesTypeList[i].devices_control_devices_type_id}">${devicesTypeList[i].devices_control_devices_type_name}</option>`;
                                                                                              target.append(optionStr);
                                                                                            }
                                                                                            target.val(tempData).attr('disabled',true)
                                                                                          }
                                                                                            break;
                                                                                          case 6:
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              stepParameteId = dataList[currentTr.index()].craft_workstep_parameter_id;
                                                                                              switch (dataContent) {
                                                                                                case '#detailModal': {	//详情
                                                                                                  let dataContent = $('#detailModal2'),
                                                                                                    panelList = dataContent.find('.panel'),
                                                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                    panelThead = panelList.find('thead'),
                                                                                                    panelTbody = panelList.find('tbody');
                                                                                                    panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                                                    dataContent.modal({
                                                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                                                      show: false
                                                                                                    })
                                                                                                    dataContent.modal('show') // 运行时显示
                                                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                      $('body').addClass('modal-open')
                                                                                                    })

                                                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                                                      // 点击弃用按钮隐藏该模态框
                                                                                                      dataContent.modal('hide')
                                                                                                      // 初始化表格
                                                                                                      panelList.find('thead').empty()
                                                                                                      panelList.find('tbody').empty()
                                                                                                    })

                                                                                                  // 主表格添加内容
                                                                                                  function addTableData(url, data) {
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url: url,
                                                                                                      data: data,
                                                                                                      beforeSend: function (xml) {
                                                                                                        // ajax发送前
                                                                                                        mesloadBox.loadingShow()
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        // ajax成功
                                                                                                        mesloadBox.hide()
                                                                                                        if (result.status === 0) {
                                                                                                          //panel1
                                                                                                          mesVerticalTableAddData(panelList, {
                                                                                                            thead: {
                                                                                                              theadContent: '序号/参数值/记录人/记录时间/设备编号/备注',
                                                                                                              theadWidth: '6%/15%/15%/18%/15%/15%'
                                                                                                            },
                                                                                                            tbody: {
                                                                                                              html: [
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>'
                                                                                                              ],

                                                                                                              // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                                              dataAddress: function (tbodyTarget, html, result) {
                                                                                                                tbodyTarget.empty() // 清空表格主体
                                                                                                                let map = result.map, // 映射zszs
                                                                                                                  dataList = map.stepParameteRecords, // 主要数据列表
                                                                                                                  tempData = null; // 表格td内的临时数据
                                                                                                                  console.log(dataList)
                                                                                                                for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                                                  tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                                                  let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                                                  for (let i = 0, len = html.length; i < len; i++) {
                                                                                                                    currentTr.append(html[i]); // 添加表格内的HTML
                                                                                                                    switch (i) {
                                                                                                                      case 0:
                                                                                                                        currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                                                        break;
                                                                                                                      case 1: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_steady_state_value;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 2: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_note_taker;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 3: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_write_time;
                                                                                                                        currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 4: {
                                                                                                                        tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 5: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_describe;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      default:
                                                                                                                        break;
                                                                                                                    }
                                                                                                                  }
                                                                                                                }
                                                                                                              }
                                                                                                            },

                                                                                                            pagination: {
                                                                                                              totalRow: result.map.line, // 总行数
                                                                                                              displayRow: result.map.stepParameteRecords.length // 显示行数
                                                                                                            },

                                                                                                            ajax: {
                                                                                                              url: url,
                                                                                                              data: data
                                                                                                            }
                                                                                                          })
                                                                                                        }
                                                                                                        else {
                                                                                                          mesloadBox.warningShow();
                                                                                                        }
                                                                                                      }
                                                                                                    })
                                                                                                  }

                                                                                                  // 导航栏点击时运行数据加载
                                                                                                  addTableData(queryWorkOrderStepParameteRecordUrl, {
                                                                                                    type:"norm",
                                                                                                    workOrderId: workOrderId,
                                                                                                    stepParameteId:stepParameteId,
                                                                                                    headNum: 1
                                                                                                  });

                                                                                                  break;
                                                                                                }


                                                                                              }
                                                                                            })
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.workstepList[0].workstepParameterList.length, // 总行数
                                                                                  displayRow: result.map.workstepList[0].workstepParameterList.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })



                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }
                                                                      function addTableData2(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1

                                                                              mesVerticalTableAddData(panel_2, {
                                                                                thead: {
                                                                                  theadContent: '序号/参数名称/参数类型/参考值/实际值/单位/设备类型/设备编号/记录人/时间/备注',
                                                                                    theadWidth: '6%/10%/8%/8%/8%/8%/8%/8%/8%/8%/8%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.stepParameteRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                            if(tempData = "constantValue"){
                                                                                              currentTr.children().eq(i).html( "固定值")
                                                                                            }else if(tempData = "rangeValue"){
                                                                                              currentTr.children().eq(i).html("范围值")
                                                                                            }else if(tempData = "deviationValue"){
                                                                                              currentTr.children().eq(i).html("浮动值")
                                                                                            }
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                            let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                            let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                            let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                            let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                              if(tempData == "constantValue"){
                                                                                                currentTr.children().eq(i).html(constantValue)
                                                                                              }else if(tempData == "rangeValue"){
                                                                                                currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                              }else if(tempData == "deviationValue"){
                                                                                                currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                              }
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_type_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 7: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 8: {
                                                                                            tempData = dataList[currentTr.index()].step_use_note_taker;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 9: {
                                                                                            tempData = dataList[currentTr.index()].step_use_write_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 10: {
                                                                                            tempData = dataList[currentTr.index()].step_use_describe;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;



                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.stepParameteRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryStepParticularsUrl, {
                                                                        stepIds:stepId2,
                                                                      });
                                                                       // 导航栏点击时运行数据加载
                                                                       addTableData2(queryWorkOrderStepParameteRecordUrl, {
                                                                        type:"stepParameteName",
                                                                        workOrderId: workOrderId,
                                                                        stepId:stepId,
                                                                        headNum: 1
                                                                      });

                                                                      statusTypeOption.off("change").on("change",function(){
                                                                        let status = $(this).val();
                                                                        addTableData2(queryWorkOrderStepParameteRecordUrl, {
                                                                          type:status,
                                                                          workOrderId: workOrderId,
                                                                          stepId:stepId,
                                                                          headNum: 1
                                                                        });
                                                                      })

                                                                      break;
                                                                    }
                                                                    case '#devicesRecord': {	//设备操作记录
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/设备名称/设备编号/开始时间时间/结束时间/设备状态/操作人',
                                                                                  theadWidth: '6%/12%/12%/18%/17%/10%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.devicesOperationRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                      console.log(dataList)
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_start_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_end_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_operator_type;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_operator;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.devicesOperationRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })
                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderDevicesOperationRecordUrl, {
                                                                        stepId: stepId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: result.map.workstageList[0].stageAndStepRelationList.length, // 总行数
                                                      displayRow: result.map.workstageList[0].stageAndStepRelationList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })

                                                  //panel3 环境参数
                                                  mesVerticalTableAddData(panel_3, {
                                                    thead: {
                                                      theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                      theadWidth: '4%/15%/15%/15%/15%/15%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                          let dataList =  EnvirParamersList,//环境参数集合,
                                                          tempData = null; // 表格td内的临时数据
                                                        for (let j = 0, len = dataList.length; j < len; j++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(j); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                // tempData=
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                if(tempData = "constantValue"){
                                                                  currentTr.children().eq(i).html( "固定值")
                                                                }else if(tempData = "rangeValue"){
                                                                  currentTr.children().eq(i).html("范围值")
                                                                }else if(tempData = "deviationValue"){
                                                                  currentTr.children().eq(i).html("浮动值")
                                                                }
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                              let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                              let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                              let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                              let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                if(tempData == "constantValue"){
                                                                  currentTr.children().eq(i).html(constantValue)
                                                                }else if(tempData == "rangeValue"){
                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                }else if(tempData == "deviationValue"){
                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                }
                                                              }
                                                                break;
                                                              case 4: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id;
                                                                  switch (dataContent) {
                                                                    case '#detailModal': {	//详情
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/实际值/记录人/记录时间/备注',
                                                                                  theadWidth: '6%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.parameteRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-btn="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a>`)
                                                                                            parameteRecordIds = dataList[currentTr.index()].parameter_record_id;

                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              swal({
                                                                                                title: '您确定要删除吗？',
                                                                                                type: 'question',
                                                                                                showCancelButton: true,
                                                                                                confirmButtonText: '确定',
                                                                                                cancelButtonText: '取消'
                                                                                              }).then(function (){
                                                                                                $.ajax({
                                                                                                   type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                  url:removeWorkOrderParameteRecordUrl,
                                                                                                  data: {
                                                                                                    parameteRecordIds:parameteRecordIds,
                                                                                                  },
                                                                                                  success: function (result, status, xhr) {
                                                                                                    if (result.status === 0) {
                                                                                                      let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                      swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                    }else {
                                                                                                      swal({
                                                                                                        title: '删除失败',
                                                                                                        type: 'warning',
                                                                                                        timer: '1000',
                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                        showCancelButton: false, // 显示用户取消按钮
                                                                                                        showConfirmButton: false, // 显示用户确认按钮
                                                                                                    })
                                                                                                    }
                                                                                                  },
                                                                                                })
                                                                                              })
                                                                                            })

                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.parameteRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderParameteRecordUrl, {
                                                                        parameteId:parameteId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: EnvirParamersList.length , // 总行数
                                                      displayRow: EnvirParamersList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })

                                                  //panel3  半成品参数

                                                  if(semiProParamersList.length!==0){
                                                    mesVerticalTableAddData(panel_4, {
                                                      thead: {
                                                        theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                        theadWidth: '4%/15%/15%/15%/15%/15%'
                                                      },
                                                      tbody: {
                                                        html: [
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                        ],

                                                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                        dataAddress: function (tbodyTarget, html, result) {
                                                          tbodyTarget.empty() // 清空表格主体
                                                          let  dataList = semiProParamersList, // 主要数据列表
                                                            tempData = null; // 表格td内的临时数据
                                                          for (let i = 0, len = dataList.length; i < len; i++) {
                                                            tbodyTarget.append('<tr></tr>'); // 添加行
                                                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                            for (let i = 0, len = html.length; i < len; i++) {
                                                              currentTr.append(html[i]); // 添加表格内的HTML
                                                              switch (i) {
                                                                case 0:
                                                                  currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                  break;
                                                                case 1: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                  // tempData=
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;
                                                                case 2: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  if(tempData = "constantValue"){
                                                                    currentTr.children().eq(i).html( "固定值")
                                                                  }else if(tempData = "rangeValue"){
                                                                    currentTr.children().eq(i).html("范围值")
                                                                  }else if(tempData = "deviationValue"){
                                                                    currentTr.children().eq(i).html("浮动值")
                                                                  }
                                                                }
                                                                  break;
                                                                case 3: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                  let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                  let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                  let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                                }
                                                                  break;
                                                                case 4: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;

                                                                case 5:
                                                                  currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                    parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id;
                                                                    switch (dataContent) {
                                                                      case '#detailModal': {	//详情
                                                                        let dataContent = $('#detailModal2'),
                                                                          panelList = dataContent.find('.panel'),
                                                                          modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                          panelThead = panelList.find('thead'),
                                                                          panelTbody = panelList.find('tbody');
                                                                          panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                          dataContent.modal({
                                                                            backdrop: false, // 黑色遮罩不可点击
                                                                            keyboard: false,  // esc按键不可弃用模态框
                                                                            show: false
                                                                          })
                                                                          dataContent.modal('show') // 运行时显示
                                                                          dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                            $('body').addClass('modal-open')
                                                                          })

                                                                          modalCloseBtn.off('click').on('click', (event) => {
                                                                            // 点击弃用按钮隐藏该模态框
                                                                            dataContent.modal('hide')
                                                                            // 初始化表格
                                                                            panelList.find('thead').empty()
                                                                            panelList.find('tbody').empty()
                                                                          })

                                                                        // 主表格添加内容
                                                                        function addTableData(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {
                                                                                //panel1
                                                                                mesVerticalTableAddData(panelList, {
                                                                                  thead: {
                                                                                    theadContent: '序号/实际值/记录人/记录时间/备注',
                                                                                    theadWidth: '6%/15%/15%/15%/15%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>'
                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                        dataList = map.parameteRecords, // 主要数据列表
                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                              // tempData=
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                              currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-btn="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a>`)
                                                                                              parameteRecordIds = dataList[currentTr.index()].parameter_record_id;

                                                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                swal({
                                                                                                  title: '您确定要删除吗？',
                                                                                                  type: 'question',
                                                                                                  showCancelButton: true,
                                                                                                  confirmButtonText: '确定',
                                                                                                  cancelButtonText: '取消'
                                                                                                }).then(function (){
                                                                                                  $.ajax({
                                                                                                     type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                    url:removeWorkOrderParameteRecordUrl,
                                                                                                    data: {
                                                                                                      parameteRecordIds:parameteRecordIds,
                                                                                                    },
                                                                                                    success: function (result, status, xhr) {
                                                                                                      if (result.status === 0) {
                                                                                                        let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                        swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                      }else {
                                                                                                        swal({
                                                                                                          title: '删除失败',
                                                                                                          type: 'warning',
                                                                                                          timer: '1000',
                                                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                          showCancelButton: false, // 显示用户取消按钮
                                                                                                          showConfirmButton: false, // 显示用户确认按钮
                                                                                                      })
                                                                                                      }
                                                                                                    },
                                                                                                  })
                                                                                                })
                                                                                              })

                                                                                            }
                                                                                              break;


                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.line, // 总行数
                                                                                    displayRow: result.map.parameteRecords.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })


                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }

                                                                        // 导航栏点击时运行数据加载
                                                                        addTableData(queryWorkOrderParameteRecordUrl, {
                                                                          parameteId:parameteId,
                                                                          headNum: 1
                                                                        });

                                                                        break;
                                                                      }


                                                                    }
                                                                  })
                                                                  break;
                                                                default:
                                                                  break;
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },

                                                      pagination: {
                                                        totalRow: semiProParamersList.length, // 总行数
                                                        displayRow: semiProParamersList.length // 显示行数
                                                      },

                                                      ajax: {
                                                        url: url,
                                                        data: data
                                                      }
                                                    })
                                                  }else{
                                                    panel_4.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                  }


                                                  //panel3  其他
                                                  if(otherParamersList.length!==0){
                                                    mesVerticalTableAddData(panel_5, {
                                                      thead: {
                                                        theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                        theadWidth: '4%/15%/15%/15%/15%/15%'
                                                      },
                                                      tbody: {
                                                        html: [
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                        ],

                                                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                        dataAddress: function (tbodyTarget, html, result) {
                                                          tbodyTarget.empty() // 清空表格主体
                                                          let dataList = otherParamersList, // 主要数据列表
                                                            tempData = null; // 表格td内的临时数据
                                                          for (let i = 0, len = dataList.length; i < len; i++) {
                                                            tbodyTarget.append('<tr></tr>'); // 添加行
                                                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                            for (let i = 0, len = html.length; i < len; i++) {
                                                              currentTr.append(html[i]); // 添加表格内的HTML
                                                              switch (i) {
                                                                case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                                case 1: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                  // tempData=
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;
                                                                case 2: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  if(tempData = "constantValue"){
                                                                    currentTr.children().eq(i).html( "固定值")
                                                                  }else if(tempData = "rangeValue"){
                                                                    currentTr.children().eq(i).html("范围值")
                                                                  }else if(tempData = "deviationValue"){
                                                                    currentTr.children().eq(i).html("浮动值")
                                                                  }
                                                                }
                                                                  break;
                                                                case 3: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                  let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                  let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                  let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                                }
                                                                  break;
                                                                case 4: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;

                                                                case 5:
                                                                  currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                    parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id;
                                                                    switch (dataContent) {
                                                                      case '#detailModal': {	//详情
                                                                        let dataContent = $('#detailModal2'),
                                                                          panelList = dataContent.find('.panel'),
                                                                          modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                          panelThead = panelList.find('thead'),
                                                                          panelTbody = panelList.find('tbody');
                                                                          panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                          dataContent.modal({
                                                                            backdrop: false, // 黑色遮罩不可点击
                                                                            keyboard: false,  // esc按键不可弃用模态框
                                                                            show: false
                                                                          })
                                                                          dataContent.modal('show') // 运行时显示
                                                                          dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                            $('body').addClass('modal-open')
                                                                          })

                                                                          modalCloseBtn.off('click').on('click', (event) => {
                                                                            // 点击弃用按钮隐藏该模态框
                                                                            dataContent.modal('hide')
                                                                            // 初始化表格
                                                                            panelList.find('thead').empty()
                                                                            panelList.find('tbody').empty()
                                                                          })

                                                                        // 主表格添加内容
                                                                        function addTableData(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {
                                                                                //panel1
                                                                                mesVerticalTableAddData(panelList, {
                                                                                  thead: {
                                                                                    theadContent: '序号/实际值/记录人/记录时间/备注',
                                                                                    theadWidth: '6%/15%/15%/15%/15%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>'
                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                        dataList = map.parameteRecords, // 主要数据列表
                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                              // tempData=
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                              currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              currentTr.children().eq(i).html(`<a class="table-link" href="javascript:;" data-toggle-btn="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a>`)
                                                                                              parameteRecordIds = dataList[currentTr.index()].parameter_record_id;

                                                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                swal({
                                                                                                  title: '您确定要删除吗？',
                                                                                                  type: 'question',
                                                                                                  showCancelButton: true,
                                                                                                  confirmButtonText: '确定',
                                                                                                  cancelButtonText: '取消'
                                                                                                }).then(function (){
                                                                                                  $.ajax({
                                                                                                     type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                    url:removeWorkOrderParameteRecordUrl,
                                                                                                    data: {
                                                                                                      parameteRecordIds:parameteRecordIds,
                                                                                                    },
                                                                                                    success: function (result, status, xhr) {
                                                                                                      if (result.status === 0) {
                                                                                                        let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                        swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                      }else {
                                                                                                        swal({
                                                                                                          title: '删除失败',
                                                                                                          type: 'warning',
                                                                                                          timer: '1000',
                                                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                          showCancelButton: false, // 显示用户取消按钮
                                                                                                          showConfirmButton: false, // 显示用户确认按钮
                                                                                                      })
                                                                                                      }
                                                                                                    },
                                                                                                  })
                                                                                                })
                                                                                              })

                                                                                            }
                                                                                              break;


                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.line, // 总行数
                                                                                    displayRow: result.map.parameteRecords.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })


                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }

                                                                        // 导航栏点击时运行数据加载
                                                                        addTableData(queryWorkOrderParameteRecordUrl, {
                                                                          parameteId:parameteId,
                                                                          headNum: 1
                                                                        });

                                                                        break;
                                                                      }


                                                                    }
                                                                  })
                                                                  break;
                                                                default:
                                                                  break;
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },

                                                      pagination: {
                                                        totalRow:otherParamersList.length, // 总行数
                                                        displayRow: otherParamersList.length // 显示行数
                                                      },

                                                      ajax: {
                                                        url: url,
                                                        data: data
                                                      }
                                                    })
                                                  }else{
                                                    panel_5.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                  }


                                                }
                                                else {
                                                  mesloadBox.warningShow();
                                                }
                                              }
                                            })
                                          }

                                          addTableData(queryWorkOrderParticularsUrl, {
                                            workOrderId:workOrderId
                                          });
                                          addTableData2(queryWorkstageParticularsUrl, {
                                            //workstageIds:["283b7b8fd83040d789b0dec1b88d79e5"]
                                            workstageIds:workstageId
                                          });
                                        }else{//修改
                                          let dataContent = $('#workOrderDetailModal'),
                                          panelList = dataContent.find('.panel'),
                                          panel_1=panelList.eq(0),
                                          panel_2=panelList.eq(1),
                                          panel_3=panelList.eq(2),
                                          panel_4=panelList.eq(3),
                                          panel_5=panelList.eq(4),
                                          modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                          modalSubmitBtn = dataContent.find('.modal-submit')


                                          panel_1.find('.panel-heading').find('.panel-title').text("基本详情") // 更换panel标题
                                          panel_2.find('.panel-heading').find('.panel-title').text("工步") // 更换panel标题
                                          panel_3.find('.panel-heading').find('.panel-title').text("环境参数") // 更换panel标题
                                          panel_4.find('.panel-heading').find('.panel-title').text("半成品参数") // 更换panel标题
                                          panel_5.find('.panel-heading').find('.panel-title').text("其他") // 更换panel标题

                                          dataContent.modal({
                                            backdrop: false, // 黑色遮罩不可点击
                                            keyboard: false,  // esc按键不可弃用模态框
                                            show: false
                                          })
                                          dataContent.modal('show') // 运行时显示
                                          modalSubmitBtn.hide()

                                          // dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                          //   $('body').addClass('modal-open')
                                          // })

                                          modalCloseBtn.off('click').on('click', (event) => {
                                            // 点击弃用按钮隐藏该模态框
                                            dataContent.modal('hide')
                                            panel_2.find("tbody").empty()
                                            panel_3.find("tbody").empty()
                                            panel_4.find("tbody").empty()
                                            panel_5.find("tbody").empty()
                                          })
                                          // 添加主体表单数据
                                          function addTableData(url, data) {
                                            $.ajax({
                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                              url: url,
                                              data: data,
                                              beforeSend: function (xml) {
                                                // ajax发送前
                                                mesloadBox.loadingShow()
                                              },
                                              success: function (result, status, xhr) {
                                                // ajax成功
                                                mesloadBox.hide()
                                                if (result.status === 0) {
                                                  //panel1 基础消息
                                                  mesHorizontalTableAddData(panel_1.find('table'), null, {
                                                    thead: '工单号/所属生产批号/产品型号/工艺/工艺版本/工序/工序优率/工序负责人/极性/半成品类型/半成品型号/预计产出量/半成品单位/生产线/生产车间/生产优先级/工单创建人/工单负责人/工单创建时间/预定开始日期/预定完成时间/实际产出量/实际开始时间/实际完成日期/班次',
                                                    tableWitch: '15%/15%/15%',
                                                    viewColGroup: 3,
                                                    importStaticData: (tbodyTd, length) => {
                                                      let map = result.map, // 映射
                                                      dataList = map.workOrder, // 主要数据列表
                                                      selectHtml = `<select class="form-control table-input input-sm"></select>`,
                                                      tempData = null; // 表格td内的临时数据

                                                      for (let i = 0, len = length; i < len; i++) {
                                                        switch (i) {
                                                          case 0: {
                                                            tempData = dataList.work_order_number
                                                            tbodyTd.eq(i).html(tempData);
                                                          }
                                                            break;
                                                          case 1: {
                                                            tempData = dataList.plan.production_plan_batch_number;
                                                            tbodyTd.eq(i).html(tempData);
                                                          }
                                                            break;
                                                          case 2: {
                                                            tempData =  dataList.plan.product_model_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 3: {
                                                            tempData = dataList.plan.craft_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 4: {
                                                            tempData = dataList.plan.craft_versions
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 5: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 6: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_quality_rate
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 7: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_responsible
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 8: {
                                                            tempData =dataList.planQuotesWorkstage.workstage_polarity
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 9: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_type_name
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 10: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_genre
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 11: {
                                                            tempData = dataList.work_order_expected_output
                                                            tbodyTd.eq(i).html(tempData)

                                                          }
                                                          break;
                                                          case 12: {
                                                            tempData = dataList.planQuotesWorkstage.semi_finish_unit
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 13: {
                                                            tempData = dataList.plan.product_line_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 14: {
                                                            tempData = dataList.role_workshop_name
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 15: {
                                                            tempData = dataList.plan.production_plan_production_priority
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 16: {
                                                            tempData = dataList.work_order_creators
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 17: {
                                                            tempData = dataList.work_order_responsible
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 18: {
                                                            tempData = dataList.work_order_creation_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }
                                                          }
                                                          break;
                                                          case 19: {
                                                            tempData = dataList.work_order_scheduled_start_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }
                                                          }
                                                          break;
                                                          case 20: {
                                                            tempData = dataList.work_order_estimated_completion_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }
                                                          }
                                                          break;
                                                          case 21: {
                                                            tempData = dataList.work_order_actual_output
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          case 22: {
                                                            tempData = dataList.work_order_actual_start_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }
                                                          }
                                                          break;
                                                          case 23: {
                                                            tempData = dataList.work_order_actual_finish_time
                                                            if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                              tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                            }else{
                                                              tbodyTd.eq(i).html("/")
                                                            }
                                                          }
                                                          break;
                                                          case 24: {
                                                            tempData = dataList.work_order_classes
                                                            tbodyTd.eq(i).html(tempData)
                                                          }
                                                          break;
                                                          default:
                                                            break;
                                                        }
                                                      }

                                                    }
                                                  })
                                                }
                                                else {
                                                  mesloadBox.warningShow();
                                                }
                                              }
                                            })
                                          }
                                          function addTableData2(url, data) {
                                            $.ajax({
                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                              url: url,
                                              data: data,
                                              beforeSend: function (xml) {
                                                // ajax发送前
                                                mesloadBox.loadingShow()
                                              },
                                              success: function (result, status, xhr) {
                                                // ajax成功
                                                mesloadBox.hide()
                                                if (result.status === 0) {
                                                  let parmList = result.map.workstageList[0].useParametersList,
                                                  semiProParamersList=[],//半成品参数集合
                                                  EnvirParamersList=[],//环境参数集合
                                                  otherParamersList=[]//其他参数集合

                                                  // for(var i=0;i<parmList.length;i++){
                                                  //   if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                  //     EnvirParamersList.push(parmList[i])
                                                  //   }else if(parmList[i].standard_parameter_type_id === semiProParamersTypeId){
                                                  //     semiProParamersList.push(parmList[i])
                                                  //   }else{
                                                  //     otherParamersList.push(parmList[i])
                                                  //   }
                                                  // }
                                                  for(var i=0;i<parmList.length;i++){
                                                    if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                      EnvirParamersList.push(parmList[i])
                                                    }else{
                                                      semiProParamersList.push(parmList[i])
                                                    }
                                                  }
                                                  //panel2 工步
                                                  mesVerticalTableAddData(panel_2, {
                                                    thead: {
                                                      theadContent: '序号/工步名称/工步版本/工步编号/操作',
                                                      theadWidth: '6%/10%/10%/10%/35%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal3"><i class="fa fa-tasks fa-fw"></i>查看物料使用详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#stepParm"><i class="fa fa-tasks fa-fw"></i>查看工步参数</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#devicesRecord"><i class="fa fa-tasks fa-fw"></i>查看设备操作记录</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let map = result.map, // 映射zszs
                                                        dataList = map.workstageList[0].stageAndStepRelationList, // 主要数据列表
                                                          tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_name;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_version;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstep.craft_control_workstep_num;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 4:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  stepId = dataList[currentTr.index()].workstep.craft_control_workstep_id;
                                                                  let  stepId2 = [];
                                                                  stepId2.push(stepId)
                                                                  switch (dataContent) {
                                                                    case '#detailModal3': {	//物料详情
                                                                      let dataContent = $('#detailModal3'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        panel_1 = panelList.eq(0),
                                                                        panel_2 = panelList.eq(1),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        statusTypeOption = panel_2.find('.status-type-option'), // 类型选项
                                                                        temp=`
                                                                        <option value="norm">请选择</option>
                                                                        <option value="materialName">按物料查看</option>
                                                                        <option value="materialUseTimeAsc">按时间升序</option>
                                                                        <option value="materialUseTimeDesc">按时间降序</option>
                                                                        `

                                                                        statusTypeOption.append(temp)


                                                                        panel_1.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题
                                                                        panel_2.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                          statusTypeOption.empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              // 详情1
                                                                              mesVerticalTableAddData(panel_1, {
                                                                                thead: {
                                                                                  theadContent: '序号/物料名称/规格/型号/单位/操作',
                                                                                  theadWidth: '4%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                    dataList = map.workstepList[0].useMaterielList, // 主要数据列表

                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;

                                                                                          case 5:
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              stepMaterialId = dataList[currentTr.index()].craft_materiel_id;
                                                                                              switch (dataContent) {
                                                                                                case '#detailModal': {	//详情
                                                                                                  let dataContent = $('#detailModal2'),
                                                                                                    panelList = dataContent.find('.panel'),
                                                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                    panelThead = panelList.find('thead'),
                                                                                                    panelTbody = panelList.find('tbody');
                                                                                                    panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                                                    dataContent.modal({
                                                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                                                      show: false
                                                                                                    })
                                                                                                    dataContent.modal('show') // 运行时显示
                                                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                      $('body').addClass('modal-open')
                                                                                                    })

                                                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                                                      // 点击弃用按钮隐藏该模态框
                                                                                                      dataContent.modal('hide')
                                                                                                      // 初始化表格
                                                                                                      panelList.find('thead').empty()
                                                                                                      panelList.find('tbody').empty()
                                                                                                    })

                                                                                                  // 主表格添加内容
                                                                                                  function addTableData(url, data) {
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url: url,
                                                                                                      data: data,
                                                                                                      beforeSend: function (xml) {
                                                                                                        // ajax发送前
                                                                                                        mesloadBox.loadingShow()
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        // ajax成功
                                                                                                        mesloadBox.hide()
                                                                                                        if (result.status === 0) {
                                                                                                          //panel1
                                                                                                          mesVerticalTableAddData(panelList, {
                                                                                                            thead: {
                                                                                                              theadContent: '序号/投料时间/使用数量/投料人/物料编号/备注/操作',
                                                                                                              theadWidth: '6%/20%/13%/15%/15%/15%/15%'
                                                                                                            },
                                                                                                            tbody: {
                                                                                                              html: [
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td></td>',
                                                                                                                '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'
                                                                                                              ],

                                                                                                              // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                                              dataAddress: function (tbodyTarget, html, result) {
                                                                                                                tbodyTarget.empty() // 清空表格主体
                                                                                                                let map = result.map, // 映射zszs
                                                                                                                  dataList = map.materialUseRecords, // 主要数据列表
                                                                                                                  tempData = null; // 表格td内的临时数据
                                                                                                                for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                                                  tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                                                  let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                                                  for (let i = 0, len = html.length; i < len; i++) {
                                                                                                                    currentTr.append(html[i]); // 添加表格内的HTML
                                                                                                                    switch (i) {
                                                                                                                      case 0:
                                                                                                                        currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                                                        break;
                                                                                                                      case 1: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_time;
                                                                                                                        currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                        // let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                                                        // currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                        // currentTr.children().eq(i).html(inputHtml)

                                                                                                                        // currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 2: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_amount;
                                                                                                                        let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                        currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                        currentTr.children().eq(i).html(inputHtml)

                                                                                                                        currentTr.children().eq(i).find('input').val(tempData)



                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 3: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_user;
                                                                                                                        currentTr.children().eq(i).html(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 4: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_number;
                                                                                                                        let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                        currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                        currentTr.children().eq(i).html(inputHtml)

                                                                                                                        currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 5: {
                                                                                                                        tempData = dataList[currentTr.index()].step_use_material_describe;
                                                                                                                        let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                        currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                        currentTr.children().eq(i).html(inputHtml)

                                                                                                                        currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                      }
                                                                                                                        break;
                                                                                                                      case 6: {
                                                                                                                        currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                                          let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                                                          materialUseRecordIds = dataList[currentTr.index()].material_use_record_id,
                                                                                                                          materielID = dataList[currentTr.index()].craft_materiel_id;
                                                                                                                          mainMaterielID = dataList[currentTr.index()].craft_materiel_main_id;
                                                                                                                          materielUnit= dataList[currentTr.index()].craft_materiel_unit;
                                                                                                                          materielName= dataList[currentTr.index()].craft_materiel_name;
                                                                                                                          materielSpecifications= dataList[currentTr.index()].craft_materiel_specifications;
                                                                                                                          materielModel= dataList[currentTr.index()].craft_materiel_model;
                                                                                                                          materialUseRecordIdsList=[]
                                                                                                                          materialUseRecordIdsList.push(materialUseRecordIds)
                                                                                                                          switch (dataContent) {
                                                                                                                            case '#edit': {	//修改
                                                                                                                              req={
                                                                                                                                craft_materiel_id:"",//使用物料id /
                                                                                                                                craft_materiel_main_id:"",//工步物料使用列表id/
                                                                                                                                step_use_material_time:"",//使用时间//
                                                                                                                                step_use_material_amount:"",//使用数量//
                                                                                                                                step_use_material_user:"",//使用人
                                                                                                                                step_use_material_user_id:"",//使用人id
                                                                                                                                step_use_material_describe:"",//备注
                                                                                                                                craft_materiel_unit:"",//
                                                                                                                                craft_materiel_name:"",//
                                                                                                                                craft_materiel_specifications:"",//
                                                                                                                                craft_materiel_model:"",//
                                                                                                                                step_use_material_number:"",//
                                                                                                                                work_order_id:"",//
                                                                                                                                material_use_record_id:"",//
                                                                                                                              }
                                                                                                                              req.craft_materiel_id=materielID
                                                                                                                              req.craft_materiel_main_id=mainMaterielID
                                                                                                                              req.craft_materiel_unit=materielUnit
                                                                                                                              req.craft_materiel_name=materielName
                                                                                                                              req.craft_materiel_specifications=materielSpecifications
                                                                                                                              req.craft_materiel_model=materielModel
                                                                                                                              req.work_order_id=workOrderId
                                                                                                                              req.material_use_record_id=materialUseRecordIds
                                                                                                                              let thisTr =currentTr.find("td")
                                                                                                                              req.step_use_material_time = thisTr.eq(1).find("input").val()
                                                                                                                              req.step_use_material_amount = thisTr.eq(2).find("input").val()
                                                                                                                              req.step_use_material_number = thisTr.eq(4).find("input").val()
                                                                                                                              req.step_use_material_describe = thisTr.eq(5).find("input").val()
                                                                                                                              req.step_use_material_user = thisTr.eq(3).text()

                                                                                                                              let req2 = [] ,req3
                                                                                                                              req2.push(req)
                                                                                                                              req3 = JSON.stringify(req2)
                                                                                                                              swal({
                                                                                                                                title: '您确定要修改吗？',
                                                                                                                                type: 'question',
                                                                                                                                showCancelButton: true,
                                                                                                                                confirmButtonText: '确定',
                                                                                                                                cancelButtonText: '取消'
                                                                                                                              }).then(function (){
                                                                                                                                $.ajax({
                                                                                                                                   type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                                                  url:saveWorkOrderMaterialUseRecordUrl,
                                                                                                                                  data: {
                                                                                                                                    type:"modify",
                                                                                                                                    materialUseRecords:req3,
                                                                                                                                  },
                                                                                                                                  success: function (result, status, xhr) {
                                                                                                                                    if (result.status === 0) {
                                                                                                                                      let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                                                      swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                                                    }else {
                                                                                                                                      swal({
                                                                                                                                        title: '删除失败',
                                                                                                                                        type: 'warning',
                                                                                                                                        timer: '1000',
                                                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                                                        showCancelButton: false, // 显示用户取消按钮
                                                                                                                                        showConfirmButton: false, // 显示用户确认按钮
                                                                                                                                    })
                                                                                                                                    }
                                                                                                                                  },
                                                                                                                                })
                                                                                                                              })
                                                                                                                              break;
                                                                                                                            }
                                                                                                                            case '#delete' :{
                                                                                                                              swal({
                                                                                                                                title: '您确定要删除吗？',
                                                                                                                                type: 'question',
                                                                                                                                showCancelButton: true,
                                                                                                                                confirmButtonText: '确定',
                                                                                                                                cancelButtonText: '取消'
                                                                                                                              }).then(function (){
                                                                                                                                $.ajax({
                                                                                                                                   type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                                                  url:removeWorkOrderMaterialUseRecordUrl,
                                                                                                                                  data: {
                                                                                                                                    materialUseRecordIds:materialUseRecordIdsList,
                                                                                                                                  },
                                                                                                                                  success: function (result, status, xhr) {
                                                                                                                                    if (result.status === 0) {
                                                                                                                                      let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                                                      swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                                                    }else {
                                                                                                                                      swal({
                                                                                                                                        title: '删除失败',
                                                                                                                                        type: 'warning',
                                                                                                                                        timer: '1000',
                                                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                                                        showCancelButton: false, // 显示用户取消按钮
                                                                                                                                        showConfirmButton: false, // 显示用户确认按钮
                                                                                                                                    })
                                                                                                                                    }
                                                                                                                                  },
                                                                                                                                })
                                                                                                                              })
                                                                                                                              break;
                                                                                                                            }
                                                                                                                          }
                                                                                                                        })
                                                                                                                      }
                                                                                                                        break;


                                                                                                                      default:
                                                                                                                        break;
                                                                                                                    }
                                                                                                                  }
                                                                                                                }
                                                                                                              }
                                                                                                            },

                                                                                                            pagination: {
                                                                                                              totalRow: result.map.line, // 总行数
                                                                                                              displayRow: result.map.materialUseRecords.length // 显示行数
                                                                                                            },

                                                                                                            ajax: {
                                                                                                              url: url,
                                                                                                              data: data
                                                                                                            }
                                                                                                          })


                                                                                                        }
                                                                                                        else {
                                                                                                          mesloadBox.warningShow();
                                                                                                        }
                                                                                                      }
                                                                                                    })
                                                                                                  }

                                                                                                  // 导航栏点击时运行数据加载
                                                                                                  addTableData(queryWorkOrderMaterialUseRecordUrl, {
                                                                                                    type:"norm",
                                                                                                    workOrderId: workOrderId,
                                                                                                    stepMaterialId:stepMaterialId,
                                                                                                    headNum: 1
                                                                                                  });

                                                                                                  break;
                                                                                                }


                                                                                              }
                                                                                            })
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow:result.map.workstepList[0].useMaterielList.length, // 总行数
                                                                                displayRow: result.map.workstepList[0].useMaterielList.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })



                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }
                                                                      function addTableData2(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {

                                                                              mesVerticalTableAddData(panel_2, {
                                                                                thead: {
                                                                                  theadContent: '序号/物料名称/规格/型号/单位/投料时间/使用数量/投料人/物料编号/备注',
                                                                                  theadWidth: '6%/10%/9%/9%/9%/16%/9%/10%/10%/10%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.materialUseRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                            // tempData=
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_time;
                                                                                            currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_amount;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 7: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_user;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 8: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;

                                                                                          case 9: {
                                                                                            tempData = dataList[currentTr.index()].step_use_material_describe;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.materialUseRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      addTableData(queryStepParticularsUrl, {
                                                                        stepIds:stepId2,
                                                                      });

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData2(queryWorkOrderMaterialUseRecordUrl, {
                                                                        type:"materialName",
                                                                        workOrderId: workOrderId,
                                                                        stepId:stepId,
                                                                        headNum: 1
                                                                      });

                                                                      statusTypeOption.off("change").on("change",function(){
                                                                        let status = $(this).val();
                                                                        addTableData2(queryWorkOrderMaterialUseRecordUrl, {
                                                                          type:status,
                                                                          workOrderId: workOrderId,
                                                                          stepId:stepId,
                                                                          headNum: 1
                                                                        });
                                                                      })

                                                                      break;
                                                                    }
                                                                    case '#stepParm': {	//工步参数详情
                                                                      let dataContent = $('#detailModal3'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        panel_1 = panelList.eq(0),
                                                                        panel_2 = panelList.eq(1),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        statusTypeOption = panel_2.find('.status-type-option'), // 类型选项
                                                                        temp=`
                                                                        <option value="norm">请选择</option>
                                                                        <option value="stepParameteName">按参数名称</option>
                                                                        <option value="parameteRecordTimeAsc">按时间升序</option>
                                                                        <option value="parameteRecordTimeDesc">按时间降序</option>
                                                                        `

                                                                        statusTypeOption.append(temp)


                                                                        panel_1.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题
                                                                        panel_2.find('.panel-heading').find('.panel-title').text("投料详情") // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示

                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                          statusTypeOption.empty()
                                                                        })

                                                                        // 主表格添加内容
                                                                        function addTableData(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {
                                                                                //panel1
                                                                                mesVerticalTableAddData(panel_1, {
                                                                                  thead: {
                                                                                    theadContent: '序号/参数/值类型/参考值/单位/设备类型/操作',
                                                                                    theadWidth: '6%/15%/15%/15%/15%/15%/15%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                      dataList = map.workstepList[0].workstepParameterList, // 主要数据列表

                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                              if(tempData = "constantValue"){
                                                                                                currentTr.children().eq(i).html( "固定值")
                                                                                              }else if(tempData = "rangeValue"){
                                                                                                currentTr.children().eq(i).html("范围值")
                                                                                              }else if(tempData = "deviationValue"){
                                                                                                currentTr.children().eq(i).html("浮动值")
                                                                                              }
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                              let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                              let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                              let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                              let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                                if(tempData == "constantValue"){
                                                                                                  currentTr.children().eq(i).html(constantValue)
                                                                                                }else if(tempData == "rangeValue"){
                                                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                                }else if(tempData == "deviationValue"){
                                                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                                }
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              tempData = dataList[currentTr.index()].devices_control_devices_type_id;
                                                                                              let 	selectHtml = `<select class="form-control table-input input-sm"></select>`
                                                                                              currentTr.children().eq(i).addClass('table-input-td')
                                                                                              currentTr.children().eq(i).html(selectHtml)

                                                                                              let target =  currentTr.children().eq(i).find('select');
                                                                                              for (let i = 0, len = devicesTypeList.length; i < len; i++) {
                                                                                                let optionStr = `<option value="${devicesTypeList[i].devices_control_devices_type_id}">${devicesTypeList[i].devices_control_devices_type_name}</option>`;
                                                                                                target.append(optionStr);
                                                                                              }
                                                                                              target.val(tempData).attr('disabled',true)
                                                                                            }
                                                                                              break;
                                                                                            case 6:
                                                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                                stepParameteId = dataList[currentTr.index()].craft_workstep_parameter_id;
                                                                                                switch (dataContent) {
                                                                                                  case '#detailModal': {	//详情
                                                                                                    let dataContent = $('#detailModal2'),
                                                                                                      panelList = dataContent.find('.panel'),
                                                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                      panelThead = panelList.find('thead'),
                                                                                                      panelTbody = panelList.find('tbody');
                                                                                                      panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                                                      dataContent.modal({
                                                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                                                        show: false
                                                                                                      })
                                                                                                      dataContent.modal('show') // 运行时显示
                                                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                        $('body').addClass('modal-open')
                                                                                                      })

                                                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                                                        // 点击弃用按钮隐藏该模态框
                                                                                                        dataContent.modal('hide')
                                                                                                        // 初始化表格
                                                                                                        panelList.find('thead').empty()
                                                                                                        panelList.find('tbody').empty()
                                                                                                      })

                                                                                                    // 主表格添加内容
                                                                                                    function addTableData(url, data) {
                                                                                                      $.ajax({
                                                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                        url: url,
                                                                                                        data: data,
                                                                                                        beforeSend: function (xml) {
                                                                                                          // ajax发送前
                                                                                                          mesloadBox.loadingShow()
                                                                                                        },
                                                                                                        success: function (result, status, xhr) {
                                                                                                          // ajax成功
                                                                                                          mesloadBox.hide()
                                                                                                          if (result.status === 0) {
                                                                                                            //panel1
                                                                                                            mesVerticalTableAddData(panelList, {
                                                                                                              thead: {
                                                                                                                theadContent: '序号/参数值/记录人/记录时间/设备编号/备注/操作',
                                                                                                                theadWidth: '6%/15%/15%/18%/15%/15%/15%'
                                                                                                              },
                                                                                                              tbody: {
                                                                                                                html: [
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td></td>',
                                                                                                                  '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                                                ],

                                                                                                                // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                                                dataAddress: function (tbodyTarget, html, result) {
                                                                                                                  tbodyTarget.empty() // 清空表格主体
                                                                                                                  let map = result.map, // 映射zszs
                                                                                                                    dataList = map.stepParameteRecords, // 主要数据列表
                                                                                                                    tempData = null; // 表格td内的临时数据
                                                                                                                    console.log(dataList)
                                                                                                                  for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                                                    tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                                                    let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                                                    for (let i = 0, len = html.length; i < len; i++) {
                                                                                                                      currentTr.append(html[i]); // 添加表格内的HTML
                                                                                                                      switch (i) {
                                                                                                                        case 0:
                                                                                                                          currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                                                          break;
                                                                                                                        case 1: {
                                                                                                                          tempData = dataList[currentTr.index()].step_use_steady_state_value;
                                                                                                                          let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                          currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                          currentTr.children().eq(i).html(inputHtml)

                                                                                                                          currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 2: {
                                                                                                                          tempData = dataList[currentTr.index()].step_use_note_taker;
                                                                                                                        let  takerID = dataList[currentTr.index()].step_use_note_taker_id;
                                                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                                                          currentTr.children().eq(i).attr("takerID",takerID)
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 3: {
                                                                                                                          tempData = dataList[currentTr.index()].step_use_write_time;
                                                                                                                          // let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                                                          // currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                          currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))

                                                                                                                          // currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 4: {
                                                                                                                          tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                                                          let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                          currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                          currentTr.children().eq(i).html(inputHtml)

                                                                                                                          currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 5: {
                                                                                                                          tempData = dataList[currentTr.index()].step_use_describe;
                                                                                                                          let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                                                          currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                                                          currentTr.children().eq(i).html(inputHtml)

                                                                                                                          currentTr.children().eq(i).find('input').val(tempData)
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        case 6: {
                                                                                                                          currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                                            let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                                                            stepParameteRecords = dataList[currentTr.index()].step_parameter_record_id,
                                                                                                                            stepParameteId = dataList[currentTr.index()].craft_workstep_parameter_main_id,
                                                                                                                            unit = dataList[currentTr.index()].workstep_parameter_unit,
                                                                                                                            ParameteId = dataList[currentTr.index()].craft_control_workstep_id,
                                                                                                                            ParameteName = dataList[currentTr.index()].craft_workstep_parameter_name,
                                                                                                                            ParameteValueType = dataList[currentTr.index()].craft_workstep_parameter_value_type,
                                                                                                                            ParameteConstantValue = dataList[currentTr.index()].workstep_parameter_constant_value,
                                                                                                                            devicesTypeId= dataList[currentTr.index()].devices_control_devices_type_id,
                                                                                                                            valueType= dataList[currentTr.index()].craft_workstep_parameter_value_type,
                                                                                                                            stepParameteRecordsList=[]
                                                                                                                            stepParameteRecordsList.push(stepParameteRecords)
                                                                                                                            switch (dataContent) {
                                                                                                                              case '#edit': {	//
                                                                                                                                req={
                                                                                                                                  craft_workstep_parameter_main_id:"",//工步参数列表id
                                                                                                                                  step_use_steady_state_value:"",//恒定值
                                                                                                                                  step_use_note_taker:"",//记录人
                                                                                                                                  step_use_note_taker_id:"",//记录人id
                                                                                                                                  step_use_write_time:"",//记录时间
                                                                                                                                  devices_control_devices_number:"",//设备编号
                                                                                                                                  step_use_describe:"",//备注
                                                                                                                                  workstep_parameter_unit:"",//
                                                                                                                                  craft_workstep_parameter_id:"",//备注
                                                                                                                                  craft_workstep_parameter_name:"",//备注
                                                                                                                                  work_order_id:"",//备注
                                                                                                                                  step_use_parameter_value_type:"",//值类型
                                                                                                                                  devices_control_devices_type_id:"",
                                                                                                                                  step_parameter_record_id:""
                                                                                                                                }
                                                                                                                                req.craft_workstep_parameter_main_id = stepParameteId
                                                                                                                                req.workstep_parameter_unit = unit
                                                                                                                                req.craft_workstep_parameter_id = ParameteId
                                                                                                                                req.craft_workstep_parameter_name = ParameteName
                                                                                                                                req.devices_control_devices_type_id = devicesTypeId
                                                                                                                                req.work_order_id = workOrderId
                                                                                                                                req.step_use_parameter_value_type = valueType
                                                                                                                                req.step_parameter_record_id = stepParameteRecords

                                                                                                                                let thisTr =currentTr.find("td")
                                                                                                                                req.step_use_steady_state_value = thisTr.eq(1).find("input").val()
                                                                                                                                req.step_use_note_taker = thisTr.eq(2).text()
                                                                                                                                req.step_use_note_taker_id = thisTr.eq(2).attr("takerID")
                                                                                                                                req.step_use_write_time = thisTr.eq(3).find("input").val()
                                                                                                                                req.devices_control_devices_number= thisTr.eq(4).find("input").val()
                                                                                                                                req.step_use_describe= thisTr.eq(5).find("input").val()

                                                                                                                                let req2=[],req3
                                                                                                                                req2.push(req)
                                                                                                                                req3 = JSON.stringify(req2)

                                                                                                                                swal({
                                                                                                                                  title: '您确定要修改吗？',
                                                                                                                                  type: 'question',
                                                                                                                                  showCancelButton: true,
                                                                                                                                  confirmButtonText: '确定',
                                                                                                                                  cancelButtonText: '取消'
                                                                                                                                }).then(function (){
                                                                                                                                  $.ajax({
                                                                                                                                     type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                                                    url:saveWorkOrderStepParameteRecordUrl,
                                                                                                                                    data: {
                                                                                                                                      type:"modify",
                                                                                                                                      stepParameteRecords:req3,
                                                                                                                                    },
                                                                                                                                    success: function (result, status, xhr) {
                                                                                                                                      if (result.status === 0) {
                                                                                                                                        let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                                                        swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                                                      }else {
                                                                                                                                        swal({
                                                                                                                                          title: '操作失败',
                                                                                                                                          type: 'warning',
                                                                                                                                          timer: '1000',
                                                                                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                                                          showCancelButton: false, // 显示用户取消按钮
                                                                                                                                          showConfirmButton: false, // 显示用户确认按钮
                                                                                                                                      })
                                                                                                                                      }
                                                                                                                                    },
                                                                                                                                  })
                                                                                                                                })
                                                                                                                                break;
                                                                                                                              }
                                                                                                                              case '#delete' :{
                                                                                                                                swal({
                                                                                                                                  title: '您确定要删除吗？',
                                                                                                                                  type: 'question',
                                                                                                                                  showCancelButton: true,
                                                                                                                                  confirmButtonText: '确定',
                                                                                                                                  cancelButtonText: '取消'
                                                                                                                                }).then(function (){
                                                                                                                                  $.ajax({
                                                                                                                                     type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                                                    url:removeWorkOrderStepParameteRecordUrl,
                                                                                                                                    data: {
                                                                                                                                      stepParameteRecordIds:stepParameteRecordsList,
                                                                                                                                    },
                                                                                                                                    success: function (result, status, xhr) {
                                                                                                                                      if (result.status === 0) {
                                                                                                                                        let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                                                        swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                                                      }else {
                                                                                                                                        swal({
                                                                                                                                          title: '删除失败',
                                                                                                                                          type: 'warning',
                                                                                                                                          timer: '1000',
                                                                                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                                                          showCancelButton: false, // 显示用户取消按钮
                                                                                                                                          showConfirmButton: false, // 显示用户确认按钮
                                                                                                                                      })
                                                                                                                                      }
                                                                                                                                    },
                                                                                                                                  })
                                                                                                                                })
                                                                                                                                break;
                                                                                                                              }
                                                                                                                            }
                                                                                                                          })
                                                                                                                        }
                                                                                                                          break;
                                                                                                                        default:
                                                                                                                          break;
                                                                                                                      }
                                                                                                                    }
                                                                                                                  }
                                                                                                                }
                                                                                                              },

                                                                                                              pagination: {
                                                                                                                totalRow: result.map.line, // 总行数
                                                                                                                displayRow: result.map.stepParameteRecords.length // 显示行数
                                                                                                              },

                                                                                                              ajax: {
                                                                                                                url: url,
                                                                                                                data: data
                                                                                                              }
                                                                                                            })
                                                                                                          }
                                                                                                          else {
                                                                                                            mesloadBox.warningShow();
                                                                                                          }
                                                                                                        }
                                                                                                      })
                                                                                                    }

                                                                                                    // 导航栏点击时运行数据加载
                                                                                                    addTableData(queryWorkOrderStepParameteRecordUrl, {
                                                                                                      type:"norm",
                                                                                                      workOrderId: workOrderId,
                                                                                                      stepParameteId:stepParameteId,
                                                                                                      headNum: 1
                                                                                                    });

                                                                                                    break;
                                                                                                  }


                                                                                                }
                                                                                              })
                                                                                              break;
                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.workstepList[0].workstepParameterList.length, // 总行数
                                                                                    displayRow: result.map.workstepList[0].workstepParameterList.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })



                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }
                                                                        function addTableData2(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {

                                                                                mesVerticalTableAddData(panel_2, {
                                                                                  thead: {
                                                                                    theadContent: '序号/参数名称/参数类型/参考值/实际值/单位/设备类型/设备编号/记录人/时间/备注',
                                                                                    theadWidth: '6%/10%/8%/8%/8%/8%/8%/8%/8%/8%/8%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                        dataList = map.stepParameteRecords, // 主要数据列表
                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                              // tempData=
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                              if(tempData = "constantValue"){
                                                                                                currentTr.children().eq(i).html( "固定值")
                                                                                              }else if(tempData = "rangeValue"){
                                                                                                currentTr.children().eq(i).html("范围值")
                                                                                              }else if(tempData = "deviationValue"){
                                                                                                currentTr.children().eq(i).html("浮动值")
                                                                                              }
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                              let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                              let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                              let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                              let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                                if(tempData == "constantValue"){
                                                                                                  currentTr.children().eq(i).html(constantValue)
                                                                                                }else if(tempData == "rangeValue"){
                                                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                                }else if(tempData == "deviationValue"){
                                                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                                }
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].step_use_steady_state_value;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 6: {
                                                                                              tempData = dataList[currentTr.index()].devices_control_devices_type_name;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 7: {
                                                                                              tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 8: {
                                                                                              tempData = dataList[currentTr.index()].step_use_note_taker;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 9: {
                                                                                              tempData = dataList[currentTr.index()].step_use_write_time;
                                                                                              currentTr.children().eq(i).html(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                            }
                                                                                              break;
                                                                                            case 10: {
                                                                                              tempData = dataList[currentTr.index()].step_use_describe;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;



                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.line, // 总行数
                                                                                    displayRow: result.map.stepParameteRecords.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })


                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }

                                                                      addTableData(queryStepParticularsUrl, {
                                                                        stepIds:stepId2,
                                                                      });

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData2(queryWorkOrderStepParameteRecordUrl, {
                                                                        type:"stepParameteName",
                                                                        workOrderId: workOrderId,
                                                                        stepId:stepId,
                                                                        headNum: 1
                                                                      });
                                                                      statusTypeOption.off("change").on("change",function(){
                                                                        let status = $(this).val();
                                                                        addTableData2(queryWorkOrderStepParameteRecordUrl, {
                                                                          type:status,
                                                                          workOrderId: workOrderId,
                                                                          stepId:stepId,
                                                                          headNum: 1
                                                                        });
                                                                      })

                                                                      break;
                                                                    }
                                                                    case '#devicesRecord': {	//设备操作记录
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/设备名称/设备编号/开始时间/结束时间/操作状态/操作人/操作',
                                                                                  theadWidth: '6%/12%/12%/15%/15%/15%/10%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.devicesOperationRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                      console.log(dataList)
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_name;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].devices_control_devices_number;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_start_time;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)
                                                                                            currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_end_time;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_operator_type;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 6: {
                                                                                            tempData = dataList[currentTr.index()].devices_operation_operator;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 7: {
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              devicesOperationRecordIds = dataList[currentTr.index()].devices_operation_record_id,
                                                                                              deviceId = dataList[currentTr.index()].devices_control_devices_id,
                                                                                              recordId = dataList[currentTr.index()].devices_operation_record_id,
                                                                                              operatorId = dataList[currentTr.index()].devices_operation_operator_id,
                                                                                              operatorType = dataList[currentTr.index()].devices_operation_operator_type,
                                                                                              devicesOperationRecordIdsList=[]
                                                                                              devicesOperationRecordIdsList.push(devicesOperationRecordIds)
                                                                                              switch (dataContent) {
                                                                                                case '#edit': {	//修改
                                                                                                 let req={
                                                                                                    work_order_id:"",
                                                                                                    craft_control_workstep_id:"",
                                                                                                    devices_control_devices_id:"",//设备id
                                                                                                    devices_control_devices_name:"",//设备名称
                                                                                                    devices_control_devices_number:"",//设备编号
                                                                                                    devices_operation_start_time:"",//开始时间
                                                                                                    devices_operation_end_time:"",//结束时间
                                                                                                    devices_operation_operator:"",//操作人
                                                                                                    devices_operation_operator_id:"",//操作人id
                                                                                                    devices_operation_operator_type:"",//操作类型
                                                                                                    devices_operation_record_id:""//操作类型
                                                                                                  }
                                                                                                  req.craft_control_workstep_id = stepId
                                                                                                  req.work_order_id = workOrderId
                                                                                                  req.devices_operation_record_id = recordId
                                                                                                  req.devices_operation_operator_type = operatorType
                                                                                                  let thisTr =currentTr.find("td")
                                                                                                    req.devices_control_devices_name = thisTr.eq(1).html()
                                                                                                    req.devices_control_devices_id = deviceId
                                                                                                    req.devices_operation_operator_id = operatorId
                                                                                                    req.devices_control_devices_number = thisTr.eq(2).text()
                                                                                                    req.devices_operation_start_time = thisTr.eq(3).find("input").val()
                                                                                                    req.devices_operation_end_time = thisTr.eq(4).find("input").val()
                                                                                                    req.devices_operation_operator = thisTr.eq(6).text()
                                                                                                  let req3=[] ,req4
                                                                                                  req3.push(req)
                                                                                                  req4 = JSON.stringify(req3)
                                                                                                    swal({
                                                                                                      title: '您确定要修改吗？',
                                                                                                      type: 'question',
                                                                                                      showCancelButton: true,
                                                                                                      confirmButtonText: '确定',
                                                                                                      cancelButtonText: '取消'
                                                                                                    }).then(function (){
                                                                                                      $.ajax({
                                                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                        url:saveWorkOrderDevicesOperationRecordUrl,
                                                                                                        data: {
                                                                                                          type:"modify",
                                                                                                          devicesOperationRecords:req4,
                                                                                                        },
                                                                                                        success: function (result, status, xhr) {
                                                                                                          if (result.status === 0) {
                                                                                                            let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                            swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                          }else {
                                                                                                            swal({
                                                                                                              title: '修改失败',
                                                                                                              type: 'warning',
                                                                                                              timer: '1000',
                                                                                                              allowEscapeKey: false, // 用户按esc键不退出
                                                                                                              allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                              showCancelButton: false, // 显示用户取消按钮
                                                                                                              showConfirmButton: false, // 显示用户确认按钮
                                                                                                          })
                                                                                                          }
                                                                                                        },
                                                                                                      })
                                                                                                    })
                                                                                                    break;
                                                                                                }
                                                                                                case '#delete' :{
                                                                                                  swal({
                                                                                                    title: '您确定要删除吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:removeWorkOrderDevicesOperationRecordUrl,
                                                                                                      data: {
                                                                                                        devicesOperationRecordIds:devicesOperationRecordIdsList,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
																																					                              	swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                              }
                                                                                            })
                                                                                          }
                                                                                            break;
                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.devicesOperationRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })
                                                                            }
                                                                            else {
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderDevicesOperationRecordUrl, {
                                                                        stepId: stepId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: result.map.workstageList[0].stageAndStepRelationList.length, // 总行数
                                                      displayRow: result.map.workstageList[0].stageAndStepRelationList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })

                                                  //panel3 环境参数
                                                  mesVerticalTableAddData(panel_3, {
                                                    thead: {
                                                      theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                      theadWidth: '4%/15%/15%/15%/15%/15%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let dataList =  EnvirParamersList,//环境参数集合,
                                                          tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                // tempData=
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                if(tempData = "constantValue"){
                                                                  currentTr.children().eq(i).html( "固定值")
                                                                }else if(tempData = "rangeValue"){
                                                                  currentTr.children().eq(i).html("范围值")
                                                                }else if(tempData = "deviationValue"){
                                                                  currentTr.children().eq(i).html("浮动值")
                                                                }
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                if(tempData == "constantValue"){
                                                                  currentTr.children().eq(i).html(constantValue)
                                                                }else if(tempData == "rangeValue"){
                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                }else if(tempData == "deviationValue"){
                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                }
                                                              }
                                                                break;
                                                              case 4: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  workstageId = dataList[currentTr.index()].workstage_id,
                                                                  parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                  ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type
                                                                  switch (dataContent) {
                                                                    case '#detailModal': {	//详情
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/实际值/记录人/记录时间/备注/操作',
                                                                                  theadWidth: '6%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.parameteRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                            let takerId = dataList[currentTr.index()].parameter_record_note_taker_id;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                            currentTr.children().eq(i).attr("takerId",takerId)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              parameteRecordIds = dataList[currentTr.index()].parameter_record_id,
                                                                                              parameteRecordIdsList=[]
                                                                                              parameteRecordIdsList.push(parameteRecordIds)
                                                                                              switch (dataContent) {
                                                                                                case '#edit': {	//
                                                                                                  req={
                                                                                                    craft_workstep_parameter_main_id:"",//参数id//
                                                                                                    craft_workstep_parameter_id:"",//参数id
                                                                                                    standard_parameter_type_id:"",//参数lx id//
                                                                                                    workstage_id:"",//工序id//
                                                                                                    work_order_id:"",//工序id//
                                                                                                    parameter_record_steady_state_value:"",//参数记录值
                                                                                                    parameter_record_write_time:"",//记录时间
                                                                                                    parameter_record_note_taker:"",//记录人
                                                                                                    parameter_record_note_taker_id:"",//记录id
                                                                                                    parameter_record_describe:"",//描述
                                                                                                    parameter_record_value_type:"",////
                                                                                                    parameter_record_id:""
                                                                                                  }
                                                                                                  req.craft_workstep_parameter_main_id = parameteRecordId
                                                                                                  req.workstage_id = workstageId
                                                                                                  req.standard_parameter_type_id = parametertypeId
                                                                                                  req.work_order_id = workOrderId
                                                                                                  req.parameter_record_value_type = ParameteValueType
                                                                                                  req.parameter_record_id = parameteRecordIds

                                                                                                  let thisTr =currentTr.find("td")
                                                                                                  req.parameter_record_steady_state_value = thisTr.eq(1).find("input").val()
                                                                                                  req.parameter_record_note_taker = thisTr.eq(2).text()
                                                                                                  req.parameter_record_note_taker_id = thisTr.eq(2).attr("takerId")
                                                                                                  req.parameter_record_write_time = thisTr.eq(3).find("input").val()
                                                                                                  req.parameter_record_describe = thisTr.eq(4).find("input").val()

                                                                                                  let req2=[], req3
                                                                                                  req2.push(req)
                                                                                                  req3 = JSON.stringify(req2)

                                                                                                  swal({
                                                                                                    title: '您确定要修改吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:saveWorkOrderParameteRecordUrl,
                                                                                                      data: {
                                                                                                        type:"modify",
                                                                                                        parameteRecords:req3,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                          swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                                case '#delete' :{
                                                                                                  swal({
                                                                                                    title: '您确定要删除吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:removeWorkOrderParameteRecordUrl,
                                                                                                      data: {
                                                                                                        parameteRecordIds:parameteRecordIdsList,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                          swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                              }
                                                                                            })

                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.parameteRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              panelTbody.empty().append(NO_DATA_NOTICE)

                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderParameteRecordUrl, {
                                                                        parameteId:parameteId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: EnvirParamersList.length , // 总行数
                                                      displayRow:EnvirParamersList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })
                                                    //panel3  半成品参数

                                                  if(semiProParamersList.length!==0){
                                                    mesVerticalTableAddData(panel_4, {
                                                      thead: {
                                                        theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                        theadWidth: '4%/15%/15%/15%/15%/15%'
                                                      },
                                                      tbody: {
                                                        html: [
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                        ],

                                                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                        dataAddress: function (tbodyTarget, html, result) {
                                                          tbodyTarget.empty() // 清空表格主体
                                                          let  dataList = semiProParamersList, // 主要数据列表
                                                              tempData = null; // 表格td内的临时数据
                                                          for (let i = 0, len = dataList.length; i < len; i++) {
                                                            tbodyTarget.append('<tr></tr>'); // 添加行
                                                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                            for (let i = 0, len = html.length; i < len; i++) {
                                                              currentTr.append(html[i]); // 添加表格内的HTML
                                                              switch (i) {
                                                                case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                                case 1: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                  // tempData=
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;
                                                                case 2: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  if(tempData = "constantValue"){
                                                                    currentTr.children().eq(i).html( "固定值")
                                                                  }else if(tempData = "rangeValue"){
                                                                    currentTr.children().eq(i).html("范围值")
                                                                  }else if(tempData = "deviationValue"){
                                                                    currentTr.children().eq(i).html("浮动值")
                                                                  }
                                                                }
                                                                  break;
                                                                case 3: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                  let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                  let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                  let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                                }
                                                                  break;
                                                                case 4: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;

                                                                case 5:
                                                                  currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                    parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                    parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                    workstageId = dataList[currentTr.index()].workstage_id,
                                                                    parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                    ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type
                                                                    switch (dataContent) {
                                                                      case '#detailModal': {	//详情
                                                                        let dataContent = $('#detailModal2'),
                                                                          panelList = dataContent.find('.panel'),
                                                                          modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                          panelThead = panelList.find('thead'),
                                                                          panelTbody = panelList.find('tbody');
                                                                          panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                          dataContent.modal({
                                                                            backdrop: false, // 黑色遮罩不可点击
                                                                            keyboard: false,  // esc按键不可弃用模态框
                                                                            show: false
                                                                          })
                                                                          dataContent.modal('show') // 运行时显示
                                                                          dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                            $('body').addClass('modal-open')
                                                                          })

                                                                          modalCloseBtn.off('click').on('click', (event) => {
                                                                            // 点击弃用按钮隐藏该模态框
                                                                            dataContent.modal('hide')
                                                                            // 初始化表格
                                                                            panelList.find('thead').empty()
                                                                            panelList.find('tbody').empty()
                                                                          })

                                                                        // 主表格添加内容
                                                                        function addTableData(url, data) {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: url,
                                                                            data: data,
                                                                            beforeSend: function (xml) {
                                                                              // ajax发送前
                                                                              mesloadBox.loadingShow()
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              // ajax成功
                                                                              mesloadBox.hide()
                                                                              if (result.status === 0) {
                                                                                //panel1
                                                                                mesVerticalTableAddData(panelList, {
                                                                                  thead: {
                                                                                    theadContent: '序号/实际值/记录人/记录时间/备注/操作',
                                                                                    theadWidth: '6%/15%/15%/15%/15%/15%'
                                                                                  },
                                                                                  tbody: {
                                                                                    html: [
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td></td>',
                                                                                      '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                    ],

                                                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                    dataAddress: function (tbodyTarget, html, result) {
                                                                                      tbodyTarget.empty() // 清空表格主体
                                                                                      let map = result.map, // 映射zszs
                                                                                        dataList = map.parameteRecords, // 主要数据列表
                                                                                        tempData = null; // 表格td内的临时数据
                                                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                                                          switch (i) {
                                                                                            case 0:
                                                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                              break;
                                                                                            case 1: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_steady_state_value;

                                                                                              let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                              currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                              currentTr.children().eq(i).html(inputHtml)

                                                                                              currentTr.children().eq(i).find('input').val(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 2: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                              currentTr.children().eq(i).html(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 3: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                              let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                              currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                              currentTr.children().eq(i).html(inputHtml)

                                                                                              currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                            }
                                                                                              break;
                                                                                            case 4: {
                                                                                              tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                              let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                              currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                              currentTr.children().eq(i).html(inputHtml)

                                                                                              currentTr.children().eq(i).find('input').val(tempData)
                                                                                            }
                                                                                              break;
                                                                                            case 5: {
                                                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                                let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                                parameteRecordIds = dataList[currentTr.index()].parameter_record_id,
                                                                                                parameteRecordIdsList=[]
                                                                                                parameteRecordIdsList.push(parameteRecordIds)
                                                                                                switch (dataContent) {
                                                                                                  case '#edit': {	//
                                                                                                    req={
                                                                                                      craft_workstep_parameter_main_id:"",//参数id//
                                                                                                      craft_workstep_parameter_id:"",//参数id
                                                                                                      standard_parameter_type_id:"",//参数lx id//
                                                                                                      workstage_id:"",//工序id//
                                                                                                      work_order_id:"",//工序id//
                                                                                                      parameter_record_steady_state_value:"",//参数记录值
                                                                                                      parameter_record_write_time:"",//记录时间
                                                                                                      parameter_record_note_taker:"",//记录人
                                                                                                      parameter_record_note_taker_id:"",//记录id
                                                                                                      parameter_record_describe:"",//描述
                                                                                                      parameter_record_value_type:"",////
                                                                                                      parameter_record_id:""
                                                                                                    }
                                                                                                    req.craft_workstep_parameter_main_id = parameteRecordId
                                                                                                    req.workstage_id = workstageId
                                                                                                    req.standard_parameter_type_id = parametertypeId
                                                                                                    req.work_order_id = workOrderId
                                                                                                    req.parameter_record_value_type = ParameteValueType
                                                                                                    req.parameter_record_id = parameteRecordIds

                                                                                                    let thisTr =currentTr.find("td")
                                                                                                    req.parameter_record_steady_state_value = thisTr.eq(1).find("input").val()
                                                                                                    req.parameter_record_note_taker = thisTr.eq(2).text()
                                                                                                    req.parameter_record_note_taker_id = thisTr.eq(2).attr("takerId")
                                                                                                    req.parameter_record_write_time = thisTr.eq(3).find("input").val()
                                                                                                    req.parameter_record_describe = thisTr.eq(4).find("input").val()

                                                                                                    let req2=[], req3
                                                                                                    req2.push(req)
                                                                                                    req3 = JSON.stringify(req2)

                                                                                                    swal({
                                                                                                      title: '您确定要修改吗？',
                                                                                                      type: 'question',
                                                                                                      showCancelButton: true,
                                                                                                      confirmButtonText: '确定',
                                                                                                      cancelButtonText: '取消'
                                                                                                    }).then(function (){
                                                                                                      $.ajax({
                                                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                        url:saveWorkOrderParameteRecordUrl,
                                                                                                        data: {
                                                                                                          type:"modify",
                                                                                                          parameteRecords:req3,
                                                                                                        },
                                                                                                        success: function (result, status, xhr) {
                                                                                                          if (result.status === 0) {
                                                                                                            let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                            swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                          }else {
                                                                                                            swal({
                                                                                                              title: '删除失败',
                                                                                                              type: 'warning',
                                                                                                              timer: '1000',
                                                                                                              allowEscapeKey: false, // 用户按esc键不退出
                                                                                                              allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                              showCancelButton: false, // 显示用户取消按钮
                                                                                                              showConfirmButton: false, // 显示用户确认按钮
                                                                                                          })
                                                                                                          }
                                                                                                        },
                                                                                                      })
                                                                                                    })
                                                                                                    break;
                                                                                                  }
                                                                                                  case '#delete' :{
                                                                                                    swal({
                                                                                                      title: '您确定要删除吗？',
                                                                                                      type: 'question',
                                                                                                      showCancelButton: true,
                                                                                                      confirmButtonText: '确定',
                                                                                                      cancelButtonText: '取消'
                                                                                                    }).then(function (){
                                                                                                      $.ajax({
                                                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                        url:removeWorkOrderParameteRecordUrl,
                                                                                                        data: {
                                                                                                          parameteRecordIds:parameteRecordIdsList,
                                                                                                        },
                                                                                                        success: function (result, status, xhr) {
                                                                                                          if (result.status === 0) {
                                                                                                            let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                            swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                          }else {
                                                                                                            swal({
                                                                                                              title: '删除失败',
                                                                                                              type: 'warning',
                                                                                                              timer: '1000',
                                                                                                              allowEscapeKey: false, // 用户按esc键不退出
                                                                                                              allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                              showCancelButton: false, // 显示用户取消按钮
                                                                                                              showConfirmButton: false, // 显示用户确认按钮
                                                                                                          })
                                                                                                          }
                                                                                                        },
                                                                                                      })
                                                                                                    })
                                                                                                    break;
                                                                                                  }
                                                                                                }
                                                                                              })

                                                                                            }
                                                                                              break;


                                                                                            default:
                                                                                              break;
                                                                                          }
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  },

                                                                                  pagination: {
                                                                                    totalRow: result.map.line, // 总行数
                                                                                    displayRow: result.map.parameteRecords.length // 显示行数
                                                                                  },

                                                                                  ajax: {
                                                                                    url: url,
                                                                                    data: data
                                                                                  }
                                                                                })


                                                                              }
                                                                              else {
                                                                                mesloadBox.warningShow();
                                                                              }
                                                                            }
                                                                          })
                                                                        }

                                                                        // 导航栏点击时运行数据加载
                                                                        addTableData(queryWorkOrderParameteRecordUrl, {
                                                                          parameteId:parameteId,
                                                                          headNum: 1
                                                                        });

                                                                        break;
                                                                      }


                                                                    }
                                                                  })
                                                                  break;
                                                                default:
                                                                  break;
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },

                                                      pagination: {
                                                        totalRow: semiProParamersList.length, // 总行数
                                                        displayRow: semiProParamersList.length // 显示行数
                                                      },

                                                      ajax: {
                                                        url: url,
                                                        data: data
                                                      }
                                                    })
                                                  }else{
                                                    panel_4.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                  }


                                                  // panel3  其他
                                                  if(otherParamersList.length!==0){
                                                    mesVerticalTableAddData(panel_5, {
                                                      thead: {
                                                        theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                        theadWidth: '4%/15%/15%/15%/15%/15%'
                                                      },
                                                      tbody: {
                                                        html: [
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td></td>',
                                                          '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal"><i class="fa fa-tasks fa-fw"></i>查看参数详情</a></td>'
                                                        ],

                                                        // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                        dataAddress: function (tbodyTarget, html, result) {
                                                          tbodyTarget.empty() // 清空表格主体
                                                          let dataList = otherParamersList, // 主要数据列表
                                                          tempData = null; // 表格td内的临时数据
                                                          for (let i = 0, len = dataList.length; i < len; i++) {
                                                            tbodyTarget.append('<tr></tr>'); // 添加行
                                                            let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                            for (let i = 0, len = html.length; i < len; i++) {
                                                              currentTr.append(html[i]); // 添加表格内的HTML
                                                              switch (i) {
                                                                case 0:
                                                                  currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                  break;
                                                                case 1: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                  // tempData=
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;
                                                                case 2: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  if(tempData = "constantValue"){
                                                                    currentTr.children().eq(i).html( "固定值")
                                                                  }else if(tempData = "rangeValue"){
                                                                    currentTr.children().eq(i).html("范围值")
                                                                  }else if(tempData = "deviationValue"){
                                                                    currentTr.children().eq(i).html("浮动值")
                                                                  }
                                                                }
                                                                  break;
                                                                case 3: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                  let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                  let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                  let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                  let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                                }
                                                                  break;
                                                                case 4: {
                                                                  tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                  currentTr.children().eq(i).html(tempData)
                                                                }
                                                                  break;

                                                                case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  workstageId = dataList[currentTr.index()].workstage_id,
                                                                  parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                  ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type
                                                                  switch (dataContent) {
                                                                    case '#detailModal': {	//详情
                                                                      let dataContent = $('#detailModal2'),
                                                                        panelList = dataContent.find('.panel'),
                                                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                        panelThead = panelList.find('thead'),
                                                                        panelTbody = panelList.find('tbody');
                                                                        panelList.find('.panel-heading').find('.modal-title').text('详情') // 更换panel标题

                                                                        dataContent.modal({
                                                                          backdrop: false, // 黑色遮罩不可点击
                                                                          keyboard: false,  // esc按键不可弃用模态框
                                                                          show: false
                                                                        })
                                                                        dataContent.modal('show') // 运行时显示
                                                                        dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                          $('body').addClass('modal-open')
                                                                        })

                                                                        modalCloseBtn.off('click').on('click', (event) => {
                                                                          // 点击弃用按钮隐藏该模态框
                                                                          dataContent.modal('hide')
                                                                          // 初始化表格
                                                                          panelList.find('thead').empty()
                                                                          panelList.find('tbody').empty()
                                                                        })

                                                                      // 主表格添加内容
                                                                      function addTableData(url, data) {
                                                                        $.ajax({
                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                          url: url,
                                                                          data: data,
                                                                          beforeSend: function (xml) {
                                                                            // ajax发送前
                                                                            mesloadBox.loadingShow()
                                                                          },
                                                                          success: function (result, status, xhr) {
                                                                            // ajax成功
                                                                            mesloadBox.hide()
                                                                            if (result.status === 0) {
                                                                              //panel1
                                                                              mesVerticalTableAddData(panelList, {
                                                                                thead: {
                                                                                  theadContent: '序号/实际值/记录人/记录时间/备注/操作',
                                                                                  theadWidth: '6%/15%/15%/15%/15%/15%'
                                                                                },
                                                                                tbody: {
                                                                                  html: [
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td></td>',
                                                                                    '<td><a  href="javascript:;" data-toggle-modal-target="#edit"><i class="fa fa-tasks fa-fw"></i>修改</a><a  href="javascript:;" data-toggle-modal-target="#delete"><i class="fa fa-tasks fa-fw"></i>删除</a></td>'

                                                                                  ],

                                                                                  // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                  dataAddress: function (tbodyTarget, html, result) {
                                                                                    tbodyTarget.empty() // 清空表格主体
                                                                                    let map = result.map, // 映射zszs
                                                                                      dataList = map.parameteRecords, // 主要数据列表
                                                                                      tempData = null; // 表格td内的临时数据
                                                                                    for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                      tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                      let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                      for (let i = 0, len = html.length; i < len; i++) {
                                                                                        currentTr.append(html[i]); // 添加表格内的HTML
                                                                                        switch (i) {
                                                                                          case 0:
                                                                                            currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                            break;
                                                                                          case 1: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_steady_state_value;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 2: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_note_taker;
                                                                                            currentTr.children().eq(i).html(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 3: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_write_time;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/>`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(moment(tempData).format('YYYY-MM-DD HH:mm:ss'))
                                                                                          }
                                                                                            break;
                                                                                          case 4: {
                                                                                            tempData = dataList[currentTr.index()].parameter_record_describe;
                                                                                            let inputHtml = `<input type="text" class="table-input" placeholder="" autocomplete="on" />`;
                                                                                            currentTr.children().eq(i).addClass('table-input-td table-link ')
                                                                                            currentTr.children().eq(i).html(inputHtml)

                                                                                            currentTr.children().eq(i).find('input').val(tempData)
                                                                                          }
                                                                                            break;
                                                                                          case 5: {
                                                                                            currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                              let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                              parameteRecordIds = dataList[currentTr.index()].parameter_record_id,
                                                                                              parameteRecordIdsList=[]
                                                                                              parameteRecordIdsList.push(parameteRecordIds)
                                                                                              switch (dataContent) {
                                                                                                case '#edit': {	//
                                                                                                  req={
                                                                                                    craft_workstep_parameter_main_id:"",//参数id//
                                                                                                    craft_workstep_parameter_id:"",//参数id
                                                                                                    standard_parameter_type_id:"",//参数lx id//
                                                                                                    workstage_id:"",//工序id//
                                                                                                    work_order_id:"",//工序id//
                                                                                                    parameter_record_steady_state_value:"",//参数记录值
                                                                                                    parameter_record_write_time:"",//记录时间
                                                                                                    parameter_record_note_taker:"",//记录人
                                                                                                    parameter_record_note_taker_id:"",//记录id
                                                                                                    parameter_record_describe:"",//描述
                                                                                                    parameter_record_value_type:"",////
                                                                                                    parameter_record_id:""
                                                                                                  }
                                                                                                  req.craft_workstep_parameter_main_id = parameteRecordId
                                                                                                  req.workstage_id = workstageId
                                                                                                  req.standard_parameter_type_id = parametertypeId
                                                                                                  req.work_order_id = workOrderId
                                                                                                  req.parameter_record_value_type = ParameteValueType
                                                                                                  req.parameter_record_id = parameteRecordIds

                                                                                                  let thisTr =currentTr.find("td")
                                                                                                  req.parameter_record_steady_state_value = thisTr.eq(1).find("input").val()
                                                                                                  req.parameter_record_note_taker = thisTr.eq(2).text()
                                                                                                  req.parameter_record_note_taker_id = thisTr.eq(2).attr("takerId")
                                                                                                  req.parameter_record_write_time = thisTr.eq(3).find("input").val()
                                                                                                  req.parameter_record_describe = thisTr.eq(4).find("input").val()

                                                                                                  let req2=[], req3
                                                                                                  req2.push(req)
                                                                                                  req3 = JSON.stringify(req2)

                                                                                                  swal({
                                                                                                    title: '您确定要修改吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:saveWorkOrderParameteRecordUrl,
                                                                                                      data: {
                                                                                                        type:"modify",
                                                                                                        parameteRecords:req3,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                          swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                                case '#delete' :{
                                                                                                  swal({
                                                                                                    title: '您确定要删除吗？',
                                                                                                    type: 'question',
                                                                                                    showCancelButton: true,
                                                                                                    confirmButtonText: '确定',
                                                                                                    cancelButtonText: '取消'
                                                                                                  }).then(function (){
                                                                                                    $.ajax({
                                                                                                       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                      url:removeWorkOrderParameteRecordUrl,
                                                                                                      data: {
                                                                                                        parameteRecordIds:parameteRecordIdsList,
                                                                                                      },
                                                                                                      success: function (result, status, xhr) {
                                                                                                        if (result.status === 0) {
                                                                                                          let activePaginationBtn = panelList.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                                                                          swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                                                                                        }else {
                                                                                                          swal({
                                                                                                            title: '删除失败',
                                                                                                            type: 'warning',
                                                                                                            timer: '1000',
                                                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                            showCancelButton: false, // 显示用户取消按钮
                                                                                                            showConfirmButton: false, // 显示用户确认按钮
                                                                                                        })
                                                                                                        }
                                                                                                      },
                                                                                                    })
                                                                                                  })
                                                                                                  break;
                                                                                                }
                                                                                              }
                                                                                            })

                                                                                          }
                                                                                            break;


                                                                                          default:
                                                                                            break;
                                                                                        }
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                },

                                                                                pagination: {
                                                                                  totalRow: result.map.line, // 总行数
                                                                                  displayRow: result.map.parameteRecords.length // 显示行数
                                                                                },

                                                                                ajax: {
                                                                                  url: url,
                                                                                  data: data
                                                                                }
                                                                              })


                                                                            }
                                                                            else {
                                                                              panelTbody.empty().append(NO_DATA_NOTICE)
                                                                              mesloadBox.warningShow();
                                                                            }
                                                                          }
                                                                        })
                                                                      }

                                                                      // 导航栏点击时运行数据加载
                                                                      addTableData(queryWorkOrderParameteRecordUrl, {
                                                                        parameteId:parameteId,
                                                                        headNum: 1
                                                                      });

                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                  break;
                                                                default:
                                                                  break;
                                                              }
                                                            }
                                                          }
                                                        }
                                                      },

                                                      pagination: {
                                                        totalRow:otherParamersList.length, // 总行数
                                                        displayRow: otherParamersList.length // 显示行数
                                                      },

                                                      ajax: {
                                                        url: url,
                                                        data: data
                                                      }
                                                    })
                                                  }else{
                                                    panel_5.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                  }


                                                }
                                                else {
                                                  mesloadBox.warningShow();
                                                }
                                              }
                                            })
                                          }

                                          addTableData(queryWorkOrderParticularsUrl, {
                                            workOrderId:workOrderId
                                          });
                                          addTableData2(queryWorkstageParticularsUrl, {
                                            //workstageIds:["283b7b8fd83040d789b0dec1b88d79e5"]
                                            workstageIds:workstageId
                                          });

                                        }


                                        break;
                                      }
                                      case "#processDetails": { //过程详情
                                        let dataContent = $('#detailModal8'),
                                        panelList = dataContent.find('.panel'),
                                        modalCloseBtn = dataContent.find('.modal-header').find('.close')
                                        panelList.find('.panel-heading').find('.modal-title').text('工单过程详情') // 更换panel标题

                                        dataContent.modal('show') // 运行时显示

                                        modalCloseBtn.off('click').on('click', (event) => {
                                          // 点击弃用按钮隐藏该模态框
                                          dataContent.modal('hide')
                                          // 初始化表格
                                          panelList.find("ul").empty()
                                        })

                                        // 主表格添加内容
                                        function addTableData(url, data) {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: url,
                                            data: data,
                                            beforeSend: function (xml) {
                                              // ajax发送前
                                              mesloadBox.loadingShow()
                                            },
                                            success: function (result, status, xhr) {
                                              // ajax成功
                                              mesloadBox.hide()
                                              if (result.status === 0) {
                                                let map = result.map, // 映射
                                                dataList = map.processRecord ,// 主要数据列表
                                                html=""
                                                $.each(dataList,function(i,p){
                                                let tempData = p.process_records_operation_time;
                                                tempData=moment(tempData).format('YYYY-MM-DD HH:mm')
                                                html+=`<li>${p.process_records_operator}在${tempData}${p.process_records_operation_executive}<li/>`
                                                })
                                                panelList.find("ul").html(html)
                                              }
                                              else {
                                                mesloadBox.warningShow();
                                              }
                                            }
                                          })
                                        }

                                        // 导航栏点击时运行数据加载
                                        addTableData(queryWorkOrderProcessParticularsUrl, {
                                          workOrderId:workOrderId,
                                          headNum:1
                                        });

                                        panelList.find(".about4_main ul li:first-child").css("height",30)
                                        panelList.find(".about4_main ul li:last-child").prev().css("height",30)
                                        let h = panelList.find(".about4_main ul li:first-child").height()/2;//<!--第一个li高度的一半-->
                                        let h1 = panelList.find(".about4_main ul li:last-child").prev().height()/2;//<!--第一个li高度的一半--

                                        console.log(h)
                                        console.log(h1)
                                        console.log($(".about4_main").height())

                                        panelList.find(".line").css("top",35);
                                        panelList.find(".line").css("bottom",35);
                                        panelList.find(".line").height($(".about4_main").height()-h1-h);
                                        console.log($(".line").height())



                                        break;
                                      }
                                      case '#addExecutionRecordn': {	//添加执行记录
                                        let dataContent = $('#workOrderDetailModal'),
                                        panelList = dataContent.find('.panel'),
                                        panel_1=panelList.eq(0),
                                        panel_2=panelList.eq(1),
                                        panel_3=panelList.eq(2),
                                        panel_4=panelList.eq(3),
                                        panel_5=panelList.eq(4),
                                        modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                        modalSubmitBtn = dataContent.find('.modal-submit')


                                        panel_1.find('.panel-heading').find('.panel-title').text("基本详情") // 更换panel标题
                                        panel_2.find('.panel-heading').find('.panel-title').text("工步") // 更换panel标题
                                        panel_3.find('.panel-heading').find('.panel-title').text("环境参数") // 更换panel标题
                                        panel_4.find('.panel-heading').find('.panel-title').text("半成品参数") // 更换panel标题
                                        panel_5.find('.panel-heading').find('.panel-title').text("其他") // 更换panel标题

                                        dataContent.modal({
                                          backdrop: false, // 黑色遮罩不可点击
                                          keyboard: false,  // esc按键不可弃用模态框
                                          show: false
                                        })
                                        dataContent.modal('show') // 运行时显示
                                        modalSubmitBtn.hide()

                                        // dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                        //   $('body').addClass('modal-open')
                                        // })

                                        modalCloseBtn.off('click').on('click', (event) => {
                                          // 点击弃用按钮隐藏该模态框
                                          dataContent.modal('hide')
                                          // 初始化表格
                                          panel_2.find("tbody").empty()
                                          panel_3.find("tbody").empty()
                                          panel_4.find("tbody").empty()
                                          panel_5.find("tbody").empty()
                                        })
                                        // 添加主体表单数据
                                        function addTableData(url, data) {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: url,
                                            data: data,
                                            beforeSend: function (xml) {
                                              // ajax发送前
                                              mesloadBox.loadingShow()
                                            },
                                            success: function (result, status, xhr) {
                                              // ajax成功
                                              mesloadBox.hide()
                                              if (result.status === 0) {
                                                //panel1 基础消息
                                                mesHorizontalTableAddData(panel_1.find('table'), null, {
                                                  thead: '工单号/所属生产批号/产品型号/工艺/工艺版本/工序/工序优率/工序负责人/极性/半成品类型/半成品型号/预计产出量/半成品单位/生产线/生产车间/生产优先级/工单创建人/工单负责人/工单创建时间/预定开始日期/预定完成时间/实际产出量/实际开始时间/实际完成日期/班次',
                                                  tableWitch: '15%/15%/15%',
                                                  viewColGroup: 3,
                                                  importStaticData: (tbodyTd, length) => {
                                                    let map = result.map, // 映射
                                                    dataList = map.workOrder, // 主要数据列表
                                                    selectHtml = `<select class="form-control table-input input-sm"></select>`,
                                                    tempData = null; // 表格td内的临时数据

                                                    for (let i = 0, len = length; i < len; i++) {
                                                      switch (i) {
                                                        case 0: {
                                                          tempData = dataList.work_order_number
                                                          tbodyTd.eq(i).html(tempData);
                                                        }
                                                          break;
                                                        case 1: {
                                                          tempData = dataList.plan.production_plan_batch_number;
                                                          tbodyTd.eq(i).html(tempData);
                                                        }
                                                          break;
                                                        case 2: {
                                                          tempData =  dataList.plan.product_model_name
                                                          tbodyTd.eq(i).html(tempData)
                                                        }
                                                        break;
                                                        case 3: {
                                                          tempData = dataList.plan.craft_name
                                                          tbodyTd.eq(i).html(tempData)
                                                        }
                                                        break;
                                                        case 4: {
                                                          tempData = dataList.plan.craft_versions
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 5: {
                                                          tempData =dataList.planQuotesWorkstage.workstage_name
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 6: {
                                                          tempData =dataList.planQuotesWorkstage.workstage_quality_rate
                                                           tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 7: {
                                                          tempData =dataList.planQuotesWorkstage.workstage_responsible
                                                           tbodyTd.eq(i).html(tempData)
                                                        }
                                                        break;
                                                        case 8: {
                                                          tempData =dataList.planQuotesWorkstage.workstage_polarity
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 9: {
                                                          tempData = dataList.planQuotesWorkstage.semi_finish_type_name
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 10: {
                                                          tempData = dataList.planQuotesWorkstage.semi_finish_genre
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 11: {
                                                          tempData = dataList.work_order_expected_output
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 12: {

                                                          tempData = dataList.planQuotesWorkstage.semi_finish_unit
                                                          tbodyTd.eq(i).html(tempData)
                                                        }
                                                        break;
                                                        case 13: {
                                                          tempData = dataList.plan.product_line_name
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 14: {
                                                          tempData = dataList.plan.product_line_name
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 15: {
                                                          tempData = dataList.plan.production_plan_production_priority
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 16: {
                                                          tempData = dataList.work_order_creators
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 17: {
                                                          tempData = dataList.work_order_responsible
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 18: {
                                                          tempData = dataList.work_order_creation_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 19: {
                                                          tempData = dataList.work_order_scheduled_start_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 20: {
                                                          tempData = dataList.work_order_estimated_completion_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 21: {
                                                          tempData = dataList.work_order_actual_output
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        case 22: {
                                                          tempData = dataList.work_order_actual_start_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 23: {
                                                          tempData = dataList.work_order_actual_finish_time
                                                          if(tempData!==null && tempData!=="" &&tempData !==undefined){
                                                            tbodyTd.eq(i).html(moment(tempData).format('YYYY-MM-DD'))
                                                          }else{
                                                            tbodyTd.eq(i).html("/")
                                                          }

                                                        }
                                                        break;
                                                        case 24: {
                                                          tempData = dataList.work_order_classes
                                                          tbodyTd.eq(i).html(tempData)

                                                        }
                                                        break;
                                                        default:
                                                          break;
                                                      }
                                                    }

                                                  }
                                                })
                                              }
                                              else {
                                                mesloadBox.warningShow();
                                              }
                                            }
                                          })
                                        }
                                        function addTableData2(url, data) {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: url,
                                            data: data,
                                            beforeSend: function (xml) {
                                              // ajax发送前
                                              mesloadBox.loadingShow()
                                            },
                                            success: function (result, status, xhr) {
                                              // ajax成功
                                              mesloadBox.hide()
                                              if (result.status === 0) {
                                                let parmList = result.map.workstageList[0].useParametersList,
                                                semiProParamersList=[],//半成品参数集合
                                                EnvirParamersList=[],//环境参数集合
                                                otherParamersList=[]//其他参数集合

                                                // for(var i=0;i<parmList.length;i++){
                                                //   if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                //     EnvirParamersList.push(parmList[i])
                                                //   }else if(parmList[i].standard_parameter_type_id === semiProParamersTypeId){
                                                //     semiProParamersList.push(parmList[i])
                                                //   }else{
                                                //     otherParamersList.push(parmList[i])
                                                //   }
                                                // }
                                                for(var i=0;i<parmList.length;i++){
                                                  if(parmList[i].standard_parameter_type_name == "环境参数"){
                                                    EnvirParamersList.push(parmList[i])
                                                  }else{
                                                    semiProParamersList.push(parmList[i])
                                                  }
                                                }
                                                //panel2 工步
                                                mesVerticalTableAddData(panel_2, {
                                                  thead: {
                                                    theadContent: '序号/工步名称/工步版本/工步编号/操作',
                                                    theadWidth: '6%/10%/10%/10%/35%'
                                                  },
                                                  tbody: {
                                                    html: [
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      // '<td></td>',
                                                      // '<td></td>',
                                                      '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#detailModal3"><i class="fa fa-tasks fa-fw"></i>添加物料使用详情</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#stepParm"><i class="fa fa-tasks fa-fw"></i>添加工步参数记录</a><a class="table-link" href="javascript:;" data-toggle-modal-target="#devicesOperate"><i class="fa fa-tasks fa-fw"></i>添加设备操作记录</a></td>'
                                                    ],

                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                    dataAddress: function (tbodyTarget, html, result) {
                                                      tbodyTarget.empty() // 清空表格主体
                                                      let map = result.map, // 映射zszs
                                                      dataList = map.workstageList[0].stageAndStepRelationList, // 主要数据列表
                                                      tempData = null; // 表格td内的临时数据
                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                          switch (i) {
                                                            case 0:
                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                              break;
                                                            case 1: {
                                                              tempData = dataList[currentTr.index()].workstep.craft_control_workstep_name;
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;
                                                            case 2: {
                                                              tempData = dataList[currentTr.index()].workstep.craft_control_workstep_version;
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;
                                                            case 3: {
                                                              tempData = dataList[currentTr.index()].workstep.craft_control_workstep_num;
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;
                                                            case 4:
                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                stepList = []
                                                                stepId = dataList[currentTr.index()].workstep.craft_control_workstep_id;
                                                                stepList.push(stepId)
                                                                switch (dataContent) {
                                                                  case '#detailModal3': {	//添加物料使用详情
                                                                    let dataContent = $('#submitModelModal3'),
                                                                      panelList = dataContent.find('.panel'),
                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                      modalSubmitBtn = dataContent.find('.modal-submit')
                                                                      panelList.find('.panel-heading').find('.panel-title').text("添加投料详情") // 更换panel标题


                                                                      dataContent.modal({
                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                        show: false
                                                                      })

                                                                      dataContent.modal('show') // 运行时显示
                                                                      modalSubmitBtn.hide()

                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                        $('body').addClass('modal-open')
                                                                      })

                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                        // 点击弃用按钮隐藏该模态框
                                                                        dataContent.modal('hide')
                                                                        // 初始化表格
                                                                        panelList.find('thead').empty()
                                                                        panelList.find('tbody').empty()
                                                                      })

                                                                    // 主表格添加内容
                                                                    function addTableData(url, data) {
                                                                      $.ajax({
                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                        url: url,
                                                                        data: data,
                                                                        beforeSend: function (xml) {
                                                                          // ajax发送前
                                                                          mesloadBox.loadingShow()
                                                                        },
                                                                        success: function (result, status, xhr) {
                                                                          // ajax成功
                                                                          mesloadBox.hide()
                                                                          if (result.status === 0) {
                                                                            //panel1
                                                                            mesVerticalTableAddData(panelList, {
                                                                              thead: {
                                                                                theadContent: '序号/物料名称/规格/型号/单位/操作',
                                                                                theadWidth: '4%/15%/15%/15%/15%/15%'
                                                                              },
                                                                              tbody: {
                                                                                html: [
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#add"><i class="fa fa-tasks fa-fw"></i>添加</a></td>'
                                                                                ],

                                                                                // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                dataAddress: function (tbodyTarget, html, result) {
                                                                                  tbodyTarget.empty() // 清空表格主体
                                                                                  let map = result.map, // 映射zszs
                                                                                  dataList = map.workstepList[0].useMaterielList, // 主要数据列表
                                                                                    tempData = null; // 表格td内的临时数据
                                                                                  for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                    tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                    let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                    for (let i = 0, len = html.length; i < len; i++) {
                                                                                      currentTr.append(html[i]); // 添加表格内的HTML
                                                                                      switch (i) {
                                                                                        case 0:
                                                                                          currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                          break;
                                                                                        case 1: {
                                                                                          tempData = dataList[currentTr.index()].craft_materiel_name;
                                                                                          // tempData=
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 2: {
                                                                                          tempData = dataList[currentTr.index()].craft_materiel_specifications;
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 3: {
                                                                                          tempData = dataList[currentTr.index()].craft_materiel_model;
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 4: {
                                                                                          tempData = dataList[currentTr.index()].craft_materiel_unit;
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;

                                                                                        case 5:
                                                                                          currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                            let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                             materielID = dataList[currentTr.index()].craft_materiel_id;
                                                                                             mainMaterielID = dataList[currentTr.index()].craft_materiel_main_id;
                                                                                             materielUnit= dataList[currentTr.index()].craft_materiel_unit;
                                                                                             materielName= dataList[currentTr.index()].craft_materiel_name;
                                                                                             materielSpecifications= dataList[currentTr.index()].craft_materiel_specifications;
                                                                                             materielModel= dataList[currentTr.index()].craft_materiel_model;
                                                                                            switch (dataContent) {
                                                                                              case '#add': {	//t添加
                                                                                                let dataContent = $('#submitModelModal4'),
                                                                                                  panelList = dataContent.find('.panel'),
                                                                                                  modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                  panelThead = panelList.find('thead'),
                                                                                                  panelTbody = panelList.find('tbody'),
                                                                                                  modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                                                  headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                                                  panelList.find('.panel-heading').find('.panel-title').text('添加物料记录') // 更换panel标题

                                                                                                  dataContent.modal({
                                                                                                    backdrop: false, // 黑色遮罩不可点击
                                                                                                    keyboard: false,  // esc按键不可弃用模态框
                                                                                                    show: false
                                                                                                  })

                                                                                                  dataContent.modal('show') // 运行时显示
                                                                                                  dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                    $('body').addClass('modal-open')
                                                                                                  })

                                                                                                  modalCloseBtn.off('click').on('click', (event) => {
                                                                                                    // 点击弃用按钮隐藏该模态框
                                                                                                    dataContent.modal('hide')
                                                                                                    // 初始化表格
                                                                                                    panelList.find('thead').empty()
                                                                                                    panelList.find('tbody').empty()
                                                                                                  })
                                                                                                  let term= `
                                                                                                  <tr>
                                                                                                  <th style="width:5%">序号</th>
                                                                                                  <th style="width:10%">投料时间</th>
                                                                                                  <th style="width:8%"> 使用数量</th>
                                                                                                  <th style="width:8%"> 物料编号</th>
                                                                                                  <th style="width:8%">投料人</th>
                                                                                                  <th style="width:8%">备注</th>
                                                                                                  <th style="width:18%">操作</th>
                                                                                                  </tr>
                                                                                                  `
                                                                                                  panelThead.empty().append(term)

                                                                                                  headingMainBtn_1.off('click').on('click', (event) => {
                                                                                                    let term2 =`
                                                                                                    <tr>
                                                                                                      <td ></td>
                                                                                                      <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input class="table-input" type="text" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input class="table-input" type="text" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                                                      <td class="table-input-td">
                                                                                                        <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                                                        <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                                                        <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                                                      </td>
                                                                                                    </tr>
                                                                                                    `
                                                                                                    panelTbody.append(term2)

                                                                                                    let tr = panelTbody.find('tr');
                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      // panel_table.find('tbody').append(temStr)
                                                                                                      panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                                                      ;
                                                                                                    }

                                                                                                    panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                                                      // 添加员工选择模态框
                                                                                                      let $this = $(this),
                                                                                                        promise = new Promise(function (resolve, reject) {
                                                                                                        selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                                                      });
                                                                                                      promise.then(function (resolveData) {
                                                                                                        $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                                                        // submithData.creator = resolveData.roleStaffId
                                                                                                      })

                                                                                                      $this.prop('readonly', true) // 输入框只读
                                                                                                      $this.off('blur').on('blur', () => {
                                                                                                        $this.removeProp('readonly') // 输入移除框只读
                                                                                                      })

                                                                                                    })

                                                                                                  })

                                                                                                  headingMainBtn_1.trigger('click')		//默认添加一行


                                                                                                  panelList.off('click').on('click', 'tr td a', function(event) {
                                                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                                                    let tr = panelTbody.find('tr');
                                                                                                    switch (dataContent) {
                                                                                                      case "delete":{
                                                                                                        $(this).closest('tr').remove();
                                                                                                      }
                                                                                                        break;
                                                                                                      case "down":{
                                                                                                        let thisTr=$(this).closest('tr');
                                                                                                        if(thisTr.index()!=tr.length-1){
                                                                                                          thisTr.fadeOut().fadeIn();
                                                                                                          thisTr.next().after(thisTr);
                                                                                                          }
                                                                                                      }
                                                                                                        break;
                                                                                                      case "up":{
                                                                                                        let thisTr=$(this).closest('tr');  //
                                                                                                        if(thisTr.index()!=0){
                                                                                                          thisTr.fadeOut().fadeIn();
                                                                                                          thisTr.prev().before(thisTr);
                                                                                                        }
                                                                                                      }
                                                                                                        break;
                                                                                                    }

                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                                                      ;
                                                                                                    }
                                                                                                  });

                                                                                                  modalSubmitBtn.off("click").on("click",(event)=>{
                                                                                                    let tr = panelTbody.find('tr'),
                                                                                                    materialUseRecords=[]

                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      let $td = tr.eq(i).find('td')
                                                                                                      req={
                                                                                                        craft_materiel_id:"",//使用物料id
                                                                                                        craft_materiel_main_id:"",//工步物料使用列表id
                                                                                                        step_use_material_time:"",//使用时间
                                                                                                        step_use_material_amount:"",//使用数量
                                                                                                        step_use_material_user:"",//使用人
                                                                                                        step_use_material_user_id:"",//使用人id
                                                                                                        step_use_material_describe:"",//备注
                                                                                                        craft_materiel_unit:"",
                                                                                                        craft_materiel_name:"",
                                                                                                        craft_materiel_specifications:"",
                                                                                                        craft_materiel_model:"",
                                                                                                        work_order_id:"",
                                                                                                        step_use_material_number:""
                                                                                                      }
                                                                                                      req.craft_materiel_id=materielID
                                                                                                      req.craft_materiel_main_id=mainMaterielID
                                                                                                      req.craft_materiel_unit=materielUnit
                                                                                                      req.craft_materiel_name=materielName
                                                                                                      req.craft_materiel_specifications=materielSpecifications
                                                                                                      req.craft_materiel_model=materielModel
                                                                                                      req.work_order_id=workOrderId

                                                                                                      for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                                                        switch (i) {
                                                                                                          case 0: {

                                                                                                            break;
                                                                                                          }
                                                                                                          case 1: {
                                                                                                            req.step_use_material_time = $td.eq(i).find('input').val()
                                                                                                            break;
                                                                                                          }
                                                                                                          case 2: {
                                                                                                            req.step_use_material_amount = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 3: {
                                                                                                            req.step_use_material_number = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 4: {
                                                                                                            req.step_use_material_user= $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            req.step_use_material_user_id = $td.eq(i).find('input').attr("principal");

                                                                                                            break;
                                                                                                          }
                                                                                                          case 5: {
                                                                                                            req.step_use_material_describe = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }

                                                                                                        }
                                                                                                      }
                                                                                                      materialUseRecords.push(req)

                                                                                                    }
                                                                                                    let materialUseRecords2
                                                                                                    materialUseRecords2= JSON.stringify(materialUseRecords);
                                                                                                    if (true
                                                                                                    ) {
                                                                                                      swal({
                                                                                                        title: '您确定要提交本次操作吗?',
                                                                                                        text: '请确保填写信息无误后点击确定按钮',
                                                                                                        type: 'question',
                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                        showCancelButton: true, // 显示用户取消按钮
                                                                                                        confirmButtonText: '确定',
                                                                                                        cancelButtonText: '取消',
                                                                                                      }).then(function () {
                                                                                                        $.ajax({
                                                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                          url: saveWorkOrderMaterialUseRecordUrl,
                                                                                                          data: {
                                                                                                            type:"save",
                                                                                                            materialUseRecords:materialUseRecords2
                                                                                                          },
                                                                                                          success: function (result, status, xhr) {
                                                                                                            if (result.status === 0) {
                                                                                                              swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                                                            }else if(result.status !== 0) {
                                                                                                              let msg = result.msg
                                                                                                              if(msg!==null){
                                                                                                                swallFail2(msg)
                                                                                                              }else{
                                                                                                                swallError();	//格式不正确
                                                                                                              }

                                                                                                            }
                                                                                                          }
                                                                                                        })
                                                                                                      });
                                                                                                    }
                                                                                                    else {
                                                                                                      swallError();	//格式不正确
                                                                                                    }

                                                                                                  })


                                                                                                break;
                                                                                              }
                                                                                            }
                                                                                          })
                                                                                          break;
                                                                                        default:
                                                                                          break;
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                }
                                                                              },

                                                                              pagination: {
                                                                                totalRow:result.map.workstepList[0].useMaterielList.length, // 总行数
                                                                                displayRow: result.map.workstepList[0].useMaterielList.length // 显示行数
                                                                              },

                                                                              ajax: {
                                                                                url: url,
                                                                                data: data
                                                                              }
                                                                            })
                                                                          }
                                                                          else {
                                                                            mesloadBox.warningShow();
                                                                          }
                                                                        }
                                                                      })
                                                                    }

                                                                    // 导航栏点击时运行数据加载
                                                                    addTableData(queryStepParticularsUrl, {
                                                                      stepIds:stepList,
                                                                    });

                                                                    break;
                                                                  }
                                                                  case '#stepParm': {	//工步参数记录详情
                                                                    let dataContent = $('#submitModelModal3'),
                                                                      panelList = dataContent.find('.panel'),
                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                      modalSubmitBtn = dataContent.find('.modal-submit')
                                                                      panelList.find('.panel-heading').find('.panel-title').text("添加工步参数详情")// 更换panel标题


                                                                      dataContent.modal({
                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                        show: false
                                                                      })

                                                                      dataContent.modal('show') // 运行时显示
                                                                      modalSubmitBtn.hide()
                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                        $('body').addClass('modal-open')
                                                                      })

                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                        // 点击弃用按钮隐藏该模态框
                                                                        dataContent.modal('hide')
                                                                        // 初始化表格
                                                                        panelList.find('thead').empty()
                                                                        panelList.find('tbody').empty()
                                                                      })

                                                                    // 主表格添加内容
                                                                    function addTableData(url, data) {
                                                                      $.ajax({
                                                                         type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                        url: url,
                                                                        data: data,
                                                                        beforeSend: function (xml) {
                                                                          // ajax发送前
                                                                          mesloadBox.loadingShow()
                                                                        },
                                                                        success: function (result, status, xhr) {
                                                                          // ajax成功
                                                                          mesloadBox.hide()
                                                                          if (result.status === 0) {
                                                                            //panel1
                                                                            mesVerticalTableAddData(panelList, {
                                                                              thead: {
                                                                                theadContent: '序号/参数/值类型/参考值/单位/设备类型/操作',
                                                                                theadWidth: '6%/15%/15%/15%/15%/15%/15%'
                                                                              },
                                                                              tbody: {
                                                                                html: [
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td></td>',
                                                                                  '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#add"><i class="fa fa-tasks fa-fw"></i>添加</a></td>'
                                                                                ],

                                                                                // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                                                dataAddress: function (tbodyTarget, html, result) {
                                                                                  tbodyTarget.empty() // 清空表格主体
                                                                                  let map = result.map, // 映射zszs
                                                                                    dataList = map.workstepList[0].workstepParameterList, // 主要数据列表
                                                                                    tempData = null; // 表格td内的临时数据
                                                                                  for (let i = 0, len = dataList.length; i < len; i++) {
                                                                                    tbodyTarget.append('<tr></tr>'); // 添加行
                                                                                    let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                                                    for (let i = 0, len = html.length; i < len; i++) {
                                                                                      currentTr.append(html[i]); // 添加表格内的HTML
                                                                                      switch (i) {
                                                                                        case 0:
                                                                                          currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                                          break;
                                                                                        case 1: {
                                                                                          tempData = dataList[currentTr.index()].craft_workstep_parameter_name;
                                                                                          // tempData=
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 2: {
                                                                                          tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                                          if(tempData = "constantValue"){
                                                                                            currentTr.children().eq(i).html( "固定值")
                                                                                          }else if(tempData = "rangeValue"){
                                                                                            currentTr.children().eq(i).html("范围值")
                                                                                          }else if(tempData = "deviationValue"){
                                                                                            currentTr.children().eq(i).html("浮动值")
                                                                                          }
                                                                                        }
                                                                                          break;
                                                                                        case 3: {
                                                                                          tempData = dataList[currentTr.index()].craft_workstep_parameter_value_type;
                                                                                          let  constantValue = dataList[currentTr.index()].workstep_parameter_constant_value;
                                                                                          let  minValue = dataList[currentTr.index()].workstep_parameter_minimum_value;
                                                                                          let  maxValue = dataList[currentTr.index()].workstep_parameter_max_value;
                                                                                          let  errorValue = dataList[currentTr.index()].workstep_parameter_error_value;
                                                                                            if(tempData == "constantValue"){
                                                                                              currentTr.children().eq(i).html(constantValue)
                                                                                            }else if(tempData == "rangeValue"){
                                                                                              currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                                            }else if(tempData == "deviationValue"){
                                                                                              currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                                            }
                                                                                        }
                                                                                          break;
                                                                                        case 4: {
                                                                                          tempData = dataList[currentTr.index()].workstep_parameter_unit;
                                                                                          currentTr.children().eq(i).html(tempData)
                                                                                        }
                                                                                          break;
                                                                                        case 5: {
                                                                                          tempData = dataList[currentTr.index()].devices_control_devices_type_id;
                                                                                          let 	selectHtml = `<select class="form-control table-input input-sm"></select>`
                                                                                          currentTr.children().eq(i).addClass('table-input-td')
                                                                                          currentTr.children().eq(i).html(selectHtml)

                                                                                          let target =  currentTr.children().eq(i).find('select');
                                                                                          for (let i = 0, len = devicesTypeList.length; i < len; i++) {
                                                                                            let optionStr = `<option value="${devicesTypeList[i].devices_control_devices_type_id}">${devicesTypeList[i].devices_control_devices_type_name}</option>`;
                                                                                            target.append(optionStr);
                                                                                          }
                                                                                          target.val(tempData).attr('disabled',true)
                                                                                        }
                                                                                          break;

                                                                                        case 6:
                                                                                          currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                                            let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                                            stepParameteId = dataList[currentTr.index()].craft_workstep_parameter_main_id,
                                                                                            unit = dataList[currentTr.index()].workstep_parameter_unit,
                                                                                            ParameteId = dataList[currentTr.index()].craft_control_workstep_id,
                                                                                            ParameteName = dataList[currentTr.index()].craft_workstep_parameter_name,
                                                                                            ParameteValueType = dataList[currentTr.index()].craft_workstep_parameter_value_type,
                                                                                            ParameteConstantValue = dataList[currentTr.index()].workstep_parameter_constant_value,
                                                                                            devicesTypeId= dataList[currentTr.index()].devices_control_devices_type_id,
                                                                                            valueType= dataList[currentTr.index()].craft_workstep_parameter_value_type
                                                                                            switch (dataContent) {
                                                                                              case '#add': {	//t添加
                                                                                                let dataContent = $('#submitModelModal4'),
                                                                                                  panelList = dataContent.find('.panel'),
                                                                                                  modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                                                  panelThead = panelList.find('thead'),
                                                                                                  panelTbody = panelList.find('tbody'),
                                                                                                  modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                                                  headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                                                  panelList.find('.panel-heading').find('.panel-title').text('添加参数记录') // 更换panel标题

                                                                                                  dataContent.modal({
                                                                                                    backdrop: false, // 黑色遮罩不可点击
                                                                                                    keyboard: false,  // esc按键不可弃用模态框
                                                                                                    show: false
                                                                                                  })

                                                                                                  dataContent.modal('show') // 运行时显示
                                                                                                  dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                                                    $('body').addClass('modal-open')
                                                                                                  })

                                                                                                  modalCloseBtn.off('click').on('click', (event) => {
                                                                                                    // 点击弃用按钮隐藏该模态框
                                                                                                    dataContent.modal('hide')
                                                                                                    // 初始化表格
                                                                                                    panelList.find('thead').empty()
                                                                                                    panelList.find('tbody').empty()
                                                                                                  })
                                                                                                  let term= `
                                                                                                  <tr>
                                                                                                  <th style="width:2%">序号</th>
                                                                                                  <th style="width:4%">参数值</th>
                                                                                                  <th style="width:5%">记录人</th>
                                                                                                  <th style="width:7%">记录时间</th>
                                                                                                  <th style="width:8%"> 设备编号</th>
                                                                                                  <th style="width:8%">备注</th>
                                                                                                  <th style="width:8%">操作</th>
                                                                                                  </tr>
                                                                                                  `
                                                                                                  panelThead.empty().append(term)

                                                                                                  headingMainBtn_1.off('click').on('click', (event) => {
                                                                                                    let term2 =`
                                                                                                    <tr>
                                                                                                      <td ></td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input class="table-input" type="text" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td">
                                                                                                        <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                                                      </td>
                                                                                                      <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                                                      <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                                                      <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                                                      <td class="table-input-td">
                                                                                                        <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                                                        <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                                                        <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                                                      </td>
                                                                                                    </tr>
                                                                                                    `
                                                                                                    panelTbody.append(term2)

                                                                                                    let tr = panelTbody.find('tr');
                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      // panel_table.find('tbody').append(temStr)
                                                                                                      panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                                                      ;
                                                                                                    }

                                                                                                    panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                                                      // 添加员工选择模态框
                                                                                                      let $this = $(this),
                                                                                                        promise = new Promise(function (resolve, reject) {
                                                                                                        selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                                                      });
                                                                                                      promise.then(function (resolveData) {
                                                                                                        $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                                                        // submithData.creator = resolveData.roleStaffId
                                                                                                      })

                                                                                                      $this.prop('readonly', true) // 输入框只读
                                                                                                      $this.off('blur').on('blur', () => {
                                                                                                        $this.removeProp('readonly') // 输入移除框只读
                                                                                                      })

                                                                                                    })

                                                                                                  })

                                                                                                  headingMainBtn_1.trigger('click')		//默认添加一行


                                                                                                  panelList.off('click').on('click', 'tr td a', function(event) {
                                                                                                    let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                                                    let tr = panelTbody.find('tr');
                                                                                                    switch (dataContent) {
                                                                                                      case "delete":{
                                                                                                        $(this).closest('tr').remove();
                                                                                                      }
                                                                                                        break;
                                                                                                      case "down":{
                                                                                                        let thisTr=$(this).closest('tr');
                                                                                                        if(thisTr.index()!=tr.length-1){
                                                                                                          thisTr.fadeOut().fadeIn();
                                                                                                          thisTr.next().after(thisTr);
                                                                                                          }
                                                                                                      }
                                                                                                        break;
                                                                                                      case "up":{
                                                                                                        let thisTr=$(this).closest('tr');  //
                                                                                                        if(thisTr.index()!=0){
                                                                                                          thisTr.fadeOut().fadeIn();
                                                                                                          thisTr.prev().before(thisTr);
                                                                                                        }
                                                                                                      }
                                                                                                        break;
                                                                                                    }

                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                                                      ;
                                                                                                    }
                                                                                                  });

                                                                                                  modalSubmitBtn.off("click").on("click",(event)=>{
                                                                                                    let tr = panelTbody.find('tr'),
                                                                                                    stepParameteRecords=[]

                                                                                                    for(let i = 0;i<tr.length;i++){
                                                                                                      let $td = tr.eq(i).find('td')
                                                                                                      req={
                                                                                                        craft_workstep_parameter_main_id:"",//工步参数列表id
                                                                                                        step_use_steady_state_value:"",//恒定值
                                                                                                        step_use_note_taker:"",//记录人
                                                                                                        step_use_note_taker_id:"",//记录人id
                                                                                                        step_use_write_time:"",//记录时间
                                                                                                        devices_control_devices_number:"",//设备编号
                                                                                                        step_use_describe:"",//备注
                                                                                                        workstep_parameter_unit:"",//
                                                                                                        craft_workstep_parameter_id:"",//备注
                                                                                                        craft_workstep_parameter_name:"",//备注
                                                                                                        work_order_id:"",//备注
                                                                                                        step_use_parameter_value_type:"",//值类型
                                                                                                        devices_control_devices_type_id:""
                                                                                                      }
                                                                                                      req.craft_workstep_parameter_main_id = stepParameteId
                                                                                                      req.workstep_parameter_unit = unit
                                                                                                      req.craft_workstep_parameter_id = ParameteId
                                                                                                      req.craft_workstep_parameter_name = ParameteName
                                                                                                      req.devices_control_devices_type_id = devicesTypeId
                                                                                                      req.work_order_id = workOrderId
                                                                                                      req.step_use_parameter_value_type = valueType
                                                                                                      for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                                                        switch (i) {
                                                                                                          case 0: {

                                                                                                            break;
                                                                                                          }
                                                                                                          case 1: {
                                                                                                            req.step_use_steady_state_value = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 2: {
                                                                                                            req.step_use_note_taker_id = $td.eq(i).find('input').attr("principal");
                                                                                                            req.step_use_note_taker = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 3: {
                                                                                                            req.step_use_write_time = $td.eq(i).find('input').val()
                                                                                                            break;
                                                                                                          }
                                                                                                          case 4: {
                                                                                                            req.devices_control_devices_number = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }
                                                                                                          case 5: {
                                                                                                            req.step_use_describe = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                                            break;
                                                                                                          }

                                                                                                        }
                                                                                                      }
                                                                                                      // 拼成字符串
                                                                                                      stepParameteRecords.push(req)
                                                                                                      console.log(stepParameteRecords)

                                                                                                    }
                                                                                                    let stepParameteRecords2
                                                                                                    stepParameteRecords2= JSON.stringify(stepParameteRecords);

                                                                                                    if (true
                                                                                                    ) {
                                                                                                      swal({
                                                                                                        title: '您确定要提交本次操作吗?',
                                                                                                        text: '请确保填写信息无误后点击确定按钮',
                                                                                                        type: 'question',
                                                                                                        allowEscapeKey: false, // 用户按esc键不退出
                                                                                                        allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                                                        showCancelButton: true, // 显示用户取消按钮
                                                                                                        confirmButtonText: '确定',
                                                                                                        cancelButtonText: '取消',
                                                                                                      }).then(function () {
                                                                                                        $.ajax({
                                                                                                           type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                                                          url: saveWorkOrderStepParameteRecordUrl,
                                                                                                          data: {
                                                                                                            type:"save",
                                                                                                            stepParameteRecords:stepParameteRecords2
                                                                                                          },
                                                                                                          success: function (result, status, xhr) {
                                                                                                            if (result.status === 0) {
                                                                                                              swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                                                            }else if(result.status !== 0) {
                                                                                                              let msg = result.msg
                                                                                                              if(msg!==null){
                                                                                                                swallFail2(msg)
                                                                                                              }else{
                                                                                                                swallError();	//格式不正确
                                                                                                              }

                                                                                                            }
                                                                                                          }
                                                                                                        })
                                                                                                      });
                                                                                                    }
                                                                                                    else {
                                                                                                      swallError();	//格式不正确
                                                                                                    }


                                                                                                  })


                                                                                                break;
                                                                                              }
                                                                                            }
                                                                                          })
                                                                                          break;
                                                                                        default:
                                                                                          break;
                                                                                      }
                                                                                    }
                                                                                  }
                                                                                }
                                                                              },

                                                                              pagination: {
                                                                                totalRow: result.map.workstepList[0].workstepParameterList.length, // 总行数
                                                                                displayRow: result.map.workstepList[0].workstepParameterList.length // 显示行数
                                                                              },

                                                                              ajax: {
                                                                                url: url,
                                                                                data: data
                                                                              }
                                                                            })
                                                                          }
                                                                          else {
                                                                            mesloadBox.warningShow();
                                                                          }
                                                                        }
                                                                      })
                                                                    }

                                                                    // 导航栏点击时运行数据加载
                                                                    addTableData(queryStepParticularsUrl, {
                                                                      stepIds:stepList,
                                                                    });

                                                                    break;
                                                                  }
                                                                  case '#devicesOperate': {	//添加设备记录详情
                                                                    let dataContent = $('#submitModelModal4'),
                                                                    panelList = dataContent.find('.panel'),
                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                    panelThead = panelList.find('thead'),
                                                                    panelTbody = panelList.find('tbody'),
                                                                    modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                    headingMainBtn_1 = panelList.find('.head-main-btn-1')

                                                                    panelList.find('.panel-heading').find('.panel-title').text('添加设备操作记录') // 更换panel标题

                                                                    dataContent.modal({
                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                      show: false
                                                                    })

                                                                    dataContent.modal('show') // 运行时显示
                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                      $('body').addClass('modal-open')
                                                                    })

                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                      // 点击弃用按钮隐藏该模态框
                                                                      dataContent.modal('hide')
                                                                      // 初始化表格
                                                                      panelList.find('thead').empty()
                                                                      panelList.find('tbody').empty()
                                                                    })
                                                                    let term= `
                                                                    <tr>
                                                                    <th style="width:4%">序号</th>
                                                                    <th style="width:10%">设备名称</th>
                                                                    <th style="width:10%"> 设备编号</th>
                                                                    <th style="width:13%">开始时间</th>
                                                                    <th style="width:13%">结束时间</th>
                                                                    <th style="width:10%">设备状态</th>
                                                                    <th style="width:8%">操作人</th>
                                                                    <th style="width:14%">操作</th>
                                                                    </tr>
                                                                    `
                                                                    panelThead.empty().append(term)

                                                                    headingMainBtn_1.off('click').on('click', (event) => {
                                                                      let term2 =`
                                                                      <tr>
                                                                        <td ></td>
                                                                        <td class="table-input-td">
                                                                          <input class="table-input deviceName" type="text" placeholder="请选择设备名称" />
                                                                        </td>
                                                                        <td>

                                                                        </td>
                                                                        <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                        <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                        <td class="table-input-td"> <select class="form-control table-input input-sm OperatorType"></select></td>
                                                                        <td class="table-input-td"> <input type="text" class="table-input projectPrincipal" placeholder="请输入" /></td>
                                                                        <td class="table-input-td">
                                                                          <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                          <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                          <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                        </td>
                                                                      </tr>
                                                                      `
                                                                      panelTbody.append(term2)

                                                                      let OperatorType2 = panelTbody.find('.OperatorType')
                                                                     // OperatorType2.append('<option value="">设备状态</option>')
                                                                      for (let i = 0, len = OperatorType.length; i < len; i++) {
                                                                        //设备类型id作为value,名称作为text
                                                                        let optionStr = `<option value="${OperatorType[i]}">${OperatorType[i]}</option>`;
                                                                        OperatorType2.append(optionStr);
                                                                      }

                                                                      panelTbody.find('.deviceName').off('focus').on('focus', function () {
                                                                        let $this = $(this);
                                                                        // 添加设备选择模态框
                                                                        let promise = new Promise(function (resolve, reject) {
                                                                          selectDevicessAddData2(resolve)
                                                                        });
                                                                        promise.then(function (resolveData) {
                                                                          $this.val(resolveData.devicesName)
                                                                          $this.closest('tr').find('td').eq(2).html(resolveData.devicesNumber)
                                                                          $this.attr('devicesID', resolveData.devicesId)

                                                                        })

                                                                        $(this).prop('readonly', true) // 输入框只读
                                                                        $(this).off('blur').on('blur', () => {
                                                                          $(this).removeProp('readonly') // 输入移除框只读
                                                                        })

                                                                      })

                                                                      let tr = panelTbody.find('tr');
                                                                      for(let i = 0;i<tr.length;i++){
                                                                        // panel_table.find('tbody').append(temStr)
                                                                        panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                        ;
                                                                      }

                                                                      panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                        // 添加员工选择模态框
                                                                        let $this = $(this),
                                                                          promise = new Promise(function (resolve, reject) {
                                                                          selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                        });
                                                                        promise.then(function (resolveData) {
                                                                          $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                        })

                                                                        $this.prop('readonly', true) // 输入框只读
                                                                        $this.off('blur').on('blur', () => {
                                                                          $this.removeProp('readonly') // 输入移除框只读
                                                                        })

                                                                      })

                                                                    })

                                                                    headingMainBtn_1.trigger('click')		//默认添加一行


                                                                    panelList.off('click').on('click', 'tr td a', function(event) {
                                                                      let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                      let tr = panelTbody.find('tr');
                                                                      switch (dataContent) {
                                                                        case "delete":{
                                                                          $(this).closest('tr').remove();
                                                                        }
                                                                          break;
                                                                        case "down":{
                                                                          let thisTr=$(this).closest('tr');
                                                                          if(thisTr.index()!=tr.length-1){
                                                                            thisTr.fadeOut().fadeIn();
                                                                            thisTr.next().after(thisTr);
                                                                            }
                                                                        }
                                                                          break;
                                                                        case "up":{
                                                                          let thisTr=$(this).closest('tr');  //
                                                                          if(thisTr.index()!=0){
                                                                            thisTr.fadeOut().fadeIn();
                                                                            thisTr.prev().before(thisTr);
                                                                          }
                                                                        }
                                                                          break;
                                                                      }

                                                                      for(let i = 0;i<tr.length;i++){
                                                                        panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                        ;
                                                                      }
                                                                    });

                                                                    modalSubmitBtn.off("click").on("click",(event)=>{

                                                                      let tr = panelTbody.find('tr')
                                                                      devicesOperationRecords=[]


                                                                      for(let i = 0;i<tr.length;i++){
                                                                        let $td = tr.eq(i).find('td')
                                                                        req={
                                                                          work_order_id:"",
                                                                          craft_control_workstep_id:"",
                                                                          devices_control_devices_id:"",//设备id
                                                                          devices_control_devices_name:"",//设备名称
                                                                          devices_control_devices_number:"",//设备编号
                                                                          devices_operation_start_time:"",//开始时间
                                                                          devices_operation_end_time:"",//结束时间
                                                                          devices_operation_operator:"",//操作人
                                                                          devices_operation_operator_id:"",//操作人id
                                                                          devices_operation_operator_type:""//操作类型
                                                                        }
                                                                        req.craft_control_workstep_id = stepId
                                                                        req.work_order_id = workOrderId
                                                                        for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                          switch (i) {
                                                                            case 0: {

                                                                              break;
                                                                            }
                                                                            case 1: {
                                                                              req.devices_control_devices_id = $td.eq(i).find('input').attr("devicesID");
                                                                              req.devices_control_devices_name = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                              break;
                                                                            }
                                                                            case 2: {
                                                                              req.devices_control_devices_number = $td.eq(i).text();
                                                                              break;
                                                                            }
                                                                            case 3: {
                                                                              req.devices_operation_start_time = $td.eq(i).find('input').val()
                                                                              break;
                                                                            }
                                                                            case 4: {
                                                                              req.devices_operation_end_time = $td.eq(i).find('input').val()
                                                                              break;
                                                                            }
                                                                            case 5: {
                                                                              req.devices_operation_operator_type = $td.eq(i).find('select').val()
                                                                              break;
                                                                            }
                                                                            case 6: {
                                                                              req.devices_operation_operator_id = $td.eq(i).find('input').attr("principal");
                                                                              req.devices_operation_operator = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                              break;
                                                                            }

                                                                          }
                                                                        }
                                                                        devicesOperationRecords.push(req)

                                                                      }
                                                                      let devicesOperationRecords2
                                                                       devicesOperationRecords2= JSON.stringify(devicesOperationRecords);
                                                                      if (true
                                                                      ) {
                                                                        swal({
                                                                          title: '您确定要提交本次操作吗?',
                                                                          text: '请确保填写信息无误后点击确定按钮',
                                                                          type: 'question',
                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                          showCancelButton: true, // 显示用户取消按钮
                                                                          confirmButtonText: '确定',
                                                                          cancelButtonText: '取消',
                                                                        }).then(function () {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: saveWorkOrderDevicesOperationRecordUrl,
                                                                            data: {
                                                                              type:"save",
                                                                              devicesOperationRecords:devicesOperationRecords2
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              if (result.status === 0) {
                                                                                swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                              }else if(result.status !== 0) {
                                                                                let msg = result.msg
                                                                                if(msg!==null){
                                                                                  swallFail2(msg)
                                                                                }else{
                                                                                  swallError();	//格式不正确
                                                                                }

                                                                              }
                                                                            }
                                                                          })
                                                                        });
                                                                      }
                                                                      else {
                                                                        swallError();	//格式不正确
                                                                      }

                                                                    })

                                                                    break;
                                                                  }


                                                                }
                                                              })
                                                              break;
                                                            default:
                                                              break;
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },

                                                  pagination: {
                                                    totalRow: result.map.workstageList[0].stageAndStepRelationList.length, // 总行数
                                                    displayRow: result.map.workstageList[0].stageAndStepRelationList.length // 显示行数
                                                  },

                                                  ajax: {
                                                    url: url,
                                                    data: data
                                                  }
                                                })

                                                //panel3 环境参数
                                                mesVerticalTableAddData(panel_3, {
                                                  thead: {
                                                    theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                    theadWidth: '4%/15%/15%/15%/15%/15%'
                                                  },
                                                  tbody: {
                                                    html: [
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td></td>',
                                                      '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#addParm"><i class="fa fa-tasks fa-fw"></i>添加参数详情</a></td>'
                                                    ],

                                                    // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                    dataAddress: function (tbodyTarget, html, result) {
                                                      tbodyTarget.empty() // 清空表格主体
                                                      let dataList =  EnvirParamersList,//环境参数集合,
                                                        tempData = null; // 表格td内的临时数据
                                                      for (let i = 0, len = dataList.length; i < len; i++) {
                                                        tbodyTarget.append('<tr></tr>'); // 添加行
                                                        let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                        for (let i = 0, len = html.length; i < len; i++) {
                                                          currentTr.append(html[i]); // 添加表格内的HTML
                                                          switch (i) {
                                                            case 0:
                                                              currentTr.children().eq(i).html(currentTr.index() + 1)
                                                              break;
                                                            case 1: {
                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                              // tempData=
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;
                                                            case 2: {
                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                              if(tempData = "constantValue"){
                                                                currentTr.children().eq(i).html( "固定值")
                                                              }else if(tempData = "rangeValue"){
                                                                currentTr.children().eq(i).html("范围值")
                                                              }else if(tempData = "deviationValue"){
                                                                currentTr.children().eq(i).html("浮动值")
                                                              }
                                                            }
                                                              break;
                                                            case 3: {
                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                             let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                             let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                             let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                             let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                              if(tempData == "constantValue"){
                                                                currentTr.children().eq(i).html(constantValue)
                                                              }else if(tempData == "rangeValue"){
                                                                currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                              }else if(tempData == "deviationValue"){
                                                                currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                              }
                                                            }
                                                              break;
                                                            case 4: {
                                                              tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                              currentTr.children().eq(i).html(tempData)
                                                            }
                                                              break;

                                                            case 5:
                                                              currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                workstageId = dataList[currentTr.index()].workstage_id,
                                                                parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type
                                                                switch (dataContent) {
                                                                  case '#addParm': {	//添加
                                                                    let dataContent = $('#submitModelModal4'),
                                                                    panelList = dataContent.find('.panel'),
                                                                    modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                    panelThead = panelList.find('thead'),
                                                                    panelTbody = panelList.find('tbody'),
                                                                    modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                    headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                    panelList.find('.panel-heading').find('.panel-title').text('添加参数记录') // 更换panel标题

                                                                    dataContent.modal({
                                                                      backdrop: false, // 黑色遮罩不可点击
                                                                      keyboard: false,  // esc按键不可弃用模态框
                                                                      show: false
                                                                    })

                                                                    dataContent.modal('show') // 运行时显示
                                                                    dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                      $('body').addClass('modal-open')
                                                                    })

                                                                    modalCloseBtn.off('click').on('click', (event) => {
                                                                      // 点击弃用按钮隐藏该模态框
                                                                      dataContent.modal('hide')
                                                                      // 初始化表格
                                                                      panelList.find('thead').empty()
                                                                      panelList.find('tbody').empty()
                                                                    })
                                                                    let term= `
                                                                      <tr>
                                                                      <th style="width:2%">序号</th>
                                                                      <th style="width:4%">参数值</th>
                                                                      <th style="width:5%">记录人</th>
                                                                      <th style="width:7%">记录时间</th>
                                                                      <th style="width:8%">备注</th>
                                                                      <th style="width:8%">操作</th>
                                                                      </tr>
                                                                      `
                                                                    panelThead.empty().append(term)

                                                                    headingMainBtn_1.off('click').on('click', (event) => {
                                                                      let term2 =`
                                                                        <tr>
                                                                          <td ></td>
                                                                          <td class="table-input-td">
                                                                            <input class="table-input" type="text" placeholder="请输入" />
                                                                          </td>
                                                                          <td class="table-input-td">
                                                                            <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                          </td>
                                                                          <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                          <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                          <td class="table-input-td">
                                                                            <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                            <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                            <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                          </td>
                                                                        </tr>
                                                                        `
                                                                      panelTbody.append(term2)

                                                                      let tr = panelTbody.find('tr');
                                                                      for(let i = 0;i<tr.length;i++){
                                                                        // panel_table.find('tbody').append(temStr)
                                                                        panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                        ;
                                                                      }

                                                                      panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                        // 添加员工选择模态框
                                                                        let $this = $(this),
                                                                          promise = new Promise(function (resolve, reject) {
                                                                          selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                        });
                                                                        promise.then(function (resolveData) {
                                                                          $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                          // submithData.creator = resolveData.roleStaffId
                                                                        })

                                                                        $this.prop('readonly', true) // 输入框只读
                                                                        $this.off('blur').on('blur', () => {
                                                                          $this.removeProp('readonly') // 输入移除框只读
                                                                        })

                                                                      })

                                                                    })

                                                                    headingMainBtn_1.trigger('click')		//默认添加一行


                                                                    panelList.off('click').on('click', 'tr td a', function(event) {
                                                                      let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                      let tr = panelTbody.find('tr');
                                                                      switch (dataContent) {
                                                                        case "delete":{
                                                                          $(this).closest('tr').remove();
                                                                        }
                                                                          break;
                                                                        case "down":{
                                                                          let thisTr=$(this).closest('tr');
                                                                          if(thisTr.index()!=tr.length-1){
                                                                            thisTr.fadeOut().fadeIn();
                                                                            thisTr.next().after(thisTr);
                                                                            }
                                                                        }
                                                                          break;
                                                                        case "up":{
                                                                          let thisTr=$(this).closest('tr');  //
                                                                          if(thisTr.index()!=0){
                                                                            thisTr.fadeOut().fadeIn();
                                                                            thisTr.prev().before(thisTr);
                                                                          }
                                                                        }
                                                                          break;
                                                                      }

                                                                      for(let i = 0;i<tr.length;i++){
                                                                        panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                        ;
                                                                      }
                                                                    });

                                                                    modalSubmitBtn.off("click").on("click",(event)=>{
                                                                      let tr = panelTbody.find('tr'),
                                                                          parameteRecords=[]

                                                                      for(let i = 0;i<tr.length;i++){
                                                                        let $td = tr.eq(i).find('td'),
                                                                        req={
                                                                          craft_workstep_parameter_main_id:"",//参数id
                                                                          craft_workstep_parameter_id:"",//参数id
                                                                          standard_parameter_type_id:"",//参数lx id
                                                                          workstage_id:"",//工序id
                                                                          work_order_id:"",//工序id
                                                                          parameter_record_steady_state_value:"",//参数记录值
                                                                          parameter_record_write_time:"",//记录时间
                                                                          parameter_record_note_taker:"",//记录人
                                                                          parameter_record_note_taker_id:"",//记录id
                                                                          parameter_record_describe:"",//描述
                                                                          parameter_record_value_type:"",//描述
                                                                        }
                                                                        req.craft_workstep_parameter_main_id = parameteRecordId
                                                                        req.workstage_id = workstageId
                                                                        req.standard_parameter_type_id = parametertypeId
                                                                        req.work_order_id = workOrderId
                                                                        req.parameter_record_value_type = ParameteValueType

                                                                        for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                          switch (i) {
                                                                            case 0: {

                                                                              break;
                                                                            }
                                                                            case 1: {
                                                                              req.parameter_record_steady_state_value = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                              break;
                                                                            }
                                                                            case 2: {
                                                                              req.parameter_record_note_taker_id = $td.eq(i).find('input').attr("principal");
                                                                              req.parameter_record_note_taker = $td.eq(i).find('input').val().replace(/\s/g, "");


                                                                              break;
                                                                            }
                                                                            case 3: {

                                                                              req.parameter_record_write_time = $td.eq(i).find('input').val()
                                                                              break;
                                                                            }
                                                                            case 4: {
                                                                              req.parameter_record_describe = $td.eq(i).find('input').val().replace(/\s/g, "");

                                                                              break;
                                                                            }

                                                                          }
                                                                        }
                                                                        parameteRecords.push(req)

                                                                      }
                                                                      let parameteRecords2
                                                                      parameteRecords2= JSON.stringify(parameteRecords);
                                                                      if (true
                                                                      ) {
                                                                        swal({
                                                                          title: '您确定要提交本次操作吗?',
                                                                          text: '请确保填写信息无误后点击确定按钮',
                                                                          type: 'question',
                                                                          allowEscapeKey: false, // 用户按esc键不退出
                                                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                          showCancelButton: true, // 显示用户取消按钮
                                                                          confirmButtonText: '确定',
                                                                          cancelButtonText: '取消',
                                                                        }).then(function () {
                                                                          $.ajax({
                                                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                            url: saveWorkOrderParameteRecordUrl,
                                                                            data: {
                                                                              type:"save",
                                                                              parameteRecords:parameteRecords2
                                                                            },
                                                                            success: function (result, status, xhr) {
                                                                              if (result.status === 0) {
                                                                                swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                              }else if(result.status !== 0) {
                                                                                let msg = result.msg
                                                                                if(msg!==null){
                                                                                  swallFail2(msg)
                                                                                }else{
                                                                                  swallError();	//格式不正确
                                                                                }

                                                                              }
                                                                            }
                                                                          })
                                                                        });
                                                                      }
                                                                      else {
                                                                        swallError();	//格式不正确
                                                                      }

                                                                    })


                                                                    break;
                                                                  }


                                                                }
                                                              })
                                                              break;
                                                            default:
                                                              break;
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },

                                                  pagination: {
                                                    totalRow:EnvirParamersList.length ,//环境参数集合,
                                                    displayRow: EnvirParamersList.length // 显示行数
                                                  },

                                                  ajax: {
                                                    url: url,
                                                    data: data
                                                  }
                                                })

                                                //panel3  半成品参数
                                                if(semiProParamersList.length!==0){
                                                  mesVerticalTableAddData(panel_4, {
                                                    thead: {
                                                      theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                      theadWidth: '4%/15%/15%/15%/15%/15%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#addParm"><i class="fa fa-tasks fa-fw"></i>添加参数详情</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let  dataList = semiProParamersList, // 主要数据列表
                                                        tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                               currentTr.children().eq(i).html(currentTr.index() + 1)
                                                               break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                // tempData=
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                if(tempData = "constantValue"){
                                                                  currentTr.children().eq(i).html( "固定值")
                                                                }else if(tempData = "rangeValue"){
                                                                  currentTr.children().eq(i).html("范围值")
                                                                }else if(tempData = "deviationValue"){
                                                                  currentTr.children().eq(i).html("浮动值")
                                                                }
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                              let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                              let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                              let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                              let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                if(tempData == "constantValue"){
                                                                  currentTr.children().eq(i).html(constantValue)
                                                                }else if(tempData == "rangeValue"){
                                                                  currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                }else if(tempData == "deviationValue"){
                                                                  currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                }
                                                              }
                                                                break;
                                                              case 4: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                  workstageId = dataList[currentTr.index()].workstage_id,
                                                                 parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                 ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type

                                                                  switch (dataContent) {
                                                                    case '#addParm': {	//
                                                                      let dataContent = $('#submitModelModal4'),
                                                                      panelList = dataContent.find('.panel'),
                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                      panelThead = panelList.find('thead'),
                                                                      panelTbody = panelList.find('tbody'),
                                                                      modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                      headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                      panelList.find('.panel-heading').find('.panel-title').text('添加参数记录') // 更换panel标题

                                                                      dataContent.modal({
                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                        show: false
                                                                      })

                                                                      dataContent.modal('show') // 运行时显示
                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                        $('body').addClass('modal-open')
                                                                      })

                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                        // 点击弃用按钮隐藏该模态框
                                                                        dataContent.modal('hide')
                                                                        // 初始化表格
                                                                        panelList.find('thead').empty()
                                                                        panelList.find('tbody').empty()
                                                                      })
                                                                      let term= `
                                                                        <tr>
                                                                        <th style="width:2%">序号</th>
                                                                        <th style="width:4%">参数值</th>
                                                                        <th style="width:5%">记录人</th>
                                                                        <th style="width:7%">记录时间</th>
                                                                        <th style="width:8%">备注</th>
                                                                        <th style="width:8%">操作</th>
                                                                        </tr>
                                                                        `
                                                                      panelThead.empty().append(term)

                                                                      headingMainBtn_1.off('click').on('click', (event) => {
                                                                        let term2 =`
                                                                          <tr>
                                                                            <td ></td>
                                                                            <td class="table-input-td">
                                                                              <input class="table-input" type="text" placeholder="请输入" />
                                                                            </td>
                                                                            <td class="table-input-td">
                                                                              <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                            </td>
                                                                            <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                            <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                            <td class="table-input-td">
                                                                              <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                              <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                              <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                            </td>
                                                                          </tr>
                                                                          `
                                                                        panelTbody.append(term2)

                                                                        let tr = panelTbody.find('tr');
                                                                        for(let i = 0;i<tr.length;i++){
                                                                          // panel_table.find('tbody').append(temStr)
                                                                          panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                          ;
                                                                        }

                                                                        panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                          // 添加员工选择模态框
                                                                          let $this = $(this),
                                                                            promise = new Promise(function (resolve, reject) {
                                                                            selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                          });
                                                                          promise.then(function (resolveData) {
                                                                            $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                            // submithData.creator = resolveData.roleStaffId
                                                                          })

                                                                          $this.prop('readonly', true) // 输入框只读
                                                                          $this.off('blur').on('blur', () => {
                                                                            $this.removeProp('readonly') // 输入移除框只读
                                                                          })

                                                                        })

                                                                      })

                                                                      headingMainBtn_1.trigger('click')		//默认添加一行


                                                                      panelList.off('click').on('click', 'tr td a', function(event) {
                                                                        let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                        let tr = panelTbody.find('tr');
                                                                        switch (dataContent) {
                                                                          case "delete":{
                                                                            $(this).closest('tr').remove();
                                                                          }
                                                                            break;
                                                                          case "down":{
                                                                            let thisTr=$(this).closest('tr');
                                                                            if(thisTr.index()!=tr.length-1){
                                                                              thisTr.fadeOut().fadeIn();
                                                                              thisTr.next().after(thisTr);
                                                                              }
                                                                          }
                                                                            break;
                                                                          case "up":{
                                                                            let thisTr=$(this).closest('tr');  //
                                                                            if(thisTr.index()!=0){
                                                                              thisTr.fadeOut().fadeIn();
                                                                              thisTr.prev().before(thisTr);
                                                                            }
                                                                          }
                                                                            break;
                                                                        }

                                                                        for(let i = 0;i<tr.length;i++){
                                                                          panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                          ;
                                                                        }
                                                                      });

                                                                      modalSubmitBtn.off("click").on("click",(event)=>{
                                                                        let tr = panelTbody.find('tr'),
                                                                            parameteRecords=[]

                                                                        for(let i = 0;i<tr.length;i++){
                                                                          let $td = tr.eq(i).find('td'),
                                                                          req={
                                                                            craft_workstep_parameter_main_id:"",//参数id
                                                                            craft_workstep_parameter_id:"",//参数id
                                                                            standard_parameter_type_id:"",//参数lx id
                                                                            workstage_id:"",//工序id
                                                                            work_order_id:"",//工序id
                                                                            parameter_record_steady_state_value:"",//参数记录值
                                                                            parameter_record_write_time:"",//记录时间
                                                                            parameter_record_note_taker:"",//记录人
                                                                            parameter_record_note_taker_id:"",//记录id
                                                                            parameter_record_describe:"",//描述
                                                                            parameter_record_value_type:"",//描述
                                                                          }
                                                                          req.craft_workstep_parameter_main_id = parameteRecordId
                                                                          req.workstage_id = workstageId
                                                                          req.standard_parameter_type_id = parametertypeId
                                                                          req.work_order_id = workOrderId
                                                                          req.parameter_record_value_type = ParameteValueType

                                                                          for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                            switch (i) {
                                                                              case 0: {

                                                                                break;
                                                                              }
                                                                              case 1: {
                                                                                req.parameter_record_steady_state_value = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                break;
                                                                              }
                                                                              case 2: {
                                                                                req.parameter_record_note_taker_id = $td.eq(i).find('input').attr("principal");
                                                                                req.parameter_record_note_taker = $td.eq(i).find('input').val().replace(/\s/g, "");


                                                                                break;
                                                                              }
                                                                              case 3: {

                                                                                req.parameter_record_write_time = $td.eq(i).find('input').val()
                                                                                break;
                                                                              }
                                                                              case 4: {
                                                                                req.parameter_record_describe = $td.eq(i).find('input').val().replace(/\s/g, "");

                                                                                break;
                                                                              }

                                                                            }
                                                                          }
                                                                          parameteRecords.push(req)

                                                                        }
                                                                        let parameteRecords2
                                                                          parameteRecords2= JSON.stringify(parameteRecords);
                                                                        if (true
                                                                        ) {
                                                                          swal({
                                                                            title: '您确定要提交本次操作吗?',
                                                                            text: '请确保填写信息无误后点击确定按钮',
                                                                            type: 'question',
                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                            showCancelButton: true, // 显示用户取消按钮
                                                                            confirmButtonText: '确定',
                                                                            cancelButtonText: '取消',
                                                                          }).then(function () {
                                                                            $.ajax({
                                                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                              url: saveWorkOrderParameteRecordUrl,
                                                                              data: {
                                                                                type:"save",
                                                                                parameteRecords:parameteRecords2
                                                                              },
                                                                              success: function (result, status, xhr) {
                                                                                if (result.status === 0) {
                                                                                  swallSuccess()	//操作成功提示并刷新页面
                                                                                }else if(result.status !== 0) {
                                                                                  let msg = result.msg
                                                                                  if(msg!==null){
                                                                                    swallFail2(msg)
                                                                                  }else{
                                                                                    swallError();	//格式不正确
                                                                                  }

                                                                                }
                                                                              }
                                                                            })
                                                                          });
                                                                        }
                                                                        else {
                                                                          swallError();	//格式不正确
                                                                        }

                                                                      })


                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow:semiProParamersList.length , // 总行数
                                                      displayRow:semiProParamersList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })
                                                }else{
                                                  panel_4.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                }

                                                 //panel3  其他
                                                if(otherParamersList.length!==0){
                                                  mesVerticalTableAddData(panel_5, {
                                                    thead: {
                                                      theadContent: '序号/参数名称/值类型/参考值/单位/操作',
                                                      theadWidth: '4%/15%/15%/15%/15%/15%'
                                                    },
                                                    tbody: {
                                                      html: [
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td></td>',
                                                        '<td class="table-input-td"><a class="table-link" href="javascript:;" data-toggle-modal-target="#addParm"><i class="fa fa-tasks fa-fw"></i>添加参数详情</a></td>'
                                                      ],

                                                      // 添加表格主体数据, 这是一个回调函数,这里不需要传参
                                                      dataAddress: function (tbodyTarget, html, result) {
                                                        tbodyTarget.empty() // 清空表格主体
                                                        let dataList = otherParamersList, // 主要数据列表
                                                        tempData = null; // 表格td内的临时数据
                                                        for (let i = 0, len = dataList.length; i < len; i++) {
                                                          tbodyTarget.append('<tr></tr>'); // 添加行
                                                          let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                                                          for (let i = 0, len = html.length; i < len; i++) {
                                                            currentTr.append(html[i]); // 添加表格内的HTML
                                                            switch (i) {
                                                              case 0:
                                                                currentTr.children().eq(i).html(currentTr.index() + 1)
                                                                break;
                                                              case 1: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_name;
                                                                // tempData=
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;
                                                              case 2: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                if(tempData = "constantValue"){
                                                                  currentTr.children().eq(i).html( "固定值")
                                                                }else if(tempData = "rangeValue"){
                                                                  currentTr.children().eq(i).html("范围值")
                                                                }else if(tempData = "deviationValue"){
                                                                  currentTr.children().eq(i).html("浮动值")
                                                                }
                                                              }
                                                                break;
                                                              case 3: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_value_type;
                                                                let  constantValue = dataList[currentTr.index()].workstage_use_parameter_constant_value;
                                                                let  minValue = dataList[currentTr.index()].workstage_use_parameter_minimum_value;
                                                                let  maxValue = dataList[currentTr.index()].workstage_use_parameter_max_value;
                                                                let  errorValue = dataList[currentTr.index()].workstage_use_parameter_error_value;
                                                                  if(tempData == "constantValue"){
                                                                    currentTr.children().eq(i).html(constantValue)
                                                                  }else if(tempData == "rangeValue"){
                                                                    currentTr.children().eq(i).html(minValue+"~"+maxValue)
                                                                  }else if(tempData == "deviationValue"){
                                                                    currentTr.children().eq(i).html(constantValue+"±"+errorValue)
                                                                  }
                                                              }
                                                                break;
                                                              case 4: {
                                                                tempData = dataList[currentTr.index()].workstage_use_parameter_unit;
                                                                currentTr.children().eq(i).html(tempData)
                                                              }
                                                                break;

                                                              case 5:
                                                                currentTr.children().eq(i).off('click').on('click', 'a', (event) => {
                                                                  let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn, // 按钮自带的data数据
                                                                  parameteRecordId = dataList[currentTr.index()].workstage_use_parameter_main_id,
                                                                workstageId = dataList[currentTr.index()].workstage_id,
                                                                parametertypeId = dataList[currentTr.index()].standard_parameter_type_id,
                                                                ParameteValueType = dataList[currentTr.index()].workstage_use_parameter_value_type

                                                                  switch (dataContent) {
                                                                    case '#addParm': {	//
                                                                      let dataContent = $('#submitModelModal4'),
                                                                      panelList = dataContent.find('.panel'),
                                                                      modalCloseBtn = dataContent.find('.modal-header').find('.close'),
                                                                      panelThead = panelList.find('thead'),
                                                                      panelTbody = panelList.find('tbody'),
                                                                      modalSubmitBtn = dataContent.find('.modal-submit'), // 提交按钮
                                                                      headingMainBtn_1 = panelList.find('.head-main-btn-1')
                                                                      panelList.find('.panel-heading').find('.panel-title').text('添加参数记录') // 更换panel标题

                                                                      dataContent.modal({
                                                                        backdrop: false, // 黑色遮罩不可点击
                                                                        keyboard: false,  // esc按键不可弃用模态框
                                                                        show: false
                                                                      })

                                                                      dataContent.modal('show') // 运行时显示
                                                                      dataContent.off('hidden.bs.modal').on('hidden.bs.modal', function () {
                                                                        $('body').addClass('modal-open')
                                                                      })

                                                                      modalCloseBtn.off('click').on('click', (event) => {
                                                                        // 点击弃用按钮隐藏该模态框
                                                                        dataContent.modal('hide')
                                                                        // 初始化表格
                                                                        panelList.find('thead').empty()
                                                                        panelList.find('tbody').empty()
                                                                      })
                                                                      let term= `
                                                                        <tr>
                                                                        <th style="width:2%">序号</th>
                                                                        <th style="width:4%">参数值</th>
                                                                        <th style="width:5%">记录人</th>
                                                                        <th style="width:7%">记录时间</th>
                                                                        <th style="width:8%">备注</th>
                                                                        <th style="width:8%">操作</th>
                                                                        </tr>
                                                                        `
                                                                      panelThead.empty().append(term)

                                                                      headingMainBtn_1.off('click').on('click', (event) => {
                                                                        let term2 =`
                                                                          <tr>
                                                                            <td ></td>
                                                                            <td class="table-input-td">
                                                                              <input class="table-input" type="text" placeholder="请输入" />
                                                                            </td>
                                                                            <td class="table-input-td">
                                                                              <input type="text" class="table-input projectPrincipal" placeholder="请输入" />
                                                                            </td>
                                                                            <td class="table-input-td"><input type="text" class="table-input" placeholder="点此选择时间" onClick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"/></td>
                                                                            <td class="table-input-td"><input class="table-input" type="text" placeholder="请输入" /></td>
                                                                            <td class="table-input-td">
                                                                              <a class="table-link " href="javascript:;" data-toggle-btn="up"><i class="fa fa-arrow-up"></i>上移</a>
                                                                              <a class="table-link " href="javascript:;" data-toggle-btn="down""><i class="fa fa-arrow-down"></i>下移</a>
                                                                              <a class="table-link text-danger" href="javascript:;" data-toggle-btn="delete"><i class="fa fa-bank"></i>删除</a>
                                                                            </td>
                                                                          </tr>
                                                                          `
                                                                        panelTbody.append(term2)

                                                                        let tr = panelTbody.find('tr');
                                                                        for(let i = 0;i<tr.length;i++){
                                                                          // panel_table.find('tbody').append(temStr)
                                                                          panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                          ;
                                                                        }

                                                                        panelTbody.find('.projectPrincipal').off('focus').on('focus', function () {
                                                                          // 添加员工选择模态框
                                                                          let $this = $(this),
                                                                            promise = new Promise(function (resolve, reject) {
                                                                            selectStaffAddData2(resolve, queryStaffUrl, { headNum: 1 })
                                                                          });
                                                                          promise.then(function (resolveData) {
                                                                            $this.val(resolveData.roleStaffName).attr('principal', resolveData.roleStaffId)
                                                                            // submithData.creator = resolveData.roleStaffId
                                                                          })

                                                                          $this.prop('readonly', true) // 输入框只读
                                                                          $this.off('blur').on('blur', () => {
                                                                            $this.removeProp('readonly') // 输入移除框只读
                                                                          })

                                                                        })

                                                                      })

                                                                      headingMainBtn_1.trigger('click')		//默认添加一行


                                                                      panelList.off('click').on('click', 'tr td a', function(event) {
                                                                        let dataContent = event.currentTarget.dataset.toggleModalTarget || event.currentTarget.dataset.toggleBtn;// 按钮自带的data数据
                                                                        let tr = panelTbody.find('tr');
                                                                        switch (dataContent) {
                                                                          case "delete":{
                                                                            $(this).closest('tr').remove();
                                                                          }
                                                                            break;
                                                                          case "down":{
                                                                            let thisTr=$(this).closest('tr');
                                                                            if(thisTr.index()!=tr.length-1){
                                                                              thisTr.fadeOut().fadeIn();
                                                                              thisTr.next().after(thisTr);
                                                                              }
                                                                          }
                                                                            break;
                                                                          case "up":{
                                                                            let thisTr=$(this).closest('tr');  //
                                                                            if(thisTr.index()!=0){
                                                                              thisTr.fadeOut().fadeIn();
                                                                              thisTr.prev().before(thisTr);
                                                                            }
                                                                          }
                                                                            break;
                                                                        }

                                                                        for(let i = 0;i<tr.length;i++){
                                                                          panelTbody.find('tr:eq('+i+') td:first').text(i+1);
                                                                          ;
                                                                        }
                                                                      });

                                                                      modalSubmitBtn.off("click").on("click",(event)=>{
                                                                        let tr = panelTbody.find('tr'),
                                                                            parameteRecords=[]

                                                                        for(let i = 0;i<tr.length;i++){
                                                                          let $td = tr.eq(i).find('td'),
                                                                          req={
                                                                            craft_workstep_parameter_main_id:"",//参数id
                                                                            craft_workstep_parameter_id:"",//参数id
                                                                            standard_parameter_type_id:"",//参数lx id
                                                                            workstage_id:"",//工序id
                                                                            work_order_id:"",//工序id
                                                                            parameter_record_steady_state_value:"",//参数记录值
                                                                            parameter_record_write_time:"",//记录时间
                                                                            parameter_record_note_taker:"",//记录人
                                                                            parameter_record_note_taker_id:"",//记录id
                                                                            parameter_record_describe:"",//描述
                                                                            parameter_record_value_type:"",//描述
                                                                          }
                                                                          req.craft_workstep_parameter_main_id = parameteRecordId
                                                                          req.workstage_id = workstageId
                                                                          req.standard_parameter_type_id = parametertypeId
                                                                          req.work_order_id = workOrderId
                                                                          req.parameter_record_value_type = ParameteValueType

                                                                          for (let i = 0, len = $td.length - 1; i < len; i++) {	//遍历列
                                                                            switch (i) {
                                                                              case 0: {

                                                                                break;
                                                                              }
                                                                              case 1: {
                                                                                req.parameter_record_steady_state_value = $td.eq(i).find('input').val().replace(/\s/g, "");
                                                                                break;
                                                                              }
                                                                              case 2: {
                                                                                req.parameter_record_note_taker_id = $td.eq(i).find('input').attr("principal");
                                                                                req.parameter_record_note_taker = $td.eq(i).find('input').val().replace(/\s/g, "");


                                                                                break;
                                                                              }
                                                                              case 3: {

                                                                                req.parameter_record_write_time = $td.eq(i).find('input').val()
                                                                                break;
                                                                              }
                                                                              case 4: {
                                                                                req.parameter_record_describe = $td.eq(i).find('input').val().replace(/\s/g, "");

                                                                                break;
                                                                              }

                                                                            }
                                                                          }
                                                                          parameteRecords.push(req)
                                                                          console.log(parameteRecords)

                                                                        }
                                                                        let parameteRecords2
                                                                        parameteRecords2= JSON.stringify(parameteRecords);
                                                                        if (true
                                                                        ) {
                                                                          swal({
                                                                            title: '您确定要提交本次操作吗?',
                                                                            text: '请确保填写信息无误后点击确定按钮',
                                                                            type: 'question',
                                                                            allowEscapeKey: false, // 用户按esc键不退出
                                                                            allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                                                            showCancelButton: true, // 显示用户取消按钮
                                                                            confirmButtonText: '确定',
                                                                            cancelButtonText: '取消',
                                                                          }).then(function () {
                                                                            $.ajax({
                                                                               type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                                                              url: saveWorkOrderParameteRecordUrl,
                                                                              data: {
                                                                                type:"save",
                                                                                parameteRecords:parameteRecords2
                                                                              },
                                                                              success: function (result, status, xhr) {
                                                                                if (result.status === 0) {
                                                                                  swallSuccess(modalCloseBtn)	//操作成功提示并刷新页面
                                                                                }else if(result.status !== 0) {
                                                                                  let msg = result.msg
                                                                                  if(msg!==null){
                                                                                    swallFail2(msg)
                                                                                  }else{
                                                                                    swallError();	//格式不正确
                                                                                  }

                                                                                }
                                                                              }
                                                                            })
                                                                          });
                                                                        }
                                                                        else {
                                                                          swallError();	//格式不正确
                                                                        }

                                                                      })


                                                                      break;
                                                                    }


                                                                  }
                                                                })
                                                                break;
                                                              default:
                                                                break;
                                                            }
                                                          }
                                                        }
                                                      }
                                                    },

                                                    pagination: {
                                                      totalRow: otherParamersList.length, // 总行数
                                                      displayRow: otherParamersList.length // 显示行数
                                                    },

                                                    ajax: {
                                                      url: url,
                                                      data: data
                                                    }
                                                  })
                                                }else{
                                                  panel_5.find("table tbody").empty().append(NO_DATA_NOTICE)
                                                }


                                              }
                                              else {
                                                mesloadBox.warningShow();
                                              }
                                            }
                                          })
                                        }


                                        addTableData(queryWorkOrderParticularsUrl, {
                                          workOrderId:workOrderId
                                        });
                                        addTableData2(queryWorkstageParticularsUrl, {
                                          workstageIds:workstageId
                                        });

                                        break;
                                      }
                                      case "#over":{//
                                        let wordList = []
                                        wordList.push(workOrderId)
                                        swal({
                                          title: '您确定工单生产完成?',
                                          text: '完成后生产数据不可修改',
                                          type: 'question',
                                          allowEscapeKey: false, // 用户按esc键不退出
                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                          showCancelButton: true, // 显示用户取消按钮
                                          confirmButtonText: '确定',
                                          cancelButtonText: '取消',
                                        }).then(function () {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: modifyWorkOrderProductionStatusUrl,
                                            data:{
                                              type:"complete",
                                              userId:USERID,
                                              workOrderIds:wordList
                                            },
                                            success: function (result, status, xhr) {
                                              if (result.status === 0) {
                                                let activePaginationBtn = activeSwiper.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                              }else {
                                                swallFail2(result.msg);	//操作失败
                                              }
                                            },

                                          })
                                        });
                                        break;
                                      }
                                      case "#start":{//
                                        let wordList = []
                                        wordList.push(workOrderId)
                                        swal({
                                          title: '您确定工单生产完成?',
                                          text: '完成后生产数据不可修改',
                                          type: 'question',
                                          allowEscapeKey: false, // 用户按esc键不退出
                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                          showCancelButton: true, // 显示用户取消按钮
                                          confirmButtonText: '确定',
                                          cancelButtonText: '取消',
                                        }).then(function () {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: modifyWorkOrderProductionStatusUrl,
                                            data:{
                                              type:"inProduction",
                                              userId:USERID,
                                              workOrderIds:wordList
                                            },
                                            success: function (result, status, xhr) {
                                              if (result.status === 0) {
                                                let activePaginationBtn = activeSwiper.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                              }else {
                                                swallFail2(result.msg);	//操作失败
                                              }
                                            },

                                          })
                                        });
                                        break;
                                      }
                                      case "#pause":{//
                                        let wordList = []
                                        wordList.push(workOrderId)
                                        swal({
                                          title: '您确定工单生产完成?',
                                          text: '完成后生产数据不可修改',
                                          type: 'question',
                                          allowEscapeKey: false, // 用户按esc键不退出
                                          allowOutsideClick: false, // 用户点击弹窗外部不关闭弹窗。
                                          showCancelButton: true, // 显示用户取消按钮
                                          confirmButtonText: '确定',
                                          cancelButtonText: '取消',
                                        }).then(function () {
                                          $.ajax({
                                             type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
                                            url: modifyWorkOrderProductionStatusUrl,
                                            data:{
                                              type:"pause",
                                              userId:USERID,
                                              workOrderIds:wordList
                                            },
                                            success: function (result, status, xhr) {
                                              if (result.status === 0) {
                                                let activePaginationBtn = activeSwiper.find('.panel-footer').find('.pagination').find('.pagesBtn ').filter('.active')
                                                swallSuccess(activePaginationBtn)	//操作成功提示并刷新页面
                                              }else {
                                                swallFail2(result.msg);	//操作失败
                                              }
                                            },

                                          })
                                        });
                                        break;
                                      }

                                    }
                                  })
                                  break;
                                default:
                                  break;
                              }
                            }
                          }
                        }
                      },

                      pagination: {
                        totalRow: result.map.line, // 总行数
                        displayRow: result.map.workOrders.length // 显示行数
                      },

                      ajax: {
                        url: url,
                        data: data
                      }
                    })
                  }
                  else {
                    panelTbody.empty().append(NO_DATA_NOTICE)
                    paginationContainer.hide()	//隐藏分页按钮
                    mesloadBox.warningShow();
                  }
                }
              })
            }

            // 导航栏点击时运行数据加载
            addTableData(queryWorkOrderOutlineUrl, {
							type: 'vague',
							userId:USERID,
							headNum: 1
						});

            // 模糊搜索组加载数据
            fuzzySearchGroup.find('.btn').off('click').on('click', function (event) {
              let keyword = $(this).closest('.input-group').find('input').val()
              let status =statusTypeOption.val()
              let workStageID =workStageOption.val()
              let productionWorkshopID = productionWorkshopOption.val()
              // status=staffTypeOption.val()
              event.stopPropagation() // 禁止向上冒泡
              addTableData(queryWorkOrderOutlineUrl, {
                type: 'vague',
                workshopId:productionWorkshopID,
                workstageId:workStageID,
                keyword:keyword,
                workOrderProductionStatus:status,
                userId:USERID,
                headNum:1
              });
            });
            // 工序集合下拉选事件
            workStageOption.off('change').on('change',function(){
              let workStageID = $(this).val()
              let status =statusTypeOption.val()
              let productionWorkshopID = productionWorkshopOption.val()
              let keyword = fuzzySearchGroup.closest('.input-group').find('input').val()
              addTableData(queryWorkOrderOutlineUrl, {
                type: 'vague',
                workshopId:productionWorkshopID,
                workstageId:workStageID,
                keyword:keyword,
                workOrderProductionStatus:status,
                userId:USERID,
                headNum:1
              });
            });
            // 车间集合下拉选事件
            productionWorkshopOption.off('change').on('change',function(){
              let status =statusTypeOption.val()
              let workStageID =workStageOption.val()
              let productionWorkshopID = $(this).val()
              let keyword = fuzzySearchGroup.closest('.input-group').find('input').val()
              addTableData(queryWorkOrderOutlineUrl, {
                type: 'vague',
                workshopId:productionWorkshopID,
                workstageId:workStageID,
                keyword:keyword,
                workOrderProductionStatus:status,
                userId:USERID,
                headNum:1
                });
            });
            // 状态下拉选事件
            statusTypeOption.off('change').on('change',function(){
              let status = $(this).val()
              let workStageID =workStageOption.val()
              let productionWorkshopID = productionWorkshopOption.val()
              let keyword = fuzzySearchGroup.closest('.input-group').find('input').val()
              addTableData(queryWorkOrderOutlineUrl, {
                type: 'vague',
                workshopId:productionWorkshopID,
                workstageId:workStageID,
                keyword:keyword,
                workOrderProductionStatus:status,
                userId:USERID,
                headNum:1
                });
            });

      }())
				break;
		}
	})
  leftNavLink.eq(0).trigger('click');


	/**
 * @description :员工选择模态框（单选),第1层弹窗调用
 *@param resolve: Promise回调函数
 *@param url: 请求路径
 *@param data: 请求参数
 */
function selectStaffAddData(resolve, url, data) {
	let selectStaffModal = $('#publicSelectModalBox'), // 模态框
		staffListPanel = selectStaffModal.find('.panel'), // 面板
		targetTable = staffListPanel.find('table'),
		// panelTbody = staffListPanel.find('tbody'),	//面版表格tbody
		paginationContainer = staffListPanel.find('.pagination'),		// 分页ul标签
		selectDepartment = staffListPanel.find('.pullDownMenu-1'), // 选择下拉菜单
		fuzzySearchGroup = staffListPanel.find('.fuzzy-search-group'), // 模糊搜索菜单
		modalCloseBtn = selectStaffModal.find('.modal-header').find('.close'),
		modalTitle = selectStaffModal.find('.modal-title'),
		mesloadBox = new MesloadBox(staffListPanel, {
			// 主数据载入窗口
			warningContent: '没有此类信息，请重新选择或输入'
		})

	// 需要的功能
	selectDepartment.hide()
	fuzzySearchGroup.show()

	// 初始化模态框
	modalTitle.html('选择工作人员')
	fuzzySearchGroup.closest('.input-group').find('input').val('')

	selectStaffModal.modal({
		backdrop: false, // 黑色遮罩不可点击
		keyboard: false,  // esc按键不可关闭模态框
		show: true
	})
	// selectStaffModal.off('hidden.bs.modal').on('hidden.bs.modal', function () {
	// 	$('body').addClass('modal-open')
	// })

	modalCloseBtn.off('click').on('click', (event) => {
		// 点击关闭按钮隐藏该模态框
		selectStaffModal.modal('hide')
	})

	// 加载数据
	function addTableData(url, data) {
		$.ajax({
			 type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
			url: url,
			data: data,
			beforeSend: function (xml) {
				// ajax发送前
				mesloadBox.loadingShow()
			},
			success: function (result, status, xhr) {
				// ajax成功
				paginationContainer.show()	//显示分页按钮
				mesloadBox.hide()
				if (result.status === 0) {
					mesVerticalTableAddData(staffListPanel, {
						thead: {
							theadContent: '序号/姓名/工号/职位',
							theadWidth: '10%/30%/30%/30%'
						},
						tbody: {
							html: [
								'<td></td>',
								'<td></td>',
								'<td></td>',
								'<td></td>',
							],

							// 添加表格主体数据, 这是一个回调函数,这里不需要传参
							dataAddress: function (tbodyTarget, html, result) {
								tbodyTarget.empty() // 清空表格主体
								let map = result.map, // 映射
									dataList = map.staffs, // 主要数据列表
									tempData = null; // 表格td内的临时数据

								for (let i = 0, len = dataList.length; i < len; i++) {
									tbodyTarget.append('<tr></tr>'); // 添加行
									let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
									currentTr.off('click').on('click', (event) => {
										selectStaffModal.modal('hide')
										resolve({
											roleStaffId: dataList[currentTr.index()].role_staff_id,
											roleStaffName: dataList[currentTr.index()].role_staff_name
										})
									})
									for (let i = 0, len = html.length; i < len; i++) {
										currentTr.append(html[i]); // 添加表格内的HTML
										switch (i) {
											case 0: {
												currentTr.children().eq(i).html(currentTr.index() + 1)
											}
												break;
											case 1: {
												tempData = dataList[currentTr.index()].role_staff_name;
												currentTr.children().eq(i).html(tempData)
											}
												break;
											case 2: {
												tempData = dataList[currentTr.index()].role_staff_number;
												currentTr.children().eq(i).html(tempData)
											}
												break;
											case 3: {
												try {
													tempData = dataList[currentTr.index()].post.role_post_name;
													currentTr.children().eq(i).html(tempData)
												}
												catch (e) {
													currentTr.children().eq(i).html('')
												}
											}
												break;
											default:
												break;
										}
									}
								}
							}
						},

						pagination: {
							totalRow: result.map.lines, // 总行数
							displayRow: result.map.staffs.length // 显示行数
						},

						ajax: {
							url: url,
							data: data
						}
					})
				}
				else {
					panelTbody.empty().append(NO_DATA_NOTICE)
					paginationContainer.hide()	//隐藏分页按钮
					mesloadBox.warningShow();
				}
			}
		})
	}
	addTableData(url, {
		type:'info',
		headNum: 1
	}) // 启动运行

	fuzzySearchGroup.find('.btn').off('click').on('click', function (event) {
		let val = $(this).closest('.input-group').find('input').val();
		event.stopPropagation() // 禁止向上冒泡
		if (val !== '') {
			addTableData(url, {
				type: 'info',
				staffName: val,
				headNum: 1
			}) // 启动运行
		}
		else {
			// 为空时搜索全部
			addTableData(url, {
				type: 'info',
				headNum: 1
			})
		}
		//清空搜索框并获取焦点
		$(this).closest('.input-group').find('input').focus().val('')
	});

	// 模糊搜索回车搜索
	fuzzySearchGroup.find('input').off('keydown').on('keydown', function (event) {
		if (event.keyCode === 13) {
			event.preventDefault()
			fuzzySearchGroup.find('.btn').trigger('click')	//模拟点击搜索按钮
		}
	});


}

	/**
 * @description :员工选择模态框（单选),第二层弹窗调用
 *@param resolve: Promise回调函数
 *@param url: 请求路径
 *@param data: 请求参数
 */
function selectStaffAddData2(resolve, url, data) {
  let selectStaffModal = $('#publicSelectModalBox'), // 模态框
    staffListPanel = selectStaffModal.find('.panel'), // 面板
    targetTable = staffListPanel.find('table'),
    // panelTbody = staffListPanel.find('tbody'),	//面版表格tbody
    paginationContainer = staffListPanel.find('.pagination'),		// 分页ul标签
    selectDepartment = staffListPanel.find('.pullDownMenu-1'), // 选择下拉菜单
    fuzzySearchGroup = staffListPanel.find('.fuzzy-search-group'), // 模糊搜索菜单
    modalCloseBtn = selectStaffModal.find('.modal-header').find('.close'),
    modalTitle = selectStaffModal.find('.modal-title'),
    mesloadBox = new MesloadBox(staffListPanel, {
      // 主数据载入窗口
      warningContent: '没有此类信息，请重新选择或输入'
    })

  // 需要的功能
  selectDepartment.hide()
  fuzzySearchGroup.show()

  selectStaffModal.css("z-index",10000)


  // 初始化模态框
  modalTitle.html('选择工作人员')
  fuzzySearchGroup.closest('.input-group').find('input').val('')

  selectStaffModal.modal({
    backdrop: false, // 黑色遮罩不可点击
    keyboard: false,  // esc按键不可关闭模态框
    show: true
  })
  selectStaffModal.off('hidden.bs.modal').on('hidden.bs.modal', function () {
    $('body').addClass('modal-open')
  })

  modalCloseBtn.off('click').on('click', (event) => {
    // 点击关闭按钮隐藏该模态框
    selectStaffModal.modal('hide')
  })

  // 加载数据
  function addTableData(url, data) {
    $.ajax({
       type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
      url: url,
      data: data,
      beforeSend: function (xml) {
        // ajax发送前
        mesloadBox.loadingShow()
      },
      success: function (result, status, xhr) {
        // ajax成功
        paginationContainer.show()	//显示分页按钮
        mesloadBox.hide()
        if (result.status === 0) {
          mesVerticalTableAddData(staffListPanel, {
            thead: {
              theadContent: '序号/姓名/工号/职位',
              theadWidth: '10%/30%/30%/30%'
            },
            tbody: {
              html: [
                '<td></td>',
                '<td></td>',
                '<td></td>',
                '<td></td>',
              ],

              // 添加表格主体数据, 这是一个回调函数,这里不需要传参
              dataAddress: function (tbodyTarget, html, result) {
                tbodyTarget.empty() // 清空表格主体
                let map = result.map, // 映射
                  dataList = map.staffs, // 主要数据列表
                  tempData = null; // 表格td内的临时数据

                for (let i = 0, len = dataList.length; i < len; i++) {
                  tbodyTarget.append('<tr></tr>'); // 添加行
                  let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
                  currentTr.off('click').on('click', (event) => {
                    selectStaffModal.modal('hide')
                    resolve({
                      roleStaffId: dataList[currentTr.index()].role_staff_id,
                      roleStaffName: dataList[currentTr.index()].role_staff_name
                    })
                  })
                  for (let i = 0, len = html.length; i < len; i++) {
                    currentTr.append(html[i]); // 添加表格内的HTML
                    switch (i) {
                      case 0: {
                        currentTr.children().eq(i).html(currentTr.index() + 1)
                      }
                        break;
                      case 1: {
                        tempData = dataList[currentTr.index()].role_staff_name;
                        currentTr.children().eq(i).html(tempData)
                      }
                        break;
                      case 2: {
                        tempData = dataList[currentTr.index()].role_staff_number;
                        currentTr.children().eq(i).html(tempData)
                      }
                        break;
                      case 3: {
                        try {
                          tempData = dataList[currentTr.index()].post.role_post_name;
                          currentTr.children().eq(i).html(tempData)
                        }
                        catch (e) {
                          currentTr.children().eq(i).html('')
                        }
                      }
                        break;
                      default:
                        break;
                    }
                  }
                }
              }
            },

            pagination: {
              totalRow: result.map.lines, // 总行数
              displayRow: result.map.staffs.length // 显示行数
            },

            ajax: {
              url: url,
              data: data
            }
          })
        }
        else {
          panelTbody.empty().append(NO_DATA_NOTICE)
          paginationContainer.hide()	//隐藏分页按钮
          mesloadBox.warningShow();
        }
      }
    })
  }
  addTableData(url, {
    type:'info',
    headNum: 1
  }) // 启动运行

  fuzzySearchGroup.find('.btn').off('click').on('click', function (event) {
    let val = $(this).closest('.input-group').find('input').val();
    event.stopPropagation() // 禁止向上冒泡
    if (val !== '') {
      addTableData(url, {
        type: 'info',
        staffName: val,
        headNum: 1
      }) // 启动运行
    }
    else {
      // 为空时搜索全部
      addTableData(url, {
        type: 'info',
        headNum: 1
      })
    }
    //清空搜索框并获取焦点
    $(this).closest('.input-group').find('input').focus().val('')
  });

  // 模糊搜索回车搜索
  fuzzySearchGroup.find('input').off('keydown').on('keydown', function (event) {
    if (event.keyCode === 13) {
      event.preventDefault()
      fuzzySearchGroup.find('.btn').trigger('click')	//模拟点击搜索按钮
    }
  });


}

	/**
	 * @description :设备选择模态框（单选）
	 *@param resolve: Promise回调函数
	 */
	function selectDevicessAddData2(resolve) {
		let selectStaffModal = $(document.getElementById('publicSelectModalBox')), // 模态框
			staffListPanel = selectStaffModal.find('.panel'), // 面板
			targetTable = staffListPanel.find('table'),
			selectDepartment = staffListPanel.find('.pullDownMenu-1'), // 选择下拉菜单
			fuzzySearchGroup = staffListPanel.find('.fuzzy-search-group'), // 模糊搜索菜单
			modalCloseBtn = selectStaffModal.find('.modal-header').find('.close'),
			modalTitle = selectStaffModal.find('.modal-title'),
			mesloadBox = new MesloadBox(staffListPanel, {
				// 主数据载入窗口
				warningContent: '没有此类信息，请重新选择或输入'
			});

		// 需要的功能
		selectDepartment.show()
		fuzzySearchGroup.show()

		// 修改标题
		modalTitle.html('选择设备')
		fuzzySearchGroup.closest('.input-group').find('input').val()

		// 设备下拉菜单添加选项
		createDevicesTypeSelect(selectDepartment)

		// selectStaffModal.off('hidden.bs.modal').on('hidden.bs.modal', function (e) {
		// 	$('body').addClass('modal-open')
		// })
		selectStaffModal.modal({
			backdrop: false, // 黑色遮罩不可点击
			keyboard: false,  // esc按键不可关闭模态框
			show: false
		})
		selectStaffModal.modal('show') // 运行时显示
		modalCloseBtn.off('click').on('click', (event) => {
			// 点击关闭按钮隐藏该模态框
			selectStaffModal.modal('hide')

			// 初始化表格
			targetTable.find('thead').empty()
			targetTable.find('tbody').empty()
		})

		// 加载数据
		function addTableData(url, data) {
			$.ajax({
				 type: "POST", dataType: "json", xhrFields: { withCredentials: true }, crossDomain: true,
				url: url,
				data: data,
				beforeSend: function (xml) {
					// ajax发送前
					mesloadBox.loadingShow()
				},
				success: function (result, status, xhr) {
					// ajax成功
					mesloadBox.hide()
					if (result.status === 0) {
						mesVerticalTableAddData(staffListPanel, {
							thead: {
								theadContent: '序号/设备名称/设备编号/设备状态',
								theadWidth: '10%/30%/30%/30%'
							},
							tbody: {
								html: [
									'<td></td>',
									'<td></td>',
									'<td></td>',
									'<td></td>',
								],

								// 添加表格主体数据, 这是一个回调函数,这里不需要传参
								dataAddress: function (tbodyTarget, html, result) {
									tbodyTarget.empty() // 清空表格主体
									let map = result.map, // 映射
										dataList = map.devices, // 主要数据列表
										tempData = null; // 表格td内的临时数据

									for (let i = 0, len = dataList.length; i < len; i++) {
										tbodyTarget.append('<tr></tr>'); // 添加行
										let currentTr = tbodyTarget.children('tr').eq(i); // 循环到的当前行
										currentTr.off('click').on('click', (event) => {
											selectStaffModal.modal('hide')
											resolve({
												devicesId: dataList[currentTr.index()].devices_control_devices_id,
												devicesName: dataList[currentTr.index()].devices_control_devices_name,
												devicesNumber: dataList[currentTr.index()].devices_control_devices_number
											})
										})
										for (let i = 0, len = html.length; i < len; i++) {
											currentTr.append(html[i]); // 添加表格内的HTML
											switch (i) {
												case 0: {
													currentTr.children().eq(i).html(currentTr.index() + 1)
												}
													break;
												case 1: {
													tempData = dataList[currentTr.index()].devices_control_devices_name;
													currentTr.children().eq(i).html(tempData);
												}
													break;
												case 2: {
													tempData = dataList[currentTr.index()].devices_control_devices_number;
													currentTr.children().eq(i).html(tempData);

												}
													break;
												case 3: {
													tempData = dataList[currentTr.index()].devices_control_devices_status;
													currentTr.children().eq(i).html(tempData);
												}
													break;
												default:
													break;
											}
										}
									}
								}
							},

							pagination: {
								totalRow: result.map.lines, // 总行数
								displayRow: result.map.devices.length // 显示行数
							},

							ajax: {
								url: url,
								data: data
							}
						})
					}
					else {
						mesloadBox.warningShow();
					}
				}
			})
		}
		addTableData(queryDevicesUrl, {
			type: 'all',
			headNum: 1
		}) // 启动运行

		// 模糊搜索组加载数据
		fuzzySearchGroup.find('.btn').off('click').on('click', function (event) {
			let val = $(this).closest('.input-group').find('input').val();
			event.stopPropagation() // 禁止向上冒泡
			if (val !== '') {
				addTableData(queryDevicesUrl, {
					type: 'key',
					keyWord: val,
					headNum: 1
				})
			}
			else {
				// 为空时重置搜索
				addTableData(queryDevicesUrl, {
					type: 'all',
					headNum: 1
				})
			}
			//清空搜索框并获取焦点
			$(this).closest('.input-group').find('input').focus().val('')
		})

		// 模糊搜索回车搜索
		fuzzySearchGroup.find('input').off('keydown').on('keydown', function (event) {
			if (event.keyCode === 13) {
				event.preventDefault()
				$(this).closest('.input-group').find('button').trigger('click')
			}

		})

		// 下拉选事件
		selectDepartment.change(function () {
			let val = $(this).val();

			addTableData(queryDevicesUrl, {
				type: 'typeId',
				typeId: val,
				headNum: 1
			})
		})

	}


	//后续修改的bug
	$('.treeview>a:first-child').click(function(){
		$('.treeview>a:first-child').removeClass('treeview-active')
		$(this).addClass('treeview-active')
	})






})

